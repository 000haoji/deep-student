/**
 * Chat V2 - Block ç±»å‹å®šä¹‰
 *
 * å—æ˜¯æ¶ˆæ¯å†…å®¹çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªå—æœ‰ç‹¬ç«‹çš„çŠ¶æ€æœºã€‚
 * å—ç±»å‹é€šè¿‡æ³¨å†Œè¡¨ç®¡ç†ï¼Œå¯æ‰©å±•ã€‚
 */

import type { BlockStatus, BlockType } from './common';

// é‡æ–°å¯¼å‡ºå…±äº«ç±»å‹
export type { BlockStatus, BlockType } from './common';

// ============================================================================
// å—ç»“æ„
// ============================================================================

/**
 * é€šç”¨å—ç»“æ„
 * æ‰€æœ‰å—ç±»å‹å…±äº«æ­¤åŸºç¡€ç»“æ„
 */
export interface Block {
  /** å—å”¯ä¸€æ ‡è¯† */
  id: string;

  /** å—ç±»å‹ï¼ˆå¯æ‰©å±•ï¼‰ */
  type: BlockType;

  /** å—çŠ¶æ€ */
  status: BlockStatus;

  /** ç»‘å®šçš„æ¶ˆæ¯ IDï¼ˆå¿…é¡»ï¼‰ */
  messageId: string;

  // ========== æµå¼å—ä¸“ç”¨ ==========

  /** æµå¼å†…å®¹ï¼ˆthinking/content ç­‰ï¼‰ */
  content?: string;

  // ========== å·¥å…·è°ƒç”¨ä¸“ç”¨ ==========

  /** å·¥å…·åç§° */
  toolName?: string;

  /** å·¥å…·è¾“å…¥å‚æ•° */
  toolInput?: Record<string, unknown>;

  /** å·¥å…·è¾“å‡ºç»“æœ */
  toolOutput?: unknown;

  /** ğŸ†• å·¥å…·è°ƒç”¨å‚æ•°æ­£åœ¨ç”Ÿæˆä¸­ï¼ˆLLM æ­£åœ¨ç´¯ç§¯å‚æ•°ï¼‰ */
  isPreparing?: boolean;

  /** ğŸ†• å·¥å…·è°ƒç”¨ IDï¼ˆç”¨äº preparing å—å’Œ tool_call å—çš„å…³è”ï¼‰ */
  toolCallId?: string;

  // ========== çŸ¥è¯†æ£€ç´¢ä¸“ç”¨ ==========

  /** å¼•ç”¨æ¥æºåˆ—è¡¨ */
  citations?: Citation[];

  // ========== é”™è¯¯ä¿¡æ¯ ==========

  /** é”™è¯¯æè¿° */
  error?: string;

  // ========== æ—¶é—´æˆ³ ==========

  /** å—åˆ›å»º/å¼€å§‹æ—¶é—´ */
  startedAt?: number;

  /** ç¬¬ä¸€ä¸ªæœ‰æ•ˆ chunk åˆ°è¾¾æ—¶é—´ï¼ˆç”¨äºæ’åºï¼‰ */
  firstChunkAt?: number;

  /** å—ç»“æŸæ—¶é—´ */
  endedAt?: number;
}

// ============================================================================
// å¼•ç”¨æ¥æº
// ============================================================================

/**
 * çŸ¥è¯†æ£€ç´¢å—çš„å¼•ç”¨æ¥æº
 * â˜… 2026-01 æ‰©å±•ï¼šæ–°å¢ multimodalã€imageã€search ç±»å‹
 */
export interface Citation {
  /** æ¥æºç±»å‹ */
  type: 'rag' | 'memory' | 'web' | 'multimodal' | 'image' | 'search';

  /** æ¥æºæ ‡é¢˜ */
  title?: string;

  /** æ¥æº URL æˆ–æ–‡ä»¶è·¯å¾„ */
  url?: string;

  /** æ¥æºå†…å®¹ç‰‡æ®µ */
  snippet?: string;

  /** ç›¸å…³åº¦åˆ†æ•° */
  score?: number;
}

// ============================================================================
// å—åˆ›å»ºå‚æ•°
// ============================================================================

/**
 * åˆ›å»ºå—æ—¶çš„å‚æ•°
 */
export interface CreateBlockParams {
  /** ç»‘å®šçš„æ¶ˆæ¯ ID */
  messageId: string;

  /** å—ç±»å‹ */
  type: BlockType;

  /** åˆå§‹å†…å®¹ï¼ˆå¯é€‰ï¼‰ */
  initialContent?: string;

  /** å·¥å…·åç§°ï¼ˆå·¥å…·å—ï¼‰ */
  toolName?: string;

  /** å·¥å…·è¾“å…¥ï¼ˆå·¥å…·å—ï¼‰ */
  toolInput?: Record<string, unknown>;
}

// ============================================================================
// å—æ›´æ–°å‚æ•°
// ============================================================================

/**
 * æ›´æ–°å—æ—¶çš„å‚æ•°
 */
export interface UpdateBlockParams {
  /** å— ID */
  blockId: string;

  /** è¿½åŠ çš„å†…å®¹ï¼ˆæµå¼å—ï¼‰ */
  chunk?: string;

  /** æ–°çŠ¶æ€ */
  status?: BlockStatus;

  /** å·¥å…·ç»“æœ */
  result?: unknown;

  /** é”™è¯¯ä¿¡æ¯ */
  error?: string;
}
