/**
 * Chat Core Styles - èŠå¤©ç•Œé¢æ ¸å¿ƒæ ·å¼
 * 
 * ä½œç”¨åŸŸï¼šæ‰€æœ‰æ ·å¼é™å®šåœ¨ .chat-v2 å†…
 * æš—è‰²æ¨¡å¼ï¼šä½¿ç”¨ :root.dark .chat-v2 æˆ– .dark .chat-v2 é€‰æ‹©å™¨
 */

/* ============================================================================
   CSSå˜é‡å®šä¹‰ - Design Tokens (ä½œç”¨åŸŸé™å®šåœ¨ .chat-v2)
   ============================================================================ */
.chat-v2 {
  /* é¢œè‰²ç³»ç»Ÿ - ä½¿ç”¨shadcnå˜é‡ */
  --chat-primary-color: hsl(var(--primary));
  --chat-primary-hover: hsl(var(--primary) / 0.9);
  --chat-secondary-color: hsl(var(--secondary));
  --chat-text-primary: hsl(var(--foreground));
  --chat-text-secondary: hsl(var(--muted-foreground));
  --chat-text-inverse: hsl(var(--primary-foreground));
  --chat-bg-primary: hsl(var(--card));
  --chat-bg-secondary: hsl(var(--muted));
  --chat-border-color: hsl(var(--border));
  --chat-user-message-text: #ffffff;

  /* é—´è·ç³»ç»Ÿ */
  --chat-spacing-xs: 0.25rem;
  --chat-spacing-sm: 0.5rem;
  --chat-spacing-md: 1rem;
  --chat-spacing-lg: 1.5rem;

  /* è¾¹æ¡†åœ†è§’ */
  --chat-radius-sm: 8px;
  --chat-radius-md: 12px;
  --chat-radius-lg: 16px;
  --chat-radius-pill: 24px;

  /* åŠ¨ç”» */
  --chat-transition-speed: 0.2s;
  --chat-transition-timing: cubic-bezier(0.4, 0, 0.2, 1);

  /* è§¦æ‘¸ç›®æ ‡æœ€å°å°ºå¯¸ */
  --chat-touch-target: 44px;
}

/* ============================================================================
   å·¥å…·ç±» - Utilities
   ============================================================================ */

/* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™æ»šåŠ¨åŠŸèƒ½ï¼ˆç”¨äºç§»åŠ¨ç«¯æ¨ªå‘æ»šåŠ¨ï¼‰ */
.chat-v2 .scrollbar-hide {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.chat-v2 .scrollbar-hide::-webkit-scrollbar {
  display: none;  /* Chrome, Safari, Opera */
}

/* ============================================================================
   èŠå¤©å®¹å™¨ - Chat Container
   ============================================================================ */

.chat-v2 .chat-container {
  --app-message-content-bg: transparent;
  --app-user-message-bg: linear-gradient(135deg, var(--chat-primary-color) 0%, var(--chat-primary-hover) 100%);
  --app-user-message-fg: var(--chat-text-inverse);
  --chat-assistant-surface: transparent;
  --chat-assistant-border: transparent;
  --chat-assistant-shadow: none;
  --chat-history-bg: transparent;
  display: flex;
  flex-direction: column;
  height: 100%;
  /* min-height: 500px; ç§»é™¤å›ºå®šæœ€å°é«˜åº¦é™åˆ¶ */
  background: transparent;
  border-radius: 0;
  box-shadow: none;
  overflow: hidden;
  transition: all var(--chat-transition-speed) var(--chat-transition-timing);
  flex: 1;
}

:root.dark .chat-v2 .chat-container,
.dark .chat-v2 .chat-container {
  --app-message-content-bg: transparent;
  --chat-assistant-surface: transparent;
  --chat-assistant-shadow: none;
}

/* æš—è‰²æ¨¡å¼ä¸‹ç”¨æˆ·æ¶ˆæ¯æ–‡å­—ä½¿ç”¨æ·±è‰²ï¼Œä¸äº®è‰²èƒŒæ™¯å½¢æˆå¯¹æ¯” */
:root.dark .chat-v2,
html.dark .chat-v2,
.dark .chat-v2 {
  --chat-user-message-text: #0f172a;
}

.chat-v2 .chat-container.chat-fullscreen {
  position: fixed;
  top: 0;
  /* ä¿®å¤ï¼šä½¿ç”¨CSSå˜é‡ç¡®ä¿å§‹ç»ˆä»ä¾§è¾¹æ å³è¾¹ç¼˜å¼€å§‹ */
  left: var(--sidebar-width, 160px);
  /* ç§»é™¤right: 0ï¼Œå¦åˆ™widthè®¾ç½®ä¼šè¢«å¿½ç•¥ */
  bottom: 0;
  z-index: 1000;
  border-radius: 0;
  box-shadow: none;
  background: transparent;
  /* ğŸ¯ ä¿®å¤ï¼šè®¡ç®—å®é™…å®½åº¦ä»¥é˜²æ­¢è¶…å‡º */
  width: calc(100vw - var(--sidebar-width, 160px));
  min-width: 0;
  max-width: calc(100vw - var(--sidebar-width, 160px));
}

/* éå…¨å±æ¨¡å¼ï¼šåœ¨åˆ†æé¡µé¢å³ä¾§é¢æ¿ä¸­å±…ä¸­æ˜¾ç¤ºèŠå¤©å®¹å™¨å¹¶é™åˆ¶æœ€å¤§å®½åº¦ */
.chat-v2 .right-panel .chat-container:not(.chat-fullscreen) {
  max-width: 100%;
  margin-left: 0;
  margin-right: 0;
  width: 100%;
  height: 100%;
  border-radius: 0;
  border: none;
  box-shadow: none;
  background: transparent;
  flex: 1;
}

/* ä¾§è¾¹æ æ”¶èµ·æ—¶çš„å…¨å±èŠå¤©çª—å£ */
.sidebar-collapsed ~ main .chat-v2 .chat-container.chat-fullscreen,
body.sidebar-collapsed .chat-v2 .chat-container.chat-fullscreen {
  left: var(--sidebar-collapsed-width, 63px);
}

.chat-v2 .chat-header {
  padding: 0;
  border-bottom: none;
  background: transparent;
  display: flex;
  justify-content: space-between;
  align-items: center;
  min-height: 60px;
  flex-shrink: 0; /* é˜²æ­¢å‹ç¼© */
}

.chat-v2 .chat-header h3,
.chat-v2 .chat-header h4 {
  margin: 0;
  font-size: 1.1rem;
  color: hsl(var(--foreground));
  font-weight: 600;
}

.chat-v2 .chat-header-actions {
  display: flex;
  align-items: center;
  gap: 10px;
}

.chat-v2 .chat-fullscreen-toggle {
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: hsl(var(--muted-foreground));
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  transition: all 0.2s;
}

.chat-v2 .chat-fullscreen-toggle:hover {
  background-color: hsl(var(--muted));
  color: hsl(var(--foreground));
}

.chat-v2 .chain-indicator {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  color: hsl(var(--muted-foreground));
  background: hsl(var(--accent));
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  border: 1px solid hsl(var(--border));
}

/* ============================================================================
   èŠå¤©å†å² - Chat History
   ============================================================================ */

.chat-v2 .chat-history {
  flex: 1;
  overflow: hidden; /* æ”¹ä¸º hiddenï¼Œå› ä¸ºä½¿ç”¨ CustomScrollArea */
  padding: 0; /* padding ç§»åˆ° viewport */
  display: flex;
  flex-direction: column;
  background: var(--chat-history-bg);
  height: 100%; /* ç¡®ä¿é«˜åº¦å¡«æ»¡ */
}

.chat-v2 .chat-history-viewport {
  padding: 1rem 1.5rem;
  /* åº•éƒ¨é¢„ç•™ç©ºé—´ç»™å¸åº•è¾“å…¥æ¡†ï¼Œä½¿ç”¨ CSS å˜é‡åŠ¨æ€å“åº”è¾“å…¥æ¡†é«˜åº¦ */
  padding-bottom: calc(var(--unified-input-docked-height, 120px) + 1rem);
  display: flex;
  flex-direction: column;
  gap: var(--chat-spacing-md);
  scroll-behavior: smooth;
  /* ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* åˆ†æé¡µå¾®è°ƒæ¶ˆæ¯é—´è·ï¼Œæå‡èŠ‚å¥æ„Ÿ */
.chat-v2 .analysis-result .chat-history-viewport {
  gap: 1.25rem;
}

/* åº•éƒ¨ç•™ç™½å·²é€šè¿‡ .chat-history-viewport çš„ padding-bottom å®ç°ï¼Œæ­¤å¤„ä¼ªå…ƒç´ ä»…ä½œä¸ºå…œåº• */
.chat-v2 .analysis-result .chat-history-viewport::after,
.chat-v2 .chat-container .chat-history-viewport::after,
.chat-v2 .chat-container.chat-fullscreen .chat-history-viewport::after,
.chat-v2 .batch-detail-page .chat-history-viewport::after,
.chat-v2 .review-analysis .analysis-result .chat-history-viewport::after,
.chat-v2 .chat-history-viewport::after {
  content: '';
  display: block;
  height: 0; /* padding-bottom å·²å¤„ç†ç•™ç™½ï¼Œæ­¤å¤„ä¸å†é¢å¤–æ·»åŠ  */
  width: 100%;
  flex-shrink: 0;
  pointer-events: none;
}

.chat-v2 .chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: var(--chat-spacing-md);
  background: transparent;
}

.chat-v2 .empty-chat {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 0;
  color: hsl(var(--muted-foreground));
  text-align: center;
}

.chat-v2 .empty-chat p {
  margin: 0.5rem 0;
  line-height: 1.5;
}

/* ============================================================================
   æ¶ˆæ¯æ ·å¼ - Message Styles
   ============================================================================ */

.chat-v2 .message {
  display: flex;
  flex-direction: column;
  margin-bottom: 1.5rem;
  opacity: 1;
  transition: opacity 0.3s ease;
  width: 100%;
  position: relative; /* ç¡®ä¿æ¯æ¡æ¶ˆæ¯æœ‰ç‹¬ç«‹çš„å®šä½ä¸Šä¸‹æ–‡ */
  overflow: visible; /* å…è®¸å·¥å…·è¯¦æƒ…åŒºåŸŸå®Œæ•´æ˜¾ç¤º */
}

.chat-v2 .message.user {
  align-items: flex-end;
  margin-bottom: 0;
}

.chat-v2 .chat-container .message.assistant {
  align-items: stretch; /* æ”¹ä¸ºstretchè®©å†…å®¹å æ»¡å®½åº¦ */
  width: 100%;
  max-width: 100%;
  border: none;
  background: transparent;
}

.chat-v2 .message-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.chat-v2 .chat-container .message-actions button {
  background: transparent;
  border: none;
  box-shadow: none;
  padding: 0;
  min-width: 32px;
  min-height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 0;
  color: hsl(var(--muted-foreground));
  transition: color var(--chat-transition-speed) var(--chat-transition-timing);
}

.chat-v2 .chat-container .message-action-btn {
  background: transparent;
  border: none;
  box-shadow: none;
  padding: 0;
  min-width: 32px;
  min-height: 32px;
  width: auto;
  height: auto;
  border-radius: 0;
}

.chat-v2 .message-actions button svg {
  color: inherit;
  opacity: 1;
  transition: color var(--chat-transition-speed) var(--chat-transition-timing);
}

.chat-v2 .chat-container .summary-action-btn {
  background: transparent;
  border: none;
  padding: 0;
  font-size: 0.85rem;
  font-weight: 500;
  border-radius: 0;
  box-shadow: none;
}

.chat-v2 .chat-container .summary-action-btn:hover,
.chat-v2 .chat-container .summary-action-btn:focus-visible {
  background: transparent;
}

.chat-v2 .chat-container .icon-ghost-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  background: transparent;
  border: none;
  border-radius: 0;
  box-shadow: none;
  min-width: 32px;
  min-height: 32px;
  height: 32px;
  flex-shrink: 0;
  overflow: hidden;
}

.chat-v2 .icon-ghost-btn svg {
  width: 18px;
  height: 18px;
}

.chat-v2 .chat-container .message-actions button:hover,
.chat-v2 .chat-container .message-actions button:focus-visible {
  color: hsl(var(--foreground));
  background: transparent;
}

.chat-v2 .message.streaming {
  opacity: 1;
}

.chat-v2 .chat-container .message-content {
  width: 100%; /* å æ»¡çˆ¶å®¹å™¨å®½åº¦ */
  max-width: none; /* ç§»é™¤æœ€å¤§å®½åº¦é™åˆ¶ */
  padding: 0;
  border-radius: 0;
  word-wrap: break-word;
  line-height: 1.6; /* æå‡å¯è¯»æ€§ */
  font-size: 0.95rem;
  position: relative;
  transition: none; /* å…¨å±€ç¦æ­¢è¿‡æ¸¡ä»¥é¿å…é—ªåŠ¨ */
  overflow: visible; /* æ”¹ä¸ºvisibleï¼Œé¿å…ä¸å¿…è¦çš„æ»šåŠ¨æ¡ */
  box-sizing: border-box;
  /* é˜²å¾¡ï¼šä»»ä½•ä¼ªå…ƒç´ è£…é¥°ä¸å¾—æ‹¦æˆªç‚¹å‡» */
  pointer-events: auto;
}

/* ç¡®ä¿æ¶ˆæ¯å†…å®¹ä¸­çš„é¢„æ ¼å¼æ–‡æœ¬æ­£å¸¸æ˜¾ç¤º */
.chat-v2 .message-content pre {
  overflow-x: auto;
  max-width: 100%;
  white-space: pre;
}

/* é˜²æ­¢å†…éƒ¨å®¹å™¨äº§ç”Ÿä¸å¿…è¦çš„æ»šåŠ¨æ¡ */
.chat-v2 .chat-container .message-content > div {
  overflow: visible;
}

/* ç‰¹åˆ«å¤„ç†å¯èƒ½åŒ…å«æ•°å­¦å…¬å¼çš„åŒºåŸŸ */
.chat-v2 .chat-container .message-content .math,
.chat-v2 .chat-container .message-content .katex,
.chat-v2 .chat-container .message-content .MathJax {
  overflow: visible;
  max-width: 100%;
}

/* ä¿®å¤ katex-html çš„ overflow é—®é¢˜ */
.chat-v2 .chat-container .message-content .katex-html {
  overflow-x: visible;
  overflow-y: visible;
  overflow: visible;
}

/* ğŸ¯ ç”¨æˆ·æ¶ˆæ¯ï¼šå»æ‰æ°”æ³¡ï¼Œæ–‡å­—é¢œè‰²ä¸åŠ©æ‰‹ä¸€è‡´ */
.chat-v2 .message.user .message-content {
  background: transparent;
  color: hsl(var(--foreground));
  border-radius: 0;
  padding: 0;
  font-size: 0.9375rem;
  line-height: 1.65;
  width: auto;
  max-width: 100%;
}

.chat-v2 .chat-container .message.assistant .message-content {
  background: var(--chat-assistant-surface);
  color: hsl(var(--foreground));
  border: none;
  border-radius: 0;
  width: 100%;
  max-width: 100%;
  padding: 0;
  box-shadow: none;
  outline: none;
}

.chat-v2 .chat-container .message.assistant .message-content::before,
.chat-v2 .chat-container .message.assistant .message-content::after {
  display: none;
}

.chat-v2 .chat-container .message.assistant .message-content > .markdown-content {
  border: none;
  box-shadow: none;
  background: transparent;
  width: 100%;
  max-width: 100%;
}

.chat-v2 .chat-container .message.assistant .message-content > div,
.chat-v2 .chat-container .message.assistant .message-content > section,
.chat-v2 .chat-container .message.assistant .message-content > article {
  width: 100%;
  max-width: 100%;
}

.chat-v2 .message-time {
  font-size: 0.75rem;
  color: hsl(var(--muted-foreground));
  margin-top: 0.5rem;
  padding: 0 0.5rem;
}

.chat-v2 .message.user .message-time {
  text-align: right;
}

.chat-v2 .message.assistant .message-time {
  text-align: left;
}

/* ============================================================================
   Notion é£æ ¼æŠ˜å å®¹å™¨ - Notion-inspired collapsible sections
   ============================================================================ */

.chat-v2 .notion-collapsible {
  margin-top: 12px;
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative; /* ç¡®ä¿æŠ˜å åŒºåŸŸæœ‰ç‹¬ç«‹çš„å †å ä¸Šä¸‹æ–‡ */
  z-index: 1; /* é˜²æ­¢å±•å¼€å†…å®¹è¢«åç»­æ¶ˆæ¯è¦†ç›– */
}

.chat-v2 .notion-collapsible-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.chat-v2 .notion-collapsible-trigger {
  flex: 1;
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  gap: 6px;
  border: none;
  background: transparent;
  padding: 0;
  border-radius: 0;
  cursor: pointer;
  color: inherit;
  transition: color 0.2s ease;
}

.chat-v2 .notion-collapsible-trigger:hover,
.chat-v2 .notion-collapsible-trigger:focus-visible {
  outline: none;
  color: hsl(var(--foreground));
}

.chat-v2 .notion-collapsible-left {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-secondary, #334155);
}

.chat-v2 .notion-collapsible-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted, #94a3b8);
}

.chat-v2 .notion-collapsible-badge {
  display: inline-flex;
  align-items: center;
}

.chat-v2 .notion-collapsible-arrow {
  transition: transform 0.2s ease;
  color: var(--text-muted, #94a3b8);
}

.chat-v2 .notion-collapsible-arrow.expanded {
  transform: rotate(90deg);
}

.chat-v2 .notion-collapsible-actions {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.chat-v2 .notion-collapsible-body {
  padding: 16px;
  overflow: visible; /* å…è®¸å±•å¼€å†…å®¹å®Œæ•´æ˜¾ç¤º */
  min-height: 0; /* å…è®¸ flex å­å…ƒç´ æ”¶ç¼© */
}

.chat-v2 .notion-collapsible-collapsed {
  padding: 12px;
}

.chat-v2 .notion-scroll-area {
  max-height: 360px;
  padding-right: 6px;
}

.chat-v2 .notion-section-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  /* ç¡®ä¿åˆ—è¡¨èƒ½æ­£ç¡®æ’‘å¼€çˆ¶å®¹å™¨ */
  min-height: 0;
  flex: 1;
}

.chat-v2 .tool-event-card {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 8px;
  position: relative; /* ç¡®ä¿å¡ç‰‡å†…å®¹ä¸ä¼šè„±ç¦»æ–‡æ¡£æµ */
  z-index: auto; /* ä½¿ç”¨é»˜è®¤å †å é¡ºåº */
  /* ç¡®ä¿å±•å¼€å†…å®¹èƒ½æ­£ç¡®æ’‘å¼€å¡ç‰‡ */
  min-height: 0;
  overflow: visible; /* å…è®¸å±•å¼€çš„è¯¦æƒ…å†…å®¹å®Œæ•´æ˜¾ç¤º */
}

.chat-v2 .tool-event-bubble {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.28);
  background: var(--surface-elevated, rgba(255, 255, 255, 0.92));
  box-shadow: none;
  transition: border-color 0.2s ease, transform 0.2s ease;
}

.chat-v2 .tool-event-bubble:hover {
  border-color: rgba(59, 130, 246, 0.32);
  transform: translateY(-1px);
}

.chat-v2 .tool-event-bubble__icon {
  width: 28px;
  height: 28px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(148, 163, 184, 0.16);
  color: rgba(71, 85, 105, 0.88);
  flex-shrink: 0;
}

.chat-v2 .tool-event-bubble--success .tool-event-bubble__icon {
  background: rgba(34, 197, 94, 0.15);
  color: rgba(22, 163, 74, 0.9);
}

.chat-v2 .tool-event-bubble--failed .tool-event-bubble__icon {
  background: rgba(248, 113, 113, 0.18);
  color: rgba(220, 38, 38, 0.92);
}

.chat-v2 .tool-event-bubble--running .tool-event-bubble__icon {
  background: rgba(96, 165, 250, 0.2);
  color: rgba(37, 99, 235, 0.95);
}

.chat-v2 .tool-event-bubble__spinner {
  animation: tool-event-spin 1s linear infinite;
}

@keyframes tool-event-spin {
  to {
    transform: rotate(360deg);
  }
}


.chat-v2 .tool-event-bubble__meta {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
  min-width: 0;
}

.chat-v2 .tool-event-bubble__title {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-secondary, #334155);
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.chat-v2 .tool-event-bubble__controls {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: auto;
  flex-shrink: 0;
}

.chat-v2 .tool-event-bubble__badge {
  height: 20px;
  font-size: 0.7rem;
  padding-left: 8px;
  padding-right: 8px;
  display: inline-flex;
  align-items: center;
}

.chat-v2 .tool-event-bubble__details-trigger {
  height: 20px;
  font-size: 0.7rem;
  padding-left: 6px;
  padding-right: 6px;
  color: rgba(37, 99, 235, 0.9);
}

.chat-v2 .tool-event-bubble__hint {
  font-size: 0.7rem;
  color: var(--text-muted, #64748b);
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.chat-v2 .tool-event-details {
  margin-top: 4px;
  margin-left: calc(12px + 28px + 8px);
  border: 1px solid rgba(148, 163, 184, 0.25);
  border-radius: 12px;
  background: var(--surface-elevated, rgba(248, 250, 252, 0.92));
  padding: 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative; /* ä¿æŒåœ¨æ­£å¸¸æ–‡æ¡£æµä¸­ */
  z-index: auto; /* ä¸æå‡z-indexï¼Œé¿å…è¦†ç›–åç»­å†…å®¹ */
  clear: both; /* æ¸…é™¤æµ®åŠ¨å½±å“ */
}

.chat-v2 .tool-event-detail-block {
  font-size: 0.78rem;
  color: hsl(var(--muted-foreground));
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.chat-v2 .tool-event-detail-title {
  font-weight: 600;
  color: hsl(var(--foreground));
}

.chat-v2 .tool-event-detail-block pre {
  margin: 0;
  padding: 6px 8px;
  background: rgba(241, 245, 249, 0.85);
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.25);
  white-space: pre-wrap;
  word-break: break-word;
  overflow-x: auto;
  font-size: 0.74rem;
  line-height: 1.5;
}

.chat-v2 .tool-event-detail-block.error {
  color: hsl(var(--danger));
}

.chat-v2 .tool-event-detail-block.error .tool-event-detail-title {
  color: hsl(var(--danger));
}

.chat-v2 .tool-event-detail-block.error pre {
  background: rgba(254, 242, 242, 0.95);
  border-color: rgba(248, 113, 113, 0.55);
}

.chat-v2 .summary-panel .summary-content {
  font-size: 0.85rem;
  color: var(--text-secondary, #334155);
  line-height: 1.7;
  padding: 0;
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.25);
  background: var(--surface-elevated, #ffffff);
  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
  overflow: hidden;
}

[data-theme="dark"] .chat-v2 .summary-panel .summary-content {
  background: hsl(var(--muted) / 0.3);
  border-color: hsl(var(--border));
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.4);
  color: hsl(var(--muted-foreground));
}

.chat-v2 .summary-panel .summary-empty {
  font-size: 0.78rem;
  color: var(--text-muted, #94a3b8);
  padding: 12px 16px;
}

/* ============================================================================
   æ€ç»´é“¾æ ·å¼ - Thinking Chain Styles
   ============================================================================ */

/* ============================================================================
   æµå¼å¤„ç†æ ·å¼ - Streaming Styles
   ============================================================================ */

.chat-v2 .streaming-indicator {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--brand-primary);
  font-size: 0.9rem;
  margin: 0.5rem 0;
}

.chat-v2 .streaming-text {
  position: relative;
}

.chat-v2 .streaming-cursor {
  display: inline-block;
  width: 2px;
  height: 1.2em;
  background-color: var(--brand-primary);
  animation: none;
  margin-left: 2px;
  vertical-align: text-bottom;
}
.chat-v2 .streaming-cursor[data-active="false"] {
  visibility: hidden;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

.chat-v2 .typing-indicator {
  display: inline-flex;
  gap: 4px;
  margin-right: 8px;
}

.chat-v2 .typing-indicator span {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: hsl(var(--muted-foreground));
  animation: typing 1.4s infinite ease-in-out;
}

.chat-v2 .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
.chat-v2 .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
  0%, 80%, 100% {
    transform: scale(0.8);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

.chat-v2 .partial-math-indicator {
  display: inline-block;
  margin-left: 4px;
  opacity: 0.7;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}

/* ç”¨æˆ·è®°å¿†æ‘˜è¦ ç¾åŒ–ä¸æŠ˜å  */
.chat-v2 .memory-summary {
  border: 1px solid hsl(var(--border));
  background: hsl(var(--muted));
  border-radius: 8px;
  overflow: hidden;
  margin: 8px 0;
}
.chat-v2 .memory-summary-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 10px;
  background: hsl(var(--accent));
  border-bottom: 1px solid hsl(var(--border));
  cursor: pointer;
  user-select: none;
}
.chat-v2 .memory-summary-title { font-size: 0.85rem; color: hsl(var(--foreground)); font-weight: 600; }
.chat-v2 .memory-summary-toggle { font-size: 0.78rem; color: hsl(var(--muted-foreground)); }
.chat-v2 .memory-summary-body { padding: 6px 10px; }
.chat-v2 .memory-summary-item {
  font-size: 0.8rem; /* å°äºæ­£æ–‡ä¸¤å· */
  color: hsl(var(--foreground));
  padding: 4px 0;
  border-bottom: 1px dashed #e5e7eb;
}
.chat-v2 .memory-summary-item:last-child { border-bottom: none; }

/* ============================================================================
   èŠå¤©è¾“å…¥ - Chat Input
   ============================================================================ */

.chat-v2 .chat-input {
  padding: 0;
  border-top: none; /* remove hard top border */
  background: hsl(var(--card));
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.chat-v2 .input-row {
  display: flex;
  align-items: flex-end;
  gap: 0.5rem;
}

.chat-v2 .chat-input input[type="text"] {
  flex: 1;
  padding: 0.75rem 1rem;
  border: 1px solid hsl(var(--border)); /* keep input border */
  border-radius: 20px;
  font-size: 0.95rem;
  outline: none;
  transition: border-color 0.2s;
  resize: none;
  min-height: 44px;
  max-height: 120px;
}

.chat-v2 .chat-input input[type="text"]:focus {
  border-color: var(--brand-primary);
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

.chat-v2 .chat-input input[type="text"]:disabled {
  background-color: hsl(var(--muted));
  color: hsl(var(--muted-foreground));
  cursor: not-allowed;
}

.chat-v2 .send-button {
  background: hsl(var(--card));
  color: hsl(var(--foreground));
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: var(--chat-radius-sm);
  min-width: var(--chat-touch-target); /* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */
  min-height: var(--chat-touch-target);
  width: 44px;
  height: 44px;
  cursor: pointer;
  transition: all var(--chat-transition-speed);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.chat-v2 .send-button:hover:not(:disabled) {
  background: hsl(var(--secondary));
  transform: scale(1.05);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

.chat-v2 .send-button:disabled {
  background: hsl(var(--muted));
  cursor: not-allowed;
  transform: none;
  opacity: 0.6;
  color: hsl(var(--muted-foreground));
  border-color: rgba(0, 0, 0, 0.05);
}

/* ç¡®ä¿å‘é€æŒ‰é’®ä¸­çš„å›¾æ ‡é¢œè‰² */
.chat-v2 .send-button svg {
  color: currentColor;
  stroke: currentColor;
  fill: none;
}

.chat-v2 .image-upload-btn {
  background: var(--chat-bg-secondary);
  color: var(--chat-text-secondary);
  border: 1px solid var(--chat-border-color);
  border-radius: 50%;
  min-width: var(--chat-touch-target); /* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */
  min-height: var(--chat-touch-target);
  width: 44px;
  height: 44px;
  cursor: pointer;
  transition: all var(--chat-transition-speed);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  flex-shrink: 0;
}

.chat-v2 .image-upload-btn:hover:not(:disabled) {
  background: hsl(var(--muted));
  color: hsl(var(--foreground));
  transform: scale(1.05);
}

.chat-v2 .image-upload-btn:disabled {
  background: hsl(var(--muted));
  color: hsl(var(--muted-foreground));
  cursor: not-allowed;
  transform: none;
}

/* ============================================================================
   å›¾ç‰‡é¢„è§ˆ - Image Preview
   ============================================================================ */

.chat-v2 .image-preview-container {
  border: 1px solid hsl(var(--border));
  border-radius: 8px;
  padding: 0;
  background: hsl(var(--muted));
}

.chat-v2 .image-preview-header {
  font-size: 0.85rem;
  color: hsl(var(--muted-foreground));
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.chat-v2 .image-preview-grid {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.chat-v2 .image-preview-item {
  position: relative;
  width: 60px;
  height: 60px;
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid hsl(var(--border));
}

.chat-v2 .image-preview-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.chat-v2 .image-preview-info {
  position: absolute;
  top: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 2px;
  border-radius: 0 0 0 4px;
}

.chat-v2 .remove-image-btn {
  background: rgba(220, 53, 69, 0.9);
  color: white;
  border: none;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  cursor: pointer;
  font-size: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s;
  padding: 0;
}

.chat-v2 .remove-image-btn:hover {
  background: rgba(220, 53, 69, 1);
}

/* ============================================================================
   å¤šæ¨¡æ€å†…å®¹ - Multimodal Content
   ============================================================================ */

.chat-v2 .content-text-part {
  margin-bottom: 0.5rem;
}

.chat-v2 .content-text-part:last-child {
  margin-bottom: 0;
}

.chat-v2 .content-image-part {
  margin: 0.5rem 0;
}

.chat-v2 .content-image-part img {
  max-width: 100%;
  max-height: 300px;
  display: block;
  margin: 0 auto;
  border-radius: 8px;
  border: 1px solid hsl(var(--border));
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.chat-v2 .content-unknown {
  padding: 0;
  background: hsl(var(--warning-bg));
  color: hsl(var(--warning));
  border: 1px solid #ffeaa7;
  border-radius: 6px;
  font-style: italic;
}

/* ============================================================================
   ä¿å­˜æŒ‰é’® - Save Buttons
   ============================================================================ */

.chat-v2 .save-buttons-row {
  margin-top: 0.75rem;
  padding: 0;
  border-top: 1px solid hsl(var(--border));
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.chat-v2 .save-button-inline,
.chat-v2 .save-button-primary,
.chat-v2 .save-button-secondary {
  padding: 0;
  border: none;
  border-radius: 6px;
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.chat-v2 .save-button-inline {
  background: hsl(var(--success));
  color: white;
}

.chat-v2 .save-button-inline:hover:not(:disabled) {
  background: hsl(var(--success-muted));
}

.chat-v2 .save-button-primary {
  background: var(--brand-primary);
  color: white;
}

.chat-v2 .save-button-primary:hover:not(:disabled) {
  background: var(--brand-primary-dark);
}

.chat-v2 .save-button-secondary {
  background: hsl(var(--neutral));
  color: white;
}

.chat-v2 .save-button-secondary:hover:not(:disabled) {
  background: hsl(var(--neutral-muted));
}

.chat-v2 .save-buttons-group {
  display: flex;
  gap: 0.5rem;
}

/* ============================================================================
   å“åº”å¼è®¾è®¡ - Responsive Design
   ============================================================================ */

@media (max-width: 768px) {
  .chat-v2 .chat-container {
    border-radius: 0;
    /* ç§»åŠ¨ç«¯ï¼šç”±çˆ¶å®¹å™¨ï¼ˆabsolute inset-0ï¼‰æ§åˆ¶å°ºå¯¸ï¼Œæ­¤å¤„ 100% å¡«æ»¡ */
    height: 100%;
  }
  
  .chat-v2 .chat-header {
    padding: 0.75rem 1rem;
  }
  
  .chat-v2 .chat-history {
    padding: 0.75rem 1rem;
  }
  
  .chat-v2 .message-content {
    max-width: 90%;
    padding: 0;
    font-size: 1.0rem;
  }
  
  .chat-v2 .chat-input {
    padding: 0.75rem 1rem;
  }
  
  .chat-v2 .input-row {
    gap: 0.5rem;
  }
  
  .chat-v2 .send-button,
  .chat-v2 .image-upload-btn {
    width: 40px;
    height: 40px;
    font-size: 1rem;
  }
  
  .chat-v2 .chat-input input[type="text"] {
    font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
  }
}

@media (max-width: 480px) {
  .chat-v2 .message-content {
    max-width: 95%;
    padding: 0;
    font-size: 0.85rem;
  }
  
}

/* ============================================================================
   æ»šåŠ¨æ¡ç¾åŒ– - Scrollbar Styling
   ============================================================================ */

.chat-v2 .chat-history::-webkit-scrollbar,
.chat-v2 .chat-messages::-webkit-scrollbar {
  width: 8px;
}

.chat-v2 .chat-history::-webkit-scrollbar-track,
.chat-v2 .chat-messages::-webkit-scrollbar-track {
  background: hsl(var(--muted)); /* æµ…ç°è‰²èƒŒæ™¯ */
  border-radius: 4px;
}

.chat-v2 .chat-history::-webkit-scrollbar-thumb,
.chat-v2 .chat-messages::-webkit-scrollbar-thumb {
  background: hsl(var(--muted)); /* ä¸­ç°è‰²æ»‘å— */
  border-radius: 4px;
  transition: background var(--chat-transition-speed);
}

.chat-v2 .chat-history::-webkit-scrollbar-thumb:hover,
.chat-v2 .chat-messages::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted)); /* æ‚¬åœæ—¶æ·±ç°è‰² */
}

/* ============================================================================
   æ€§èƒ½ä¼˜åŒ– - Performance Optimizations
   ============================================================================ */

/* å‡å°‘é‡ç»˜ */
.chat-v2 .message-content {
  will-change: transform;
}

/* GPUåŠ é€Ÿ */
.chat-v2 .chat-container,
.chat-v2 .message {
  transform: translateZ(0);
}

/* ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ */
@media (prefers-reduced-motion: reduce) {
  .chat-v2 * {
    animation-duration: 0.01ms;
    animation-iteration-count: 1;
    transition-duration: 0.01ms;
  }
}

/* ============================================================================
   å¯è®¿é—®æ€§å¢å¼º - Accessibility Enhancements
   ============================================================================ */

/* ç„¦ç‚¹æ ·å¼ */
.chat-v2 .send-button:focus-visible,
.chat-v2 .image-upload-btn:focus-visible,
.chat-v2 .chat-fullscreen-toggle:focus-visible {
  outline: 2px solid var(--chat-primary-color);
  outline-offset: 2px;
}

/* é«˜å¯¹æ¯”åº¦æ¨¡å¼ */
@media (prefers-contrast: high) {
  :root {
    --chat-text-secondary: #444444;
    --chat-border-color: hsl(var(--border));
  }
  
  .message-content {
    border: 2px solid currentColor;
  }
}

/* ============================================================================
   æš—è‰²ä¸»é¢˜æ”¯æŒ - Dark Mode Support (æš‚æ—¶ç¦ç”¨)
   ============================================================================ */

/* æš‚æ—¶ç¦ç”¨æš—è‰²æ¨¡å¼ï¼Œä¿æŒç™½è‰²èƒŒæ™¯
@media (prefers-color-scheme: dark) {
  :root {
    --chat-text-primary: #f0f0f0;
    --chat-text-secondary: #b0b0b0;
    --chat-bg-primary: #1a1a1a;
    --chat-bg-secondary: #2d2d2d;
    --chat-border-color: hsl(var(--border));
  }
}
*/

/* ============================================================================
   é¢å¤–ä¿®å¤ - Additional Fixes
   ============================================================================ */

/* ç¡®ä¿èŠå¤©å®¹å™¨æ­£ç¡®æ˜¾ç¤º */
.chat-v2 .analysis-result > .chat-container {
  flex: 1;
  margin: 0;
  border-radius: 0;
  box-shadow: none;
  background: transparent;
  min-height: 100%;
  height: 100%;
}

/* ä¿®å¤èŠå¤©è¾“å…¥å¸ƒå±€ */
.chat-v2 .chat-container .chat-input {
  background: transparent;
  flex-direction: row;
  align-items: center;
  border-top: none; /* ensure hard border removed */
  box-shadow: none;  /* remove any inset/outset line */
}

/* ä¿®å¤å‘é€æŒ‰é’®æ ·å¼ */
.chat-v2 .chat-container .send-button {
  background: #007bff;
  color: hsl(var(--primary-foreground));
}

.chat-v2 .chat-container .send-button:hover:not(:disabled) {
  background: #0056b3;
}

.chat-v2 .chat-container .send-button:disabled {
  background: hsl(var(--muted));
  opacity: 0.6;
}

/* ä¿®å¤å…¨å±æŒ‰é’®æ ·å¼ */
.chat-v2 .chat-header .chat-fullscreen-toggle {
  background: hsl(var(--muted));
  color: hsl(var(--foreground));
  border: 1px solid #ddd;
}

.chat-v2 .chat-header .chat-fullscreen-toggle:hover {
  background: hsl(var(--accent));
}

/* ç¡®ä¿å³ä¾§é¢æ¿æ­£ç¡®æ˜¾ç¤º */
.chat-v2 .analysis-result .right-panel {
  background: transparent;
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 100%;
}

/* ä¿®å¤åˆ†æç»“æœåŒºåŸŸ */
.chat-v2 main .analysis-result {
  height: 100%;
  min-height: 100%;
  display: flex;
  flex-direction: column;
  background: transparent;
  flex: 1;
}

/* ğŸ”§ å®‰å“ WebView ä¿®å¤ï¼šsafe-area-inset-bottom å¯èƒ½ä¸å·¥ä½œ */
/*
 * ä¿®å¤ç­–ç•¥ï¼š
 * 1. ä½¿ç”¨ .is-android ç±»ï¼ˆç”± platform.ts æ·»åŠ ï¼‰è¿›è¡Œç²¾ç¡®æ£€æµ‹
 * 2. ä½¿ç”¨ CSS å˜é‡ --android-safe-area-bottomï¼ˆç”± platform.ts è®¾ç½®ï¼‰
 * 3. é¿å…ä½¿ç”¨ @supports æ£€æµ‹ï¼ˆAndroid å¯èƒ½å£°ç§°æ”¯æŒä½†è¿”å›é”™è¯¯å€¼ï¼‰
 * 4. ç§»é™¤äº†åŸºäºåª’ä½“æŸ¥è¯¢çš„ hackï¼ˆä¼šå½±å“æ‰€æœ‰è§¦æ‘¸è®¾å¤‡ï¼‰
 *
 * â˜… 2026-02: InputBarUI ç°åœ¨é€šè¿‡ inline paddingBottom (= safe-area + tabBar) ç»Ÿä¸€å¤„ç†åº•éƒ¨é—´è·ï¼Œ
 *   ä¸å†éœ€è¦ CSS bottom åç§»ã€‚æ­¤å¤„ä»…ä¿ç•™ chat-history-viewport çš„ Android padding ä¿®å¤ã€‚
 */
html.is-android .chat-v2 .chat-history-viewport {
  padding-bottom: calc(var(--unified-input-docked-height, 120px) + var(--android-safe-area-bottom, 15px) + 56px + 16px) !important;
}

/* æ—§ç‰ˆ @supports æ£€æµ‹ä½œä¸ºæœ€åé˜²çº¿ - ä»…åœ¨å®Œå…¨ä¸æ”¯æŒ env() æ—¶ç”Ÿæ•ˆ */
@supports not (padding: env(safe-area-inset-bottom)) {
  .chat-v2 .chat-history-viewport {
    padding-bottom: calc(var(--unified-input-docked-height, 120px) + var(--android-safe-area-bottom, 15px) + 56px + 16px) !important;
  }
}
