# é”™é¢˜ç®¡ç†ç³»ç»Ÿ - é¡¹ç›®æ–‡æ¡£

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
5. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
6. [APIæ–‡æ¡£](#apiæ–‡æ¡£)
7. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
8. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
9. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## é¡¹ç›®æ¦‚è¿°

### ç®€ä»‹
é”™é¢˜ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸ºè€ƒç ”å­¦ç”Ÿè®¾è®¡çš„æ™ºèƒ½å­¦ä¹ è¾…åŠ©å·¥å…·ï¼Œæ”¯æŒå¤šå­¦ç§‘é”™é¢˜ç®¡ç†ã€AIæ™ºèƒ½åˆ†æã€å­¦ä¹ è¿›åº¦è·Ÿè¸ªç­‰åŠŸèƒ½ã€‚

### ä¸»è¦åŠŸèƒ½
- ğŸ“š **å¤šå­¦ç§‘æ”¯æŒ**ï¼šæ•°å­¦ã€è‹±è¯­ã€æ”¿æ²»ã€ä¸“ä¸šè¯¾
- ğŸ¤– **AIæ™ºèƒ½åˆ†æ**ï¼šé”™è¯¯åŸå› åˆ†æã€è§£é¢˜æ€è·¯ç”Ÿæˆã€çŸ¥è¯†ç‚¹æå–
- ğŸ“· **OCRè¯†åˆ«**ï¼šæ”¯æŒæ‹ç…§å½•å…¥é¢˜ç›®
- ğŸ“Š **æ·±åº¦åˆ†æ**ï¼šå­¦ä¹ æ¨¡å¼è¯†åˆ«ã€è–„å¼±ç‚¹åˆ†æã€ä¸ªæ€§åŒ–å»ºè®®
- ğŸ“ˆ **è¿›åº¦è·Ÿè¸ª**ï¼šå¤ä¹ è®°å½•ã€æŒæ¡åº¦è¯„ä¼°ã€å­¦ä¹ æ›²çº¿
- ğŸ·ï¸ **æ ‡ç­¾ç®¡ç†**ï¼šè‡ªå®šä¹‰æ ‡ç­¾ã€å¿«é€Ÿåˆ†ç±»æ£€ç´¢

### ç³»ç»Ÿç‰¹ç‚¹
- **å¾®æœåŠ¡æ¶æ„**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- **å¼‚æ­¥å¤„ç†**ï¼šé«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶ï¼Œæå‡å“åº”é€Ÿåº¦
- **ç±»å‹å®‰å…¨**ï¼šå‰åç«¯å…¨é¢ç±»å‹æ£€æŸ¥
- **æœ¬åœ°ä¼˜å…ˆ**ï¼šæ”¯æŒå®Œå…¨æœ¬åœ°è¿è¡Œï¼Œä¿æŠ¤éšç§
- **çµæ´»éƒ¨ç½²**ï¼šæ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯åº”ç”¨ (Vue.js)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   API Gateway (FastAPI)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI APIç®¡ç†   â”‚   é”™é¢˜ç®¡ç†    â”‚   å›é¡¾åˆ†æ    â”‚  æ–‡ä»¶æœåŠ¡  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å…±äº«ç»„ä»¶å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æ•°æ®åº“ (PostgreSQL/SQLite)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡ä¾èµ–å…³ç³»
```
æ–‡ä»¶æœåŠ¡ (ç‹¬ç«‹)
AIç®¡ç†æœåŠ¡ (ç‹¬ç«‹)
é”™é¢˜æœåŠ¡ â†’ AIç®¡ç†æœåŠ¡ã€æ–‡ä»¶æœåŠ¡
å›é¡¾åˆ†ææœåŠ¡ â†’ AIç®¡ç†æœåŠ¡ã€é”™é¢˜æœåŠ¡
```

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **æ¡†æ¶**: FastAPI (å¼‚æ­¥Webæ¡†æ¶)
- **æ•°æ®åº“**: 
  - å¼€å‘ç¯å¢ƒ: SQLite
  - ç”Ÿäº§ç¯å¢ƒ: PostgreSQL
- **ORM**: SQLAlchemy 2.0 (å¼‚æ­¥)
- **éªŒè¯**: Pydantic
- **AIé›†æˆ**: 
  - OpenAI API
  - Anthropic Claude API
  - Google Gemini API
- **å¯¹è±¡å­˜å‚¨**: MinIO
- **æ—¥å¿—**: structlog
- **æµ‹è¯•**: pytest + pytest-asyncio

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**: Vue.js 3 (Vue ^3.3.11)
- **è¯­è¨€**: JavaScript / TypeScript (Vue 3 with Vite, tsconfig.json exists)
- **UIåº“**: Element Plus (^2.4.3)
- **çŠ¶æ€ç®¡ç†**: Pinia (^2.1.7)
- **è·¯ç”±**: Vue Router 4 (^4.2.5)
- **æ„å»ºå·¥å…·**: Vite (^5.0.8)

### éƒ¨ç½²æŠ€æœ¯
- **å®¹å™¨åŒ–**: Docker
- **ç¼–æ’**: Docker Compose
- **åå‘ä»£ç†**: Nginx (å¯é€‰)

## ç›®å½•ç»“æ„

```
é‡æ„ç³»ç»Ÿ/
â”œâ”€â”€ backend/                      # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.py                  # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”‚   â”œâ”€â”€ check_system.py         # ç³»ç»Ÿæ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ shared/                 # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ models/            # åŸºç¡€æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ services/              # å¾®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ai_api_manager/    # AI APIç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ problem_service/   # é”™é¢˜ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ review_service/    # å›é¡¾åˆ†ææœåŠ¡
â”‚   â”‚   â””â”€â”€ file_service/      # æ–‡ä»¶æœåŠ¡
â”‚   â””â”€â”€ infrastructure/        # åŸºç¡€è®¾æ–½
â”‚       â””â”€â”€ database/          # æ•°æ®åº“ç›¸å…³
â”‚           â”œâ”€â”€ migrations/    # æ•°æ®åº“è¿ç§»
â”‚           â””â”€â”€ migrate.py     # è¿ç§»è„šæœ¬
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.html             # å…¥å£HTMLæ–‡ä»¶
â”‚   â”œâ”€â”€ package.json           # npmé…ç½®
â”‚   â”œâ”€â”€ package-lock.json      # npmé”æ–‡ä»¶
â”‚   â”œâ”€â”€ tsconfig.json          # TypeScripté…ç½®
â”‚   â”œâ”€â”€ vite.config.js         # Viteé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ src/                   # æºä»£ç 
â”‚       â”œâ”€â”€ App.tsx              # (è‹¥App.vueä¸ºä¸»è¦å…¥å£åˆ™æ­¤æ–‡ä»¶å¯èƒ½æœªä½¿ç”¨æˆ–ä¸ºè¾…åŠ©)
â”‚       â”œâ”€â”€ App.vue              # ä¸»è¦Vueåº”ç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ main.js              # åº”ç”¨å…¥å£ (Vue)
â”‚       â”œâ”€â”€ api/                 # APIè°ƒç”¨æ¨¡å—
â”‚       â”‚   â””â”€â”€ statistics.js
â”‚       â”œâ”€â”€ components/          # Vueç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ AIReviewSuggestion.vue
â”‚       â”‚   â””â”€â”€ ProblemStatistics.vue
â”‚       â”œâ”€â”€ layouts/             # å¸ƒå±€ç»„ä»¶
â”‚       â”‚   â””â”€â”€ MainLayout.vue
â”‚       â”œâ”€â”€ router/              # Vueè·¯ç”±é…ç½®
â”‚       â”‚   â””â”€â”€ index.js
â”‚       â”œâ”€â”€ stores/              # PiniaçŠ¶æ€ç®¡ç†
â”‚       â”‚   â””â”€â”€ auth.js
â”‚       â”œâ”€â”€ styles/              # æ ·å¼æ–‡ä»¶
â”‚       â”‚   â””â”€â”€ index.css
â”‚       â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚       â”‚   â””â”€â”€ api.js
â”‚       â””â”€â”€ views/               # é¡µé¢è§†å›¾ (Vue)
â”‚           â”œâ”€â”€ Dashboard.vue
â”‚           â”œâ”€â”€ ai/
â”‚           â”‚   â”œâ”€â”€ AIModelList.vue
â”‚           â”‚   â””â”€â”€ AIStats.vue
â”‚           â”œâ”€â”€ analyses/
â”‚           â”‚   â”œâ”€â”€ AnalysisCreate.vue
â”‚           â”‚   â”œâ”€â”€ AnalysisDetail.vue
â”‚           â”‚   â””â”€â”€ AnalysisList.vue
â”‚           â””â”€â”€ problems/
â”‚               â”œâ”€â”€ ProblemCreate.vue
â”‚               â”œâ”€â”€ ProblemDetail.vue
â”‚               â”œâ”€â”€ ProblemEdit.vue
â”‚               â””â”€â”€ ProblemList.vue
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”œâ”€â”€ tests/                     # æµ‹è¯•
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’
â”œâ”€â”€ Makefile                   # æ„å»ºè„šæœ¬
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

## æ ¸å¿ƒæ¨¡å—

### 1. AI APIç®¡ç†æœåŠ¡
**åŠŸèƒ½**ï¼šç»Ÿä¸€ç®¡ç†å¤šä¸ªAIæä¾›å•†çš„APIè°ƒç”¨

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `AIRouter`: æ™ºèƒ½è·¯ç”±ï¼Œæ ¹æ®ä»»åŠ¡ç±»å‹å’Œæ¨¡å‹å¯ç”¨æ€§åˆ†é…è¯·æ±‚
- `ProviderManager`: ç®¡ç†ä¸åŒAIæä¾›å•†çš„å®ç°
- `HealthChecker`: ç›‘æ§AIæœåŠ¡å¥åº·çŠ¶æ€
- `LoadBalancer`: è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»

**æ”¯æŒçš„AIä»»åŠ¡**ï¼š
- é”™é¢˜åˆ†æ
- OCRè¯†åˆ«
- çŸ¥è¯†ç‚¹æå–
- å­¦ä¹ å»ºè®®ç”Ÿæˆ

### 2. é”™é¢˜ç®¡ç†æœåŠ¡
**åŠŸèƒ½æ¦‚è¿°**ï¼šæä¾›é”™é¢˜å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬é”™é¢˜çš„å½•å…¥ã€ç¼–è¾‘ã€ç»„ç»‡ã€AIæ™ºèƒ½åˆ†æã€å¤ä¹ æ”¯æŒã€æŸ¥è¯¢ç»Ÿè®¡ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

**è¯¦ç»†åŠŸèƒ½ç‚¹**ï¼š

1.  **é”™é¢˜å½•å…¥ (Problem Entry)**:
    *   **æ‰‹åŠ¨å½•å…¥**: ç”¨æˆ·é€šè¿‡è¡¨å•å¡«å†™é”™é¢˜çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¢˜ç›®æ ‡é¢˜ã€å†…å®¹ï¼ˆæ”¯æŒå¯Œæ–‡æœ¬ï¼‰ã€å­¦ç§‘ã€åˆ†ç±»ã€ç­”æ¡ˆã€é”™è¯¯åˆ†æã€çŸ¥è¯†ç‚¹ã€æ ‡ç­¾ç­‰ã€‚
    *   **å›¾ç‰‡å½•å…¥ä¸OCRè¯†åˆ«**:
        *   æ”¯æŒä¸Šä¼ é¢˜ç›®å›¾ç‰‡ï¼ˆé€šè¿‡ä¸ **æ–‡ä»¶æœåŠ¡** äº¤äº’å­˜å‚¨å›¾ç‰‡ï¼‰ã€‚
        *   è°ƒç”¨ **AI APIç®¡ç†æœåŠ¡** å¯¹å›¾ç‰‡è¿›è¡ŒOCRè¯†åˆ«ï¼Œæå–é¢˜ç›®æ–‡æœ¬ï¼Œè‡ªåŠ¨å¡«å……åˆ°é¢˜ç›®å†…å®¹å­—æ®µã€‚
        *   ç”¨æˆ·å¯å¯¹OCRç»“æœè¿›è¡Œæ‰‹åŠ¨æ ¡å¯¹å’Œç¼–è¾‘ã€‚
    *   **æ‰¹é‡å¯¼å…¥**:
        *   æ”¯æŒä»ç‰¹å®šæ ¼å¼æ–‡ä»¶ï¼ˆå¦‚CSV, JSONï¼‰æ‰¹é‡å¯¼å…¥é”™é¢˜ã€‚
        *   å¯ä½¿ç”¨é¢„å®šä¹‰çš„ `ProblemTemplate` (é¢˜ç›®æ¨¡æ¿) æŒ‡å¯¼å¯¼å…¥è¿‡ç¨‹ï¼Œç¡®ä¿æ•°æ®ç»“æ„ä¸€è‡´æ€§ã€‚

2.  **é”™é¢˜ç»„ç»‡ä¸ç¼–è¾‘ (Problem Organization & Editing)**:
    *   **ä¿¡æ¯ç¼–è¾‘**: æä¾›å¯¹é”™é¢˜æ‰€æœ‰å­—æ®µçš„å®Œæ•´ç¼–è¾‘åŠŸèƒ½ã€‚
    *   **ç»“æ„åŒ–ç®¡ç†**:
        *   é€šè¿‡ `subject` (å­¦ç§‘) è¿›è¡Œä¸€çº§åˆ†ç±»ã€‚
        *   é€šè¿‡ `ProblemCategory` (é¢˜ç›®åˆ†ç±») å®ç°å¤šçº§ã€ç²¾ç»†åŒ–çš„åˆ†ç±»ç®¡ç†ã€‚
        *   é€šè¿‡ `ProblemTag` (é¢˜ç›®æ ‡ç­¾) ä¸ºé”™é¢˜æ‰“ä¸Šçµæ´»çš„æ ‡ç­¾ï¼Œä¾¿äºæ£€ç´¢å’Œå½’çº³ã€‚
    *   **éš¾åº¦ä¸æŒæ¡åº¦**:
        *   `difficulty_level`: ç”¨æˆ·å¯è®¾å®šæˆ–ç”±AIè¾…åŠ©è¯„ä¼°é¢˜ç›®çš„éš¾åº¦ç­‰çº§ã€‚
        *   `mastery_level`: è®°å½•å¯¹é”™é¢˜çš„æŒæ¡ç¨‹åº¦ï¼Œé€šå¸¸åœ¨å¤ä¹ åæ›´æ–°ã€‚

3.  **AIè¾…åŠ©åŠŸèƒ½ (AI-Assisted Features)** (é€šè¿‡ **AI APIç®¡ç†æœåŠ¡** å®ç°):
    *   **æ™ºèƒ½çŸ¥è¯†ç‚¹æå–**: æ ¹æ®é¢˜ç›®å†…å®¹è‡ªåŠ¨åˆ†æå¹¶æå–ç›¸å…³çš„ `knowledge_points`ã€‚
    *   **é”™è¯¯åŸå› åˆ†æ**: åŸºäºç”¨æˆ·ç­”æ¡ˆå’Œæ­£ç¡®ç­”æ¡ˆï¼ŒAIè‡ªåŠ¨ç”Ÿæˆ `error_analysis`ï¼Œå¸®åŠ©ç†è§£é”™è¯¯æœ¬è´¨ã€‚
    *   **è§£é¢˜æ€è·¯ç”Ÿæˆ**: AIå¯ä»¥è¾…åŠ©ç”Ÿæˆæˆ–å®Œå–„é¢˜ç›®çš„ `solution`ã€‚
    *   **AIå»ºè®®åˆ†ç±» (AI-Suggested Category)**: AIå¯ä»¥æ ¹æ®é¢˜ç›®å†…å®¹å’Œå­¦ç§‘ï¼Œè‡ªåŠ¨åˆ†æå¹¶å»ºè®®ä¸€ä¸ªæœ€åˆé€‚çš„é¢˜ç›®ç»†åˆ†åˆ†ç±» (`suggested_category`)ã€‚ç³»ç»Ÿåœ¨åˆ†æåä¼šå°†æ­¤å»ºè®®åˆ†ç±»æ›´æ–°åˆ°é”™é¢˜çš„ `category` å­—æ®µï¼Œå¹¶ç›¸åº”è°ƒæ•´åˆ†ç±»çš„ä½¿ç”¨è®¡æ•°ã€‚
    *   **ç›¸ä¼¼é¢˜ç›®æ¨è**: (é«˜çº§åŠŸèƒ½) AIåˆ†æå½“å‰é”™é¢˜ç‰¹å¾ï¼Œæ¨èçŸ¥è¯†ç‚¹æˆ–é¢˜å‹ç›¸ä¼¼çš„å…¶ä»–é¢˜ç›®ï¼Œç”¨äºå·©å›ºç»ƒä¹ ã€‚
    *   **é¢˜ç›®ä¿¡æ¯è¡¥å…¨**: AIå¯æ ¹æ®é¢˜ç›®å†…å®¹å°è¯•è‡ªåŠ¨å¡«å……æ ‡ç­¾ã€éš¾åº¦ç­‰ä¿¡æ¯ (åˆ†ç±»å»ºè®®è§ä¸Šä¸€æ¡)ã€‚

4.  **å¤ä¹ æµç¨‹æ”¯æŒ (Review Process Support)**:
    *   **å¤ä¹ è®°å½•**: ç”¨æˆ·æ¯æ¬¡å¤ä¹ åï¼Œç³»ç»Ÿåˆ›å»ºä¸€æ¡ `ReviewRecord`ï¼Œè®°å½•å¤ä¹ ç»“æœã€ç”¨æ—¶ã€ç¬”è®°ç­‰ã€‚
    *   **çŠ¶æ€æ›´æ–°**: å¤ä¹ åï¼Œè‡ªåŠ¨æ›´æ–°å¯¹åº” `Problem` çš„ `mastery_level` (æŒæ¡ç¨‹åº¦)ã€`review_count` (å¤ä¹ æ¬¡æ•°) å’Œ `last_review_at` (æœ€åå¤ä¹ æ—¶é—´)ã€‚æŒæ¡åº¦çš„æ›´æ–°å¯åŸºäºå¤ä¹ ç»“æœï¼Œæˆ–ç»“åˆè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ç­‰ç®—æ³•ã€‚
    *   **å¤ä¹ è®¡åˆ’é›†æˆ**: (å¯ä¸ **å›é¡¾åˆ†ææœåŠ¡** è”åŠ¨) æ ¹æ®é”™é¢˜çš„æŒæ¡ç¨‹åº¦å’Œå¤ä¹ å†å²ï¼Œè¾…åŠ©ç”Ÿæˆå¤ä¹ è®¡åˆ’ï¼Œæé†’ç”¨æˆ·åœ¨æœ€ä½³æ—¶é—´ç‚¹å¤ä¹ ã€‚

5.  **æŸ¥è¯¢ä¸å±•ç¤º (Query & Display)**:
    *   **å¤šç»´åº¦ç­›é€‰**: æ”¯æŒæŒ‰å­¦ç§‘ã€åˆ†ç±»ã€æ ‡ç­¾ã€éš¾åº¦ã€æŒæ¡åº¦ã€åˆ›å»ºæ—¥æœŸã€å…³é”®å­—ç­‰å¤šç§æ¡ä»¶ç»„åˆæŸ¥è¯¢ã€‚
    *   **ç»“æœæ’åº**: æ”¯æŒæŒ‰åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€éš¾åº¦ã€æŒæ¡åº¦ç­‰å­—æ®µæ’åºã€‚
    *   **åˆ†é¡µå±•ç¤º**: å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåˆ†é¡µï¼Œæé«˜åŠ è½½æ•ˆç‡ã€‚
    *   **é”™é¢˜è¯¦æƒ…**: æ¸…æ™°å±•ç¤ºé”™é¢˜çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¢˜ç›®å†…å®¹ã€å›¾ç‰‡ã€ç­”æ¡ˆã€åˆ†æã€çŸ¥è¯†ç‚¹ã€æ ‡ç­¾ã€å¤ä¹ å†å²ç­‰ã€‚

6.  **æ•°æ®ç®¡ç† (Data Management)**:
    *   **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒå°†é”™é¢˜æ•°æ®å¯¼å‡ºä¸ºå¸¸è§æ ¼å¼ï¼ˆå¦‚JSON, CSV, PDFï¼‰ï¼Œæ–¹ä¾¿å¤‡ä»½æˆ–ç¦»çº¿å­¦ä¹ ã€‚
    -   **æ‰¹é‡æ“ä½œ**: æ”¯æŒå¯¹å¤šä¸ªé”™é¢˜è¿›è¡Œæ‰¹é‡åˆ é™¤ã€æ‰¹é‡æ·»åŠ æ ‡ç­¾ã€æ‰¹é‡AIé‡æ–°åˆ†æç­‰æ“ä½œã€‚

**æ ¸å¿ƒæ¨¡å‹**ï¼š

è¯¦ç»†æ¨¡å‹å®šä¹‰è¯·å‚è€ƒ `backend/services/problem_service/models.py`ã€‚

- **`Problem`**: é”™é¢˜æ ¸å¿ƒå®ä½“ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦å­—æ®µï¼š
    - `id`: UUID, ä¸»é”®
    - `title`: String(200), é¢˜ç›®æ ‡é¢˜
    - `content`: Text, é¢˜ç›®å†…å®¹
    - `subject`: Enum(Subject), å­¦ç§‘ (æ•°å­¦, è‹±è¯­, æ”¿æ²», ä¸“ä¸šè¯¾)
    - `category`: String(100), é¢˜ç›®åˆ†ç±» (å¯é€‰, å¯ç”±ç”¨æˆ·æŒ‡å®šæˆ–AIåˆ†æåå»ºè®®)
    - `source`: String(200), é¢˜ç›®æ¥æº (å¯é€‰)
    - `year`: Integer, å¹´ä»½ (å¯é€‰)
    - `error_analysis`: Text, é”™è¯¯åˆ†æ (å¯é€‰)
    - `user_answer`: Text, ç”¨æˆ·ç­”æ¡ˆ (å¯é€‰)
    - `correct_answer`: Text, æ­£ç¡®ç­”æ¡ˆ (å¯é€‰)
    - `solution`: Text, è§£é¢˜æ€è·¯ (å¯é€‰)
    - `ai_analysis`: JSON, AIåˆ†æçš„å®Œæ•´ç»“æœ (JSON, å¯é€‰, åŒ…å«çŸ¥è¯†ç‚¹ã€é”™è¯¯åˆ†æã€å»ºè®®åˆ†ç±»ç­‰)
    - `knowledge_points`: JSON (List[str]), çŸ¥è¯†ç‚¹åˆ—è¡¨
    - `difficulty_level`: Integer, éš¾åº¦ç­‰çº§ (1-5, é»˜è®¤3)
    - `image_urls`: JSON (List[str]), é¢˜ç›®å›¾ç‰‡URLåˆ—è¡¨
    - `ocr_result`: Text, OCRè¯†åˆ«ç»“æœ (å¯é€‰)
    - `review_count`: Integer, å¤ä¹ æ¬¡æ•° (é»˜è®¤0)
    - `last_review_at`: DateTime, æœ€åå¤ä¹ æ—¶é—´ (å¯é€‰)
    - `mastery_level`: Float, æŒæ¡ç¨‹åº¦ (0.0-1.0, é»˜è®¤0.0)
    - `tags`: JSON (List[str]), æ ‡ç­¾åˆ—è¡¨
    - `notes`: Text, ç”¨æˆ·å¤‡æ³¨ (å¯é€‰)
    - `created_at`, `updated_at`: DateTime, åˆ›å»ºå’Œæ›´æ–°æ—¶é—´
    - `deleted_at`: DateTime, è½¯åˆ é™¤æ ‡è®° (å¯é€‰)

- **`ReviewRecord`**: å¤ä¹ è®°å½•å®ä½“ï¼Œå…³è”åˆ°`Problem`ï¼š
    - `id`: UUID, ä¸»é”®
    - `problem_id`: String(36), å…³è”çš„é”™é¢˜ID
    - `review_result`: String(20), å¤ä¹ ç»“æœ (e.g., "correct", "incorrect", "partial") (å¯é€‰)
    - `confidence_level`: Integer, ä¿¡å¿ƒç­‰çº§ (1-5) (å¯é€‰)
    - `time_spent`: Integer, èŠ±è´¹æ—¶é—´(ç§’) (å¯é€‰)
    - `notes`: Text, å¤ä¹ ç¬”è®° (å¯é€‰)
    - `ai_feedback`: JSON, AIç»™å‡ºçš„åé¦ˆ (å¯é€‰)
    - `created_at`, `updated_at`: DateTime

- **`ProblemTemplate`**: é¢˜ç›®æ¨¡æ¿å®ä½“ï¼Œç”¨äºæ‰¹é‡å¯¼å…¥ç­‰åœºæ™¯ï¼š
    - `id`: UUID, ä¸»é”®
    - `name`: String(100), æ¨¡æ¿åç§°
    - `subject`: Enum(Subject), å­¦ç§‘
    - `category`: String(100), é¢˜ç›®åˆ†ç±» (å¯é€‰)
    - `template_content`: JSON, æ¨¡æ¿å†…å®¹ç»“æ„
    - `example_content`: JSON, ç¤ºä¾‹å†…å®¹ (å¯é€‰)
    - `description`: Text, æè¿° (å¯é€‰)
    - `usage_count`: Integer, ä½¿ç”¨æ¬¡æ•°
    - `tags`: JSON (List[str]), æ ‡ç­¾åˆ—è¡¨
    - `created_at`, `updated_at`: DateTime

- **`ProblemTag`**: é¢˜ç›®æ ‡ç­¾å®ä½“ï¼š
    - `id`: UUID, ä¸»é”®
    - `name`: String(50), æ ‡ç­¾åç§° (å”¯ä¸€)
    - `description`: Text, æè¿° (å¯é€‰)
    - `color`: String(20), æ ‡ç­¾é¢œè‰² (å¯é€‰)
    - `usage_count`: Integer, ä½¿ç”¨æ¬¡æ•°
    - `created_at`, `updated_at`: DateTime

- **`ProblemCategory`**: é¢˜ç›®åˆ†ç±»å®ä½“ï¼Œæ”¯æŒå±‚çº§ç»“æ„ï¼š
    - `id`: UUID, ä¸»é”®
    - `name`: String(100), åˆ†ç±»åç§°
    - `subject`: Enum(Subject), å­¦ç§‘
    - `parent_id`: String(36), çˆ¶åˆ†ç±»ID (å¯é€‰, ç”¨äºå±‚çº§)
    - `description`: Text, æè¿° (å¯é€‰)
    - `order`: Integer, æ’åºå­—æ®µ
    - `usage_count`: Integer, ä½¿ç”¨æ¬¡æ•°
    - `created_at`, `updated_at`: DateTime

**æ ¸å¿ƒä¸šåŠ¡æµç¨‹ç¤ºä¾‹**:

1.  **æ‰‹åŠ¨åˆ›å»ºæ–°é”™é¢˜æµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·åœ¨åˆ›å»ºé¡µé¢å¡«å†™è¡¨å•ï¼ˆæ ‡é¢˜ã€å­¦ç§‘ã€é¢˜ç›®å†…å®¹ç­‰ï¼‰ï¼Œå¯é€‰ä¸Šä¼ å›¾ç‰‡ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   æ¥æ”¶åˆ›å»ºè¯·æ±‚ã€‚è‹¥æœ‰å›¾ç‰‡ï¼Œå…ˆè°ƒç”¨ `file_service` ä¸Šä¼ å›¾ç‰‡ï¼Œè·å–å›¾ç‰‡URLå­˜å…¥ `image_urls`ã€‚
        *   ä¿å­˜åŸºç¡€ `Problem` ä¿¡æ¯åˆ°æ•°æ®åº“ã€‚
        *   ï¼ˆå¯é€‰ï¼Œæ ¹æ®é…ç½®æˆ–ç”¨æˆ·é€‰æ‹©ï¼‰è°ƒç”¨ `ai_api_manager` å¯¹é¢˜ç›®å†…å®¹è¿›è¡ŒAIåˆ†æï¼ˆçŸ¥è¯†ç‚¹æå–ã€åˆæ­¥é”™è¯¯åˆ†æç­‰ï¼‰ã€‚
        *   å°†AIåˆ†æç»“æœæ›´æ–°åˆ°è¯¥ `Problem` è®°å½•çš„ `ai_analysis`, `knowledge_points` ç­‰å­—æ®µã€‚
        *   è¿”å›åˆ›å»ºæˆåŠŸåŠé”™é¢˜ä¿¡æ¯ç»™å‰ç«¯ã€‚

2.  **OCRå›¾ç‰‡å½•å…¥é”™é¢˜æµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·ä¸Šä¼ é¢˜ç›®å›¾ç‰‡ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   è°ƒç”¨ `file_service` å­˜å‚¨å›¾ç‰‡ã€‚
        *   è°ƒç”¨ `ai_api_manager` çš„OCRåŠŸèƒ½å¤„ç†å›¾ç‰‡ï¼Œè·å–è¯†åˆ«æ–‡æœ¬ã€‚
        *   å°†OCRæ–‡æœ¬é¢„å¡«å……åˆ°æ–°é¢˜ç›®çš„å†…å®¹å­—æ®µï¼Œè¿”å›ç»™å‰ç«¯ä¾›ç”¨æˆ·ç¡®è®¤å’Œç¼–è¾‘ã€‚
        *   ç”¨æˆ·ç¡®è®¤å¹¶æäº¤åï¼ŒæŒ‰æ‰‹åŠ¨åˆ›å»ºæµç¨‹ç»§ç»­ï¼ˆå¯å†æ¬¡è§¦å‘æ›´è¯¦ç»†çš„AIåˆ†æï¼‰ã€‚

3.  **å¤ä¹ é”™é¢˜æµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·é€‰æ‹©ä¸€é“é”™é¢˜è¿›è¡Œå¤ä¹ ï¼Œæäº¤å¤ä¹ ç»“æœï¼ˆå¦‚æ˜¯å¦ç­”å¯¹ã€æŒæ¡ç¨‹åº¦åé¦ˆã€ç¬”è®°ï¼‰ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   åˆ›å»ºä¸€æ¡æ–°çš„ `ReviewRecord`ï¼Œè®°å½•æœ¬æ¬¡å¤ä¹ è¯¦æƒ…ã€‚
        *   æ ¹æ®å¤ä¹ ç»“æœå’Œæ—¢å®šç®—æ³•ï¼ˆæˆ–ç”¨æˆ·ç›´æ¥è¾“å…¥çš„æŒæ¡åº¦ï¼‰ï¼Œæ›´æ–° `Problem` çš„ `mastery_level`, `review_count`, `last_review_at`ã€‚
        *   ï¼ˆå¯é€‰ï¼‰è‹¥ä¸ **å›é¡¾åˆ†ææœåŠ¡** é›†æˆï¼Œå¯èƒ½éœ€è¦é€šçŸ¥è¯¥æœåŠ¡æ›´æ–°å¤ä¹ è®¡åˆ’ã€‚

4.  **å¯¹å·²æœ‰é”™é¢˜è¯·æ±‚AIåˆ†ææµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·é€‰æ‹©æŸæ¡é”™é¢˜ï¼Œç‚¹å‡»â€œAIåˆ†æâ€æŒ‰é’®ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   è·å–è¯¥é”™é¢˜çš„ç°æœ‰æ•°æ®ï¼ˆå†…å®¹ã€ç­”æ¡ˆç­‰ï¼‰ã€‚
        *   è°ƒç”¨ `ai_api_manager` æ‰§è¡ŒæŒ‡å®šçš„AIåˆ†æä»»åŠ¡ï¼ˆå¦‚é”™è¯¯åŸå› æ·±åº¦åˆ†æã€è§£é¢˜æ€è·¯ä¼˜åŒ–ç­‰ï¼‰ã€‚
        *   æ¥æ”¶AIè¿”å›çš„åˆ†æç»“æœï¼Œæ›´æ–°è¯¥ `Problem` çš„ `ai_analysis` æˆ–å…¶ä»–ç›¸å…³å­—æ®µã€‚
        *   è¿”å›æ›´æ–°åçš„é”™é¢˜ä¿¡æ¯ç»™å‰ç«¯ã€‚

**ä¸å…¶ä»–æ¨¡å—çš„äº¤äº’**:

-   **AI APIç®¡ç†æœåŠ¡**:
    *   **è°ƒç”¨æ–¹**: `problem_service` åœ¨éœ€è¦AIèƒ½åŠ›æ—¶ï¼ˆå¦‚OCRã€çŸ¥è¯†ç‚¹æå–ã€é”™è¯¯åˆ†æã€å†…å®¹ç”Ÿæˆï¼‰è°ƒç”¨æ­¤æœåŠ¡ã€‚
    *   **äº¤äº’å†…å®¹**: ä¼ é€’é¢˜ç›®æ–‡æœ¬ã€å›¾ç‰‡æ•°æ®ã€åˆ†ææŒ‡ä»¤ç­‰ï¼›æ¥æ”¶AIå¤„ç†ç»“æœã€‚
-   **æ–‡ä»¶æœåŠ¡**:
    *   **è°ƒç”¨æ–¹**: `problem_service` åœ¨å¤„ç†å¸¦å›¾ç‰‡çš„é”™é¢˜æ—¶è°ƒç”¨æ­¤æœåŠ¡ã€‚
    *   **äº¤äº’å†…å®¹**: ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼›è·å–å›¾ç‰‡çš„å­˜å‚¨URLæˆ–å¼•ç”¨ã€‚`problem_service` è‡ªèº«å­˜å‚¨è¿™äº›URLã€‚
-   **å›é¡¾åˆ†ææœåŠ¡ (Review Service)**:
    *   **äº¤äº’æ–¹å¼**: `problem_service` å¯èƒ½åœ¨é”™é¢˜åˆ›å»ºã€æ›´æ–°æˆ–å¤ä¹ è®°å½•äº§ç”Ÿæ—¶ï¼Œé€šçŸ¥ `review_service` ç›¸å…³äº‹ä»¶ï¼Œä»¥ä¾¿åè€…æ›´æ–°å­¦ä¹ æ¨¡å‹ã€è°ƒæ•´å¤ä¹ è®¡åˆ’ã€‚`problem_service` è‡ªèº«è´Ÿè´£åŸºç¡€çš„å¤ä¹ è®°å½•å’ŒçŠ¶æ€æ›´æ–°ã€‚
-   **ç»Ÿè®¡æœåŠ¡ (Statistics Service)**:
    *   **æ•°æ®æº**: `problem_service` å­˜å‚¨çš„é”™é¢˜æ•°æ® (`Problem` è¡¨) å’Œå¤ä¹ è®°å½•æ•°æ® (`ReviewRecord` è¡¨) æ˜¯ `statistics_service` è¿›è¡Œç»Ÿè®¡åˆ†æçš„åŸºç¡€ã€‚`statistics_service` é€šå¸¸ä¼šç›´æ¥æŸ¥è¯¢è¿™äº›æ•°æ®æˆ–é€šè¿‡APIè·å–èšåˆæ•°æ®ã€‚

**ä¸»è¦æ¥å£ (æ¦‚è§ˆï¼Œè¯¦ç»†è§APIæ–‡æ¡£éƒ¨åˆ†)**ï¼š
- **é”™é¢˜ (Problems)**:
    - `POST /`: åˆ›å»ºé”™é¢˜ (æ”¯æŒå›¾ç‰‡ã€AIè‡ªåŠ¨åˆ†æé€‰é¡¹)ã€‚
    - `GET /`: è·å–é”™é¢˜åˆ—è¡¨ (æ”¯æŒå¤æ‚æŸ¥è¯¢ã€ç­›é€‰ã€æ’åºã€åˆ†é¡µ)ã€‚
    - `GET /{problem_id}`: è·å–å•ä¸ªé”™é¢˜è¯¦æƒ…ã€‚
    - `PUT /{problem_id}`: æ›´æ–°é”™é¢˜ä¿¡æ¯ã€‚
    - `DELETE /{problem_id}`: åˆ é™¤é”™é¢˜ (è½¯åˆ é™¤)ã€‚
    - `POST /{problem_id}/analyze`: å¯¹æŒ‡å®šé”™é¢˜æ‰§è¡ŒAIåˆ†æã€‚
    - `POST /batch`: æ‰¹é‡å¯¼å…¥é”™é¢˜ã€‚
    - `GET /export`: å¯¼å‡ºé”™é¢˜ (æŸ¥è¯¢å‚æ•°æ§åˆ¶èŒƒå›´å’Œæ ¼å¼)ã€‚
- **å¤ä¹ è®°å½• (Review Records)**:
    - `POST /{problem_id}/reviews`: ä¸ºé”™é¢˜æ·»åŠ å¤ä¹ è®°å½•ã€‚
    - `GET /{problem_id}/reviews`: è·å–æŒ‡å®šé”™é¢˜çš„æ‰€æœ‰å¤ä¹ è®°å½•ã€‚
    - `GET /reviews/{review_id}`: è·å–å•æ¡å¤ä¹ è®°å½•è¯¦æƒ…ã€‚
    - `PUT /reviews/{review_id}`: æ›´æ–°å¤ä¹ è®°å½•ã€‚
    - `DELETE /reviews/{review_id}`: åˆ é™¤å¤ä¹ è®°å½•ã€‚
- **å›¾ç‰‡ä¸OCR**:
    - `POST /ocr`: å¯¹æä¾›çš„å›¾ç‰‡è¿›è¡ŒOCRè¯†åˆ« (å¯é€‰æ‹©æ˜¯å¦è‡ªåŠ¨åˆ›å»ºé¢˜ç›®)ã€‚
    - `POST /upload/image`: ä¸Šä¼ é”™é¢˜å›¾ç‰‡ (å¯é€‰æ‹©æ˜¯å¦è‡ªåŠ¨OCR)ã€‚
- **æ ‡ç­¾ä¸åˆ†ç±»ç®¡ç† (Tags & Categories)**:
    - `GET /tags`: è·å–æ‰€æœ‰å¯ç”¨æ ‡ç­¾ã€‚
    - `POST /tags`: åˆ›å»ºæ–°æ ‡ç­¾ã€‚
    - `GET /categories`: è·å–æ‰€æœ‰é¢˜ç›®åˆ†ç±» (æ”¯æŒå±‚çº§)ã€‚
    - `POST /categories`: åˆ›å»ºæ–°åˆ†ç±»ã€‚
- **ç»Ÿè®¡æ¥å£ (ç”± `problem_service` æä¾›çš„åŸºç¡€ç»Ÿè®¡)**:
    - `GET /stats/overview`: è·å–é”™é¢˜æ€»ä½“ç»Ÿè®¡æ¦‚è§ˆã€‚
    - `GET /stats/knowledge-points`: è·å–çŸ¥è¯†ç‚¹ç›¸å…³çš„ç»Ÿè®¡æ•°æ®ã€‚
    *(æ›´å¤æ‚çš„ç»Ÿè®¡åˆ†æç”±ç‹¬ç«‹çš„ `statistics_service` æä¾›)*

- **å¯¼å‡ºé”™é¢˜æ•°æ®**
    - `GET /export`
    - **æŸ¥è¯¢å‚æ•°**:
        - `subject: Optional[Subject]`
        - `category: Optional[str]`
        - `tags: Optional[List[str]]`
        - `keyword: Optional[str]`
        - `min_difficulty: Optional[int]` (1-5)
        - `max_difficulty: Optional[int]` (1-5)
        - `min_mastery: Optional[float]` (0.0-1.0)
        - `max_mastery: Optional[float]` (0.0-1.0)
        - `sort_by: str` (é»˜è®¤ "created_at")
        - `sort_desc: bool` (é»˜è®¤ `True`)
        - `export_format: ExportFormat` (æšä¸¾: "json", "csv", é»˜è®¤ "json")
    - **å“åº”**:
        - å¦‚æœ `export_format="json"`: `JSONResponse` åŒ…å« `List[ProblemData]`ã€‚
        - å¦‚æœ `export_format="csv"`: `StreamingResponse` CSVæ–‡ä»¶æµã€‚
        - æ–‡ä»¶åå°†åŒ…å«æ—¶é—´æˆ³ï¼Œä¾‹å¦‚ `problems_export_YYYYMMDD_HHMMSS.json`ã€‚

- **æ‰¹é‡æ“ä½œé”™é¢˜**
    - `POST /batch-operate`
    - **è¯·æ±‚ä½“**: `ProblemBatchRequest` schema.
        - `problem_ids: List[str]` (å¿…éœ€, é”™é¢˜IDåˆ—è¡¨, è‡³å°‘1é¡¹)
        - `operation: str` (å¿…éœ€, æ“ä½œç±»å‹, æšä¸¾: "delete", "update", "analyze")
        - `update_data: Optional[Dict[str, Any]]` (å½“ `operation="update"` æ—¶éœ€è¦ï¼Œæä¾›è¦æ›´æ–°çš„å­—æ®µå’Œå€¼ï¼Œç»“æ„ç±»ä¼¼ `ProblemUpdate` ä½†æ›´çµæ´»)
    - **å“åº”**: `BatchOperationResponse` schema.
        - `success: bool`
        - `message: str`
        - `successful_ids: List[str]`
        - `failed_count: int`
        - `errors: List[BatchOperationResultDetail]` (å…¶ä¸­ `BatchOperationResultDetail` åŒ…å« `id` å’Œ `error`)

### 3. å›é¡¾åˆ†ææœåŠ¡
**åŠŸèƒ½**ï¼šæ·±åº¦å­¦ä¹ åˆ†æã€æ¨¡å¼è¯†åˆ«ã€ä¸ªæ€§åŒ–å»ºè®®

**åˆ†æç±»å‹**ï¼š
- æ‰¹é‡é”™é¢˜åˆ†æ
- çŸ¥è¯†ç‚¹ä¸“é¡¹åˆ†æ
- æ—¶é—´æ®µè¶‹åŠ¿åˆ†æ
- ç»¼åˆå­¦ä¹ æŠ¥å‘Š

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- é”™è¯¯æ¨¡å¼è¯†åˆ«
- è–„å¼±é¢†åŸŸå®šä½
- å­¦ä¹ è®¡åˆ’ç”Ÿæˆ
- è¿›åº¦è·Ÿè¸ªå¯¹æ¯”

### 4. æ–‡ä»¶æœåŠ¡
**åŠŸèƒ½**ï¼šæ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ã€è®¿é—®æ§åˆ¶

**ç‰¹æ€§**ï¼š
- æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆMinIO/æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰
- å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–
- è®¿é—®æƒé™æ§åˆ¶
- æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†

## APIæ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://localhost:8000/api/v1`
- **è®¤è¯æ–¹å¼**: æ— éœ€è®¤è¯
- **å“åº”æ ¼å¼**: JSON

### ä¸»è¦æ¥å£

#### é”™é¢˜ç®¡ç†

è¯¦ç»†çš„è¯·æ±‚/å“åº”æ¨¡å‹è¯·å‚è€ƒ `backend/services/problem_service/schemas.py`ã€‚
FastAPI è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ä½äº `/docs`ï¼Œæä¾›äº†æœ€å‡†ç¡®çš„æ¥å£è¯¦æƒ…å’Œæµ‹è¯•åŠŸèƒ½ã€‚

**åŸºç¡€è·¯å¾„**: `/api/v1/problems`

- **åˆ›å»ºé”™é¢˜**
    - `POST /`
    - **è¯·æ±‚ä½“**: `ProblemCreate` schema.
        - `title: str` (å¿…éœ€)
        - `content: str` (å¿…éœ€)
        - `subject: Subject` (å¿…éœ€, æšä¸¾: "math", "english", "politics", "professional")
        - `category: Optional[str]`
        - `source: Optional[str]`
        - `year: Optional[int]`
        - `user_answer: Optional[str]`
        - `correct_answer: Optional[str]`
        - `error_analysis: Optional[str]`
        - `solution: Optional[str]`
        - `tags: List[str]` (é»˜è®¤ç©ºåˆ—è¡¨)
        - `image_urls: List[str]` (é»˜è®¤ç©ºåˆ—è¡¨, é€šå¸¸ç”±åç«¯å¤„ç†å›¾ç‰‡ä¸Šä¼ åå¡«å……)
        - `image_base64: Optional[List[str]]` (ç”¨äºé€šè¿‡base64ä¸Šä¼ å›¾ç‰‡)
        - `notes: Optional[str]`
    - **æŸ¥è¯¢å‚æ•°**:
        - `auto_analyze: bool` (é»˜è®¤ `True`): æ˜¯å¦åœ¨åˆ›å»ºåè‡ªåŠ¨æ‰§è¡ŒAIåˆ†æã€‚
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«åˆ›å»ºçš„ `ProblemData`)ã€‚

- **è·å–é”™é¢˜åˆ—è¡¨ (æ”¯æŒé«˜çº§æŸ¥è¯¢)**
    - `GET /`
    - **æŸ¥è¯¢å‚æ•°**: (åŸºäº `ProblemQuery` schema)
        - `subject: Optional[Subject]`
        - `category: Optional[str]`
        - `tags: Optional[List[str]]` (ä¾‹å¦‚: `tags=é‡ç‚¹&tags=æ˜“é”™`)
        - `keyword: Optional[str]` (æœç´¢æ ‡é¢˜ã€å†…å®¹ã€å¤‡æ³¨)
        - `min_difficulty: Optional[int]` (1-5)
        - `max_difficulty: Optional[int]` (1-5)
        - `min_mastery: Optional[float]` (0.0-1.0)
        - `max_mastery: Optional[float]` (0.0-1.0)
        - `page: int` (é»˜è®¤ 1)
        - `size: int` (é»˜è®¤ 20, æœ€å¤§ 100)
        - `sort_by: str` (é»˜è®¤ "created_at", å¯é€‰: "updated_at", "difficulty_level", "mastery_level", "review_count")
        - `sort_desc: bool` (é»˜è®¤ `True`)
    - **å“åº”**: `ProblemListResponse` (åŒ…å« `data: List[ProblemData]`, `total`, `page`, `size`, `pages`)ã€‚

- **è·å–å•ä¸ªé”™é¢˜è¯¦æƒ…**
    - `GET /{problem_id}`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **å“åº”**: `SingleProblemResponse` (åŒ…å« `ProblemData`)ã€‚

- **æ›´æ–°é”™é¢˜ä¿¡æ¯**
    - `PUT /{problem_id}`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **è¯·æ±‚ä½“**: `ProblemUpdate` schema (æ‰€æœ‰å­—æ®µå¯é€‰).
        - `title: Optional[str]`
        - `content: Optional[str]`
        - `category: Optional[str]`
        - `source: Optional[str]`
        - `year: Optional[int]`
        - `user_answer: Optional[str]`
        - `correct_answer: Optional[str]`
        - `error_analysis: Optional[str]`
        - `solution: Optional[str]`
        - `tags: Optional[List[str]]`
        - `image_urls: Optional[List[str]]` (æ³¨æ„ï¼šé€šå¸¸å›¾ç‰‡ç®¡ç†é€šè¿‡ä¸“é—¨çš„ä¸Šä¼ /åˆ é™¤æ¥å£)
        - `notes: Optional[str]`
        - `mastery_level: Optional[float]` (0.0-1.0)
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«æ›´æ–°åçš„ `ProblemData`)ã€‚

- **åˆ é™¤é”™é¢˜ (è½¯åˆ é™¤)**
    - `DELETE /{problem_id}`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **å“åº”**: `SingleProblemResponse` (ä»…åŒ…å« `success` å’Œ `message`)ã€‚

- **AIåˆ†æé”™é¢˜**
    - `POST /{problem_id}/analyze`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **è¯·æ±‚ä½“**: (å¯é€‰) `ProblemAnalyzeRequest` schema.
        - `regenerate: bool` (é»˜è®¤ `False`, å½“å‰æœåŠ¡å±‚å®ç°æœªç›´æ¥ä½¿ç”¨æ­¤å‚æ•°ï¼Œåˆ†ææ€»æ˜¯åŸºäºæœ€æ–°æ•°æ®)
        - `focus_areas: Optional[List[str]]` (å½“å‰æœåŠ¡å±‚å®ç°æœªç›´æ¥ä½¿ç”¨æ­¤å‚æ•°)
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«æ›´æ–°AIåˆ†æç»“æœåçš„ `ProblemData`ï¼ŒAIåˆ†æç»“æœç°åœ¨ä¹ŸåŒ…æ‹¬å»ºè®®çš„åˆ†ç±» `suggested_category`ï¼Œå¹¶å·²æ›´æ–°åˆ°é”™é¢˜çš„ `category` å­—æ®µï¼Œæˆ–AIåˆ†æå¤±è´¥ä¿¡æ¯)ã€‚

- **OCRè¯†åˆ«å›¾ç‰‡å†…å®¹**
    - `POST /ocr`
    - **è¯·æ±‚ä½“**: `ProblemOCRRequest` schema.
        - `image_base64: Optional[str]` (å›¾ç‰‡çš„Base64ç¼–ç )
        - `image_url: Optional[HttpUrl]` (å›¾ç‰‡çš„URL)
        - `enhance_math: bool` (é»˜è®¤ `True`, æ˜¯å¦å¢å¼ºæ•°å­¦å…¬å¼è¯†åˆ«)
        - `auto_create: bool` (é»˜è®¤ `False`, æ˜¯å¦åœ¨OCRæˆåŠŸåè‡ªåŠ¨åˆ›å»ºé¢˜ç›®)
        - `subject: Optional[Subject]` (å½“ `auto_create` ä¸º `True` æ—¶ï¼Œç”¨äºæŒ‡å®šæ–°é¢˜ç›®çš„å­¦ç§‘)
        - `category: Optional[str]` (å½“ `auto_create` ä¸º `True` æ—¶ï¼Œç”¨äºæŒ‡å®šæ–°é¢˜ç›®çš„åˆ†ç±»)
    - **å“åº”**: `SingleProblemResponse`.
        - å¦‚æœ `auto_create` ä¸º `True` å¹¶æˆåŠŸåˆ›å»ºé¢˜ç›®ï¼Œ`data` å­—æ®µä¸º `ProblemData`ã€‚
        - å¦‚æœä»…OCRï¼Œ`data` å­—æ®µå¯èƒ½åŒ…å« `{"ocr_text": "è¯†åˆ«çš„æ–‡æœ¬"}`ï¼Œæˆ–æ–‡æœ¬åœ¨ `message` ä¸­ã€‚

- **æ‰¹é‡å¯¼å…¥é”™é¢˜**
    - `POST /batch`
    - **è¯·æ±‚ä½“**: `List[ProblemCreate]` (ä¸€ä¸ªåŒ…å«å¤šä¸ª `ProblemCreate` å¯¹è±¡çš„åˆ—è¡¨)
    - **æŸ¥è¯¢å‚æ•°**:
        - `auto_analyze: bool` (é»˜è®¤ `False`): æ˜¯å¦å¯¹æ¯ä¸ªæˆåŠŸå¯¼å…¥çš„é¢˜ç›®è‡ªåŠ¨æ‰§è¡ŒAIåˆ†æã€‚
    - **å“åº”**: `dict` åŒ…å« `success: bool`, `message: str`, å’Œ `data: {total, success, failed, errors, created_ids}`ã€‚

- **ä¸Šä¼ é”™é¢˜å›¾ç‰‡**
    - `POST /upload/image`
    - **è¯·æ±‚ä½“**: `multipart/form-data`
        - `file: UploadFile` (å¿…éœ€, å›¾ç‰‡æ–‡ä»¶)
    - **æŸ¥è¯¢å‚æ•°**:
        - `auto_ocr: bool` (é»˜è®¤ `True`): æ˜¯å¦åœ¨å›¾ç‰‡ä¸Šä¼ æˆåŠŸåè‡ªåŠ¨è¿›è¡ŒOCRè¯†åˆ«ã€‚å¦‚æœOCRé…ç½®ä¸ºè‡ªåŠ¨åˆ›å»ºé¢˜ç›®ï¼Œåˆ™ä¼šå°è¯•åˆ›å»ºã€‚
    - **å“åº”**: `ProblemImageUploadResponse`
        - `success: bool`
        - `message: str`
        - `file_info: Optional[StorageFileUploadResponse]` (æ–‡ä»¶æœåŠ¡è¿”å›çš„æ–‡ä»¶ä¿¡æ¯)
        - `ocr_result: Optional[Dict[str, Any]]` (OCRè¯†åˆ«ç»“æœï¼ŒåŒ…æ‹¬æ˜¯å¦åˆ›å»ºäº†æ–°é¢˜ç›®ç­‰)

- **æ·»åŠ å¤ä¹ è®°å½•**
    - `POST /{problem_id}/reviews`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **è¯·æ±‚ä½“**: `ReviewRecordCreate` schema.
        - `problem_id: str` (é€šå¸¸ç”±è·¯å¾„å‚æ•°å¡«å……ï¼Œè¯·æ±‚ä½“ä¸­å¯å¿½ç•¥æˆ–æ ¡éªŒä¸€è‡´æ€§)
        - `review_result: Optional[str]` (æšä¸¾: "correct", "incorrect", "partial")
        - `confidence_level: Optional[int]` (1-5)
        - `time_spent: Optional[int]` (èŠ±è´¹æ—¶é—´ï¼Œç§’)
        - `notes: Optional[str]`
    - **å“åº”**: `ReviewRecordResponse` (åŒ…å«åˆ›å»ºçš„ `ReviewRecordData`)ã€‚

- **è·å–é”™é¢˜ç»Ÿè®¡æ¦‚è§ˆ**
    - `GET /stats/overview`
    - **å“åº”**: `dict` åŒ…å« `success: bool` å’Œ `data: ProblemStatistics` (åŒ…å«æ€»æ•°ã€å„å­¦ç§‘ã€å„éš¾åº¦ã€å¹³å‡æŒæ¡åº¦ç­‰ç»Ÿè®¡)ã€‚

- **è·å–çŸ¥è¯†ç‚¹ç»Ÿè®¡**
    - `GET /stats/knowledge-points`
    - **å“åº”**: `dict` åŒ…å« `success: bool` å’Œ `data: List[KnowledgePointStats]` (åŒ…å«å„çŸ¥è¯†ç‚¹çš„é¢˜ç›®æ•°ã€å¹³å‡æŒæ¡åº¦ã€å¹³å‡éš¾åº¦)ã€‚

#### é¢˜ç›®æ ‡ç­¾ç®¡ç† (Problem Tags)

**åŸºç¡€è·¯å¾„**: `/api/v1/problem-tags`

- **åˆ›å»ºé¢˜ç›®æ ‡ç­¾**
    - `POST /`
    - **è¯·æ±‚ä½“**: `ProblemTagCreate` schema.
        - `name: str` (å¿…éœ€, æ ‡ç­¾åç§°)
        - `description: Optional[str]`
        - `color: Optional[str]` (ä¾‹å¦‚: "#FF0000")
    - **å“åº”**: `ProblemTagResponse` (åŒ…å«åˆ›å»ºçš„ `ProblemTagData`)ã€‚

- **è·å–é¢˜ç›®æ ‡ç­¾åˆ—è¡¨**
    - `GET /`
    - **æŸ¥è¯¢å‚æ•°**:
        - `page: int` (é»˜è®¤ 1)
        - `size: int` (é»˜è®¤ 100)
    - **å“åº”**: `ProblemTagListResponse` (åŒ…å« `data: List[ProblemTagData]`)ã€‚
        *(æ³¨æ„: `ProblemTagListResponse` schema å½“å‰ä»…åŒ…å« `success` å’Œ `data`ã€‚å¦‚éœ€åˆ†é¡µå…ƒæ•°æ® `total`, `page`, `size`ï¼Œéœ€æ›´æ–° schema)*

- **è·å–å•ä¸ªé¢˜ç›®æ ‡ç­¾**
    - `GET /{tag_id}`
    - **è·¯å¾„å‚æ•°**: `tag_id: str`
    - **å“åº”**: `ProblemTagResponse` (åŒ…å« `ProblemTagData`)ã€‚

- **æ›´æ–°é¢˜ç›®æ ‡ç­¾**
    - `PUT /{tag_id}`
    - **è·¯å¾„å‚æ•°**: `tag_id: str`
    - **è¯·æ±‚ä½“**: `ProblemTagUpdate` schema (æ‰€æœ‰å­—æ®µå¯é€‰).
        - `name: Optional[str]`
        - `description: Optional[str]`
        - `color: Optional[str]`
    - **å“åº”**: `ProblemTagResponse` (åŒ…å«æ›´æ–°åçš„ `ProblemTagData`)ã€‚

- **åˆ é™¤é¢˜ç›®æ ‡ç­¾**
    - `DELETE /{tag_id}`
    - **è·¯å¾„å‚æ•°**: `tag_id: str`
    - **å“åº”**: `ProblemTagResponse` (ä»…åŒ…å« `success` å’Œ `message`)ã€‚
        *(æ³¨æ„: åˆ é™¤æ ‡ç­¾ä¸ä¼šè‡ªåŠ¨ä»é¢˜ç›®ä¸­ç§»é™¤è¯¥æ ‡ç­¾çš„å¼•ç”¨ï¼Œéœ€è°¨æ…æ“ä½œ)*

#### é¢˜ç›®åˆ†ç±»ç®¡ç† (Problem Categories)

**åŸºç¡€è·¯å¾„**: `/api/v1/problem-categories`

- **åˆ›å»ºé¢˜ç›®åˆ†ç±»**
    - `POST /`
    - **è¯·æ±‚ä½“**: `ProblemCategoryCreate` schema.
        - `name: str` (å¿…éœ€, åˆ†ç±»åç§°)
        - `subject: Subject` (å¿…éœ€, å­¦ç§‘)
        - `parent_id: Optional[str]` (çˆ¶åˆ†ç±»IDï¼Œç”¨äºå±‚çº§)
        - `description: Optional[str]`
        - `order: Optional[int]` (æ’åºå­—æ®µ, é»˜è®¤ 0)
    - **å“åº”**: `ProblemCategoryResponse` (åŒ…å«åˆ›å»ºçš„ `ProblemCategoryData`)ã€‚

- **è·å–é¢˜ç›®åˆ†ç±»åˆ—è¡¨**
    - `GET /`
    - **æŸ¥è¯¢å‚æ•°**:
        - `subject: Optional[Subject]` (æŒ‰å­¦ç§‘è¿‡æ»¤)
        - `parent_id: Optional[str]` (é»˜è®¤ "root", å¯ä¸ºçˆ¶IDæˆ– `None` è·å–æ‰å¹³åˆ—è¡¨)
        - `hierarchical: bool` (é»˜è®¤ `True`, å½“ `parent_id="root"` æ—¶å°è¯•è¿”å›å±‚çº§ç»“æ„)
    - **å“åº”**: `ProblemCategoryListResponse` (åŒ…å« `data: List[ProblemCategoryData]`)ã€‚
        - å¦‚æœ `hierarchical=True` ä¸” `parent_id="root"`ï¼Œ`ProblemCategoryData` ä¸­çš„ `children` å­—æ®µä¼šé€’å½’åŒ…å«å­åˆ†ç±»ã€‚

- **è·å–å•ä¸ªé¢˜ç›®åˆ†ç±»**
    - `GET /{category_id}`
    - **è·¯å¾„å‚æ•°**: `category_id: str`
    - **å“åº”**: `ProblemCategoryResponse` (åŒ…å« `ProblemCategoryData`)ã€‚

- **æ›´æ–°é¢˜ç›®åˆ†ç±»**
    - `PUT /{category_id}`
    - **è·¯å¾„å‚æ•°**: `category_id: str`
    - **è¯·æ±‚ä½“**: `ProblemCategoryUpdate` schema (æ‰€æœ‰å­—æ®µå¯é€‰).
        - `name: Optional[str]`
        - `parent_id: Optional[str]` (æ³¨æ„: ä¸èƒ½å°†çˆ¶çº§è®¾ç½®ä¸ºè‡ªèº«æˆ–å…¶å­çº§)
        - `description: Optional[str]`
        - `order: Optional[int]`
    - **å“åº”**: `ProblemCategoryResponse` (åŒ…å«æ›´æ–°åçš„ `ProblemCategoryData`)ã€‚

- **åˆ é™¤é¢˜ç›®åˆ†ç±»**
    - `DELETE /{category_id}`
    - **è·¯å¾„å‚æ•°**: `category_id: str`
    - **å“åº”**: `ProblemCategoryResponse` (ä»…åŒ…å« `success` å’Œ `message`)ã€‚
        *(æ³¨æ„: å¦‚æœåˆ†ç±»ä¸‹æœ‰å­åˆ†ç±»ï¼Œé»˜è®¤ä¼šé˜»æ­¢åˆ é™¤)*

#### å›é¡¾åˆ†æ
```
POST   /reviews/analyze/batch         æ‰¹é‡åˆ†æ
POST   /reviews/analyze/knowledge     çŸ¥è¯†ç‚¹åˆ†æ
POST   /reviews/analyze/time-period   æ—¶é—´æ®µåˆ†æ
POST   /reviews/analyze/comprehensive ç»¼åˆåˆ†æ
GET    /reviews/insights              è·å–å­¦ä¹ æ´å¯Ÿ
```

#### AIæœåŠ¡
```
POST   /ai/models             æ·»åŠ AIæ¨¡å‹
GET    /ai/models             è·å–æ¨¡å‹åˆ—è¡¨
POST   /ai/route              æ™ºèƒ½è·¯ç”±è¯·æ±‚
GET    /ai/health             å¥åº·æ£€æŸ¥
```

### è¯¦ç»†APIæ–‡æ¡£
å¯åŠ¨æœåŠ¡åè®¿é—®ï¼š`http://localhost:8000/docs`

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

**é‡è¦è¯´æ˜ï¼š** `user_id` å­—æ®µä»¥åŠæ‰€æœ‰ç›¸å…³çš„ç”¨æˆ·ç™»å½•ã€æ³¨å†Œå’Œè´¦æˆ·ç®¡ç†åŠŸèƒ½å·²åœ¨å½“å‰ç‰ˆæœ¬ä¸­è¢«**å®Œå…¨åºŸå¼ƒå¹¶ç§»é™¤**ã€‚ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®å‡ä¸ºå…¨å±€å…±äº«ï¼Œä¸å†ä¸ç‰¹å®šç”¨æˆ·å…³è”ã€‚å¦‚æœåœ¨ä»£ç ä¸­é‡åˆ°ä»»ä½•æ®‹ç•™çš„ `user_id` ç›¸å…³é€»è¾‘ï¼Œåº”è§†ä¸ºå†å²é—ç•™ä»£ç å¹¶è¿›è¡Œæ— å®³åŒ–ç§»é™¤ã€‚**æœªæ¥ç‰ˆæœ¬ä¸è€ƒè™‘æ¢å¤ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿã€‚**

ä»¥ä¸‹æ˜¯ä¸»è¦æœåŠ¡ç›¸å…³çš„æ ¸å¿ƒè¡¨ç»“æ„ã€‚æ›´è¯¦ç»†çš„å­—æ®µä¿¡æ¯ï¼ˆå¦‚æ˜¯å¦å¯ä¸ºç©ºã€ç´¢å¼•ã€é»˜è®¤å€¼ç­‰ï¼‰è¯·ç›´æ¥å‚è€ƒå„æœåŠ¡ä¸‹çš„ `models.py` æ–‡ä»¶ã€‚

#### `problem_service` ç›¸å…³è¡¨

**1. `problems` (é”™é¢˜è¡¨)**

| å­—æ®µ                 | ç±»å‹                               | è¯´æ˜                                     |
|----------------------|------------------------------------|------------------------------------------|
| `id`                 | UUID                               | ä¸»é”®                                     |
| `title`              | VARCHAR(200)                       | é¢˜ç›®æ ‡é¢˜                                 |
| `content`            | TEXT                               | é¢˜ç›®å†…å®¹                                 |
| `subject`            | SQLEnum(Subject)                   | å­¦ç§‘ (math, english, politics, professional) |
| `category`           | VARCHAR(100), nullable             | é¢˜ç›®åˆ†ç±»                                 |
| `source`             | VARCHAR(200), nullable             | é¢˜ç›®æ¥æº                                 |
| `year`               | INTEGER, nullable                  | å¹´ä»½                                     |
| `error_analysis`     | TEXT, nullable                     | é”™è¯¯åˆ†æ                                 |
| `user_answer`        | TEXT, nullable                     | ç”¨æˆ·ç­”æ¡ˆ                                 |
| `correct_answer`     | TEXT, nullable                     | æ­£ç¡®ç­”æ¡ˆ                                 |
| `solution`           | TEXT, nullable                     | è§£é¢˜æ€è·¯                                 |
| `ai_analysis`        | JSON, nullable                     | AIåˆ†æçš„å®Œæ•´ç»“æœ                         |
| `knowledge_points`   | JSON (List[str]), default=[]       | çŸ¥è¯†ç‚¹åˆ—è¡¨                               |
| `difficulty_level`   | INTEGER, default=3                 | éš¾åº¦ç­‰çº§ (1-5)                           |
| `image_urls`         | JSON (List[str]), default=[]       | é¢˜ç›®å›¾ç‰‡URLåˆ—è¡¨                          |
| `ocr_result`         | TEXT, nullable                     | OCRè¯†åˆ«ç»“æœ                              |
| `review_count`       | INTEGER, default=0                 | å¤ä¹ æ¬¡æ•°                                 |
| `last_review_at`     | TIMESTAMP(timezone=True), nullable | æœ€åå¤ä¹ æ—¶é—´                             |
| `mastery_level`      | FLOAT, default=0.0                 | æŒæ¡ç¨‹åº¦ (0.0-1.0)                       |
| `tags`               | JSON (List[str]), default=[]       | æ ‡ç­¾åˆ—è¡¨                                 |
| `notes`              | TEXT, nullable                     | ç”¨æˆ·å¤‡æ³¨                                 |
| `created_at`         | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                 |
| `updated_at`         | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                 |
| `deleted_at`         | TIMESTAMP(timezone=True), nullable | è½¯åˆ é™¤æ—¶é—´æˆ³ (å¦‚æœéç©ºåˆ™è¡¨ç¤ºå·²åˆ é™¤)        |

**2. `review_records` (å¤ä¹ è®°å½•è¡¨)**

| å­—æ®µ                 | ç±»å‹                               | è¯´æ˜                                     |
|----------------------|------------------------------------|------------------------------------------|
| `id`                 | UUID                               | ä¸»é”®                                     |
| `problem_id`         | VARCHAR(36), ForeignKey(problems.id) | å…³è”çš„é”™é¢˜ID                             |
| `review_result`      | VARCHAR(20), nullable              | å¤ä¹ ç»“æœ (correct, incorrect, partial)   |
| `confidence_level`   | INTEGER, nullable                  | ä¿¡å¿ƒç­‰çº§ (1-5)                           |
| `time_spent`         | INTEGER, nullable                  | èŠ±è´¹æ—¶é—´ (ç§’)                            |
| `notes`              | TEXT, nullable                     | å¤ä¹ ç¬”è®°                                 |
| `ai_feedback`        | JSON, nullable                     | AIç»™å‡ºçš„åé¦ˆ                             |
| `created_at`         | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                 |
| `updated_at`         | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                 |

**3. `problem_templates` (é¢˜ç›®æ¨¡æ¿è¡¨)**

| å­—æ®µ                 | ç±»å‹                               | è¯´æ˜                                     |
|----------------------|------------------------------------|------------------------------------------|
| `id`                 | UUID                               | ä¸»é”®                                     |
| `name`               | VARCHAR(100)                       | æ¨¡æ¿åç§°                                 |
| `subject`            | SQLEnum(Subject)                   | å­¦ç§‘                                     |
| `category`           | VARCHAR(100), nullable             | é¢˜ç›®åˆ†ç±»                                 |
| `template_content`   | JSON                               | æ¨¡æ¿å†…å®¹ç»“æ„                             |
| `example_content`    | JSON, nullable                     | ç¤ºä¾‹å†…å®¹                                 |
| `description`        | TEXT, nullable                     | æè¿°                                     |
| `usage_count`        | INTEGER, default=0                 | ä½¿ç”¨æ¬¡æ•°                                 |
| `tags`               | JSON (List[str]), default=[]       | æ ‡ç­¾åˆ—è¡¨                                 |
| `created_at`         | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                 |
| `updated_at`         | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                 |
| *UniqueConstraint*   | (_subject_name_uc)                 | subject å’Œ name ç»„åˆå”¯ä¸€                 |

**4. `problem_tags` (é¢˜ç›®æ ‡ç­¾è¡¨)**

| å­—æ®µ                 | ç±»å‹                               | è¯´æ˜                                     |
|----------------------|------------------------------------|------------------------------------------|
| `id`                 | UUID                               | ä¸»é”®                                     |
| `name`               | VARCHAR(50), unique=True           | æ ‡ç­¾åç§° (å”¯ä¸€)                          |
| `description`        | TEXT, nullable                     | æè¿°                                     |
| `color`              | VARCHAR(20), nullable              | æ ‡ç­¾é¢œè‰² (ä¾‹å¦‚ #FFFFFF)                  |
| `usage_count`        | INTEGER, default=0                 | ä½¿ç”¨æ¬¡æ•°                                 |
| `created_at`         | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                 |
| `updated_at`         | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                 |

**5. `problem_categories` (é¢˜ç›®åˆ†ç±»è¡¨)**

| å­—æ®µ                 | ç±»å‹                               | è¯´æ˜                                     |
|----------------------|------------------------------------|------------------------------------------|
| `id`                 | UUID                               | ä¸»é”®                                     |
| `name`               | VARCHAR(100)                       | åˆ†ç±»åç§°                                 |
| `subject`            | SQLEnum(Subject)                   | å­¦ç§‘                                     |
| `parent_id`          | VARCHAR(36), ForeignKey(problem_categories.id), nullable | çˆ¶åˆ†ç±»ID (ç”¨äºå±‚çº§ç»“æ„)                |
| `description`        | TEXT, nullable                     | æè¿°                                     |
| `order`              | INTEGER, default=0                 | æ’åºå­—æ®µ                                 |
| `usage_count`        | INTEGER, default=0                 | ä½¿ç”¨æ¬¡æ•°                                 |
| `created_at`         | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                 |
| `updated_at`         | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                 |
| *UniqueConstraint*   | (_subject_category_name_uc)        | subject å’Œ name ç»„åˆå”¯ä¸€                 |

#### `review_service` ç›¸å…³è¡¨ (ç¤ºä¾‹)

`review_analyses`ï¼ˆåˆ†æè®°å½•è¡¨ï¼‰ - *æ³¨æ„ï¼šæ­¤è¡¨å®šä¹‰åœ¨æ–‡æ¡£ä¸­ï¼Œä½†å®é™…ä»£ç ä¸­ `review_service` çš„æ¨¡å‹å°šæœªè¯¦ç»†å®¡æŸ¥ã€‚ä»¥ä¸‹åŸºäºæ–‡æ¡£æè¿°ã€‚*
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| id | UUID | ä¸»é”® |
| analysis_type | VARCHAR(50) | åˆ†æç±»å‹ |
| problem_ids | UUID[] | ç›¸å…³é¢˜ç›® |
| ai_analysis | JSONB | AIåˆ†æç»“æœ |
| error_patterns | JSONB | é”™è¯¯æ¨¡å¼ |
| study_plan | JSONB | å­¦ä¹ è®¡åˆ’ |

### æ•°æ®åº“è¿ç§»
**æ³¨æ„**ï¼šå½“å‰ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶é€šè¿‡ SQLAlchemy çš„ `metadata.create_all()` è‡ªåŠ¨æ ¹æ® Python æ¨¡å‹åˆ›å»ºæ•°æ®åº“è¡¨ã€‚é¡¹ç›®ä¸­çš„ `backend/infrastructure/database/migrations/` ç›®å½•å’Œ `migrate.py` è„šæœ¬å½“å‰æœªä½¿ç”¨ï¼Œé€‚ç”¨äºå…¨æ–°çš„æ•°æ®åº“ç¯å¢ƒã€‚å¦‚æœéœ€è¦è¿›è¡Œåç»­çš„æ•°æ®åº“ç»“æ„å˜æ›´ç®¡ç†ï¼Œå»ºè®®å¼•å…¥ Alembic ç­‰è¿ç§»å·¥å…·ã€‚

```bash
# (æ—§çš„è¿ç§»å‘½ä»¤ï¼Œå½“å‰æœªä½¿ç”¨)
# cd backend
# python infrastructure/database/migrate.py

# æ£€æŸ¥æ•°æ®åº“ (å¯ç”¨äºç¡®è®¤è¡¨ç»“æ„æ˜¯å¦æŒ‰æ¨¡å‹åˆ›å»º)
# python check_system.py 
```

## éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# Python 3.8+
python --version

# Node.js 16+ (Viteæ¨èä½¿ç”¨æœ€æ–°LTSç‰ˆæœ¬)
node --version

# Git
git --version
```

#### 2. åç«¯å¯åŠ¨
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡ (main.py ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨)
python main.py
```

#### 3. å‰ç«¯å¯åŠ¨
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev # (Viteé€šå¸¸ä½¿ç”¨ npm run dev)
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### ä½¿ç”¨Docker Compose
```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### ç¯å¢ƒå˜é‡é…ç½®
åˆ›å»º`.env`æ–‡ä»¶ï¼š
```env
# åº”ç”¨é…ç½®
APP_ENV=production
APP_DEBUG=false

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql+asyncpg://user:pass@db:5432/dbname

# AI APIé…ç½®
OPENAI_API_KEY=your-key
ANTHROPIC_API_KEY=your-key
# æ ¹æ®å®é™…ä½¿ç”¨çš„AI Provideræ·»åŠ æ›´å¤šé…ç½®

# å¯¹è±¡å­˜å‚¨é…ç½®
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ
- **Python**: éµå¾ªPEP 8ï¼Œä½¿ç”¨Blackæ ¼å¼åŒ–ï¼Œisortè¿›è¡Œå¯¼å…¥æ’åº
- **TypeScript/JavaScript**: ä½¿ç”¨ESLint + Prettier (æ ¹æ®é¡¹ç›®é…ç½®)
- **æäº¤è§„èŒƒ**: ä½¿ç”¨Conventional Commits

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ç›¸åº”çš„serviceç›®å½•ä¸‹åˆ›å»ºæ–°æ¨¡å—
2. å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆmodels.pyï¼‰
3. åˆ›å»ºè¯·æ±‚/å“åº”æ¨¡å¼ï¼ˆschemas.pyï¼‰
4. å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆservice.pyï¼‰
5. æ·»åŠ APIè·¯ç”±ï¼ˆapi.pyï¼‰
6. ç¼–å†™æµ‹è¯•ç”¨ä¾‹
7. æ›´æ–°æ–‡æ¡£

### æµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰åç«¯æµ‹è¯•
# cd backend
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_problem_service.py

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
pytest --cov=backend

# å‰ç«¯æµ‹è¯• (å¦‚æœé…ç½®äº†)
# cd frontend
# npm test
```

### è°ƒè¯•æŠ€å·§
1. ä½¿ç”¨structlogæŸ¥çœ‹ç»“æ„åŒ–æ—¥å¿—
2. FastAPIè‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ï¼š`/docs`
3. ä½¿ç”¨VS Codeçš„Pythonè°ƒè¯•å™¨
4. æŸ¥çœ‹SQLAlchemyç”Ÿæˆçš„SQLï¼šè®¾ç½®`DATABASE_ECHO=true` (åœ¨`shared/config.py`ä¸­)
5. Vue Devtools for browser debugging

## å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥è·¯å¾„é”™è¯¯
**é—®é¢˜**ï¼š`ModuleNotFoundError: No module named 'backend'` (æˆ–ç±»ä¼¼Pythonæ¨¡å—é”™è¯¯)

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•æˆ–`backend`ç›®å½•è¿è¡ŒPythonè„šæœ¬ï¼Œå…·ä½“å–å†³äºè„šæœ¬çš„å¯¼å…¥æ–¹å¼ã€‚
2. æ£€æŸ¥PYTHONPATHè®¾ç½®ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼Œä¾èµ–äºæ­£ç¡®çš„é¡¹ç›®ç»“æ„å’Œè¿è¡Œä½ç½®ã€‚
3. å¯¹äºæœåŠ¡å†…éƒ¨çš„å¯¼å…¥ï¼Œä¼˜å…ˆä½¿ç”¨ç›¸å¯¹å¯¼å…¥ (e.g., `from . import models`) æˆ–ç»å¯¹å¯¼å…¥åŸºäº`backend`ä¸ºæ ¹ (e.g., `from backend.services.problem_service import ...`)ï¼Œç¡®ä¿è¿è¡Œä¸Šä¸‹æ–‡æ­£ç¡®ã€‚

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥
**é—®é¢˜**ï¼šæ— æ³•è¿æ¥åˆ°æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨ (æœ¬åœ°SQLiteæ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œæˆ–PostgreSQL/MinIO Dockerå®¹å™¨æ˜¯å¦è¿è¡Œ)ã€‚
2. éªŒè¯`DATABASE_URL` (åœ¨`.env`æˆ–`shared/config.py`ä¸­) æ˜¯å¦æ­£ç¡®ã€‚
3. ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™ (å¯¹äºPostgreSQL)ã€‚
4. æ£€æŸ¥é˜²ç«å¢™æˆ–ç½‘ç»œé…ç½®ã€‚

### Q3: AIæœåŠ¡è°ƒç”¨å¤±è´¥
**é—®é¢˜**ï¼šAIåˆ†æåŠŸèƒ½ä¸å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥AIæä¾›å•†çš„APIå¯†é’¥æ˜¯å¦åœ¨`.env`æˆ–é…ç½®ä¸­æ­£ç¡®è®¾ç½®ã€‚
2. éªŒè¯ç½‘ç»œè¿æ¥æ˜¯å¦å…è®¸è®¿é—®AIæœåŠ¡APIã€‚
3. æŸ¥çœ‹`ai_api_manager`æœåŠ¡çš„æ—¥å¿—ï¼Œäº†è§£å…·ä½“é”™è¯¯ã€‚
4. æ£€æŸ¥AIæœåŠ¡æä¾›å•†çš„å¥åº·çŠ¶æ€æˆ–æ˜¯å¦æœ‰æœåŠ¡ä¸­æ–­ã€‚

### Q4: æ–‡ä»¶ä¸Šä¼ å¤±è´¥
**é—®é¢˜**ï¼šæ— æ³•ä¸Šä¼ å›¾ç‰‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥MinIOæœåŠ¡ (æˆ–æ‰€é€‰å¯¹è±¡å­˜å‚¨æœåŠ¡) æ˜¯å¦è¿è¡Œã€‚
2. éªŒè¯MinIOçš„`ENDPOINT`, `ACCESS_KEY`, `SECRET_KEY`é…ç½®æ˜¯å¦æ­£ç¡®ã€‚
3. ç¡®ä¿å­˜å‚¨æ¡¶å·²åˆ›å»ºä¸”åº”ç”¨å…·æœ‰å†™å…¥æƒé™ã€‚
4. æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…å‡ºé…ç½®é™åˆ¶ã€‚
5. æŸ¥çœ‹`file_service`çš„æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ã€‚

### Q5: å‰ç«¯å¯åŠ¨æˆ–æ„å»ºé—®é¢˜
**é—®é¢˜**: `npm install` å¤±è´¥æˆ– `npm run dev` æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿Node.jså’Œnpm/yarnç‰ˆæœ¬å…¼å®¹ (æŸ¥çœ‹`package.json`ä¸­çš„`engines`å­—æ®µï¼Œå¦‚æœå­˜åœ¨)ã€‚
2. åˆ é™¤`node_modules`å’Œ`package-lock.json` (æˆ– `yarn.lock`)ï¼Œç„¶åé‡æ–°è¿è¡Œ `npm install` (æˆ– `yarn install`)ã€‚
3. æ£€æŸ¥Viteæˆ–ç›¸å…³æ’ä»¶çš„é…ç½® (`vite.config.js`, `tsconfig.json`)ã€‚
4. æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸ä¼šæŒ‡æ˜é—®é¢˜æ‰€åœ¨ã€‚

## æ›´æ–°æ—¥å¿—

### v2.0.0 (2024-03-08) - (ç¤ºä¾‹ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µæ›´æ–°)
- ğŸ‰ å®Œå…¨é‡æ„ä¸ºå¾®æœåŠ¡æ¶æ„ (FastAPIåç«¯, Vue.jså‰ç«¯)
- âœ¨ æ–°å¢AI APIç®¡ç†æœåŠ¡ï¼Œæ”¯æŒå¤šæä¾›å•†
- âœ¨ æ–°å¢æ·±åº¦å­¦ä¹ åˆ†æåŠŸèƒ½
- âœ¨ å‰ç«¯è¿ç§»è‡³Vue.js 3 + Vite + Element Plus + Pinia
- ğŸ”§ ä¼˜åŒ–æ•°æ®åº“è®¾è®¡ï¼Œä½¿ç”¨SQLAlchemy 2.0å¼‚æ­¥æ¨¡å¼
- ğŸ³ å…¨é¢æ”¯æŒDockerå’ŒDocker Composeéƒ¨ç½²
- ğŸ“š å®Œå–„é¡¹ç›®æ–‡æ¡£ï¼Œæ›´æ–°å¼€å‘å’Œéƒ¨ç½²æŒ‡å—

### v1.0.0 (2024-01-01) - (ç¤ºä¾‹)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ åŸºç¡€é”™é¢˜ç®¡ç†åŠŸèƒ½ (æ—§ç‰ˆæŠ€æœ¯æ ˆ)
- âœ¨ ç®€å•çš„AIåˆ†æ

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add some AmazingFeature'` (éµå¾ªConventional Commits)
4. æ¨é€åˆ°åˆ†æ”¯ï¼š`git push origin feature/AmazingFeature`
5. æäº¤Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹[LICENSE](LICENSE)æ–‡ä»¶äº†è§£è¯¦æƒ… (å¦‚æœé¡¹ç›®ä¸­æœ‰LICENSEæ–‡ä»¶)

## è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µï¼š[GitHub Repository](https://github.com/yourusername/error-management-system) (è¯·æ›¿æ¢ä¸ºå®é™…é“¾æ¥)
- é—®é¢˜åé¦ˆï¼š[Issues](https://github.com/yourusername/error-management-system/issues) (è¯·æ›¿æ¢ä¸ºå®é™…é“¾æ¥)
- é‚®ç®±ï¼šyour-email@example.com (è¯·æ›¿æ¢ä¸ºå®é™…é‚®ç®±)

---

*æœ€åæ›´æ–°ï¼š2025å¹´5æœˆ25æ—¥*
