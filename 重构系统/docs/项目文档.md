# é”™é¢˜ç®¡ç†ç³»ç»Ÿ - é¡¹ç›®æ–‡æ¡£

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
5. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
6. [APIæ–‡æ¡£](#apiæ–‡æ¡£)
7. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
8. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
9. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## é¡¹ç›®æ¦‚è¿°

### ç®€ä»‹
é”™é¢˜ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸ºè€ƒç ”å­¦ç”Ÿè®¾è®¡çš„æ™ºèƒ½å­¦ä¹ è¾…åŠ©å·¥å…·ï¼Œæ”¯æŒå¤šå­¦ç§‘é”™é¢˜ç®¡ç†ã€AIæ™ºèƒ½åˆ†æã€å­¦ä¹ è¿›åº¦è·Ÿè¸ªç­‰åŠŸèƒ½ã€‚

### ä¸»è¦åŠŸèƒ½
- ğŸ“š **å¤šå­¦ç§‘æ”¯æŒ**ï¼šæ•°å­¦ã€è‹±è¯­ã€æ”¿æ²»ã€ä¸“ä¸šè¯¾
- ğŸ¤– **AIæ™ºèƒ½åˆ†æ**ï¼šé”™è¯¯åŸå› åˆ†æã€è§£é¢˜æ€è·¯ç”Ÿæˆã€çŸ¥è¯†ç‚¹æå–
- ğŸ“· **OCRè¯†åˆ«ä¸AIé©±åŠ¨å½•å…¥**ï¼šæ”¯æŒæ‹ç…§å½•å…¥é¢˜ç›®ï¼Œå¹¶é€šè¿‡AIå¤šé˜¶æ®µäº¤äº’å¼æµç¨‹æ™ºèƒ½åˆ›å»ºé”™é¢˜ã€‚
- ğŸ“Š **æ·±åº¦åˆ†æ**ï¼šå­¦ä¹ æ¨¡å¼è¯†åˆ«ã€è–„å¼±ç‚¹åˆ†æã€ä¸ªæ€§åŒ–å»ºè®®
- ğŸ“ˆ **è¿›åº¦è·Ÿè¸ª**ï¼šå¤ä¹ è®°å½•ã€æŒæ¡åº¦è¯„ä¼°ã€å­¦ä¹ æ›²çº¿
- ğŸ·ï¸ **æ ‡ç­¾ä¸åˆ†ç±»ç®¡ç†**ï¼šè‡ªå®šä¹‰æ ‡ç­¾å’Œåˆ†ç±»ï¼Œå¿«é€Ÿåˆ†ç±»æ£€ç´¢

### ç³»ç»Ÿç‰¹ç‚¹
- **å¾®æœåŠ¡æ¶æ„**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- **å¼‚æ­¥å¤„ç†**ï¼šé«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶ï¼Œæå‡å“åº”é€Ÿåº¦
- **ç±»å‹å®‰å…¨**ï¼šå‰åç«¯å…¨é¢ç±»å‹æ£€æŸ¥
- **æœ¬åœ°ä¼˜å…ˆ**ï¼šæ”¯æŒå®Œå…¨æœ¬åœ°è¿è¡Œï¼Œä¿æŠ¤éšç§
- **çµæ´»éƒ¨ç½²**ï¼šæ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯åº”ç”¨ (Vue.js)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   API Gateway (FastAPI)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI APIç®¡ç†   â”‚   é”™é¢˜ç®¡ç†    â”‚   å›é¡¾åˆ†æ    â”‚  æ–‡ä»¶æœåŠ¡  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å…±äº«ç»„ä»¶å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æ•°æ®åº“ (PostgreSQL/SQLite)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡ä¾èµ–å…³ç³»
```
æ–‡ä»¶æœåŠ¡ (ç‹¬ç«‹)
AIç®¡ç†æœåŠ¡ (ç‹¬ç«‹)
é”™é¢˜æœåŠ¡ â†’ AIç®¡ç†æœåŠ¡ã€æ–‡ä»¶æœåŠ¡
å›é¡¾åˆ†ææœåŠ¡ â†’ AIç®¡ç†æœåŠ¡ã€é”™é¢˜æœåŠ¡
```

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **æ¡†æ¶**: FastAPI (å¼‚æ­¥Webæ¡†æ¶)
- **æ•°æ®åº“**: 
  - å¼€å‘ç¯å¢ƒ: SQLite
  - ç”Ÿäº§ç¯å¢ƒ: PostgreSQL
- **ORM**: SQLAlchemy 2.0 (å¼‚æ­¥)
- **éªŒè¯**: Pydantic
- **AIé›†æˆ**: 
  - OpenAI API
  - Anthropic Claude API
  - Google Gemini API
  - DeepSeek API
- **å¯¹è±¡å­˜å‚¨**: MinIO (æˆ–å…¼å®¹S3çš„æœåŠ¡)
- **æ—¥å¿—**: structlog
- **æµ‹è¯•**: pytest + pytest-asyncio

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**: Vue.js 3 (Vue ^3.3.11)
- **è¯­è¨€**: JavaScript / TypeScript (Vue 3 with Vite, tsconfig.json exists)
- **UIåº“**: Element Plus (^2.4.3)
- **çŠ¶æ€ç®¡ç†**: Pinia (^2.1.7)
- **è·¯ç”±**: Vue Router 4 (^4.2.5)
- **æ„å»ºå·¥å…·**: Vite (^5.0.8)

### éƒ¨ç½²æŠ€æœ¯
- **å®¹å™¨åŒ–**: Docker
- **ç¼–æ’**: Docker Compose
- **åå‘ä»£ç†**: Nginx (å¯é€‰)

## ç›®å½•ç»“æ„

```
é‡æ„ç³»ç»Ÿ/
â”œâ”€â”€ backend/                      # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.py                  # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”‚   â”œâ”€â”€ check_system.py         # ç³»ç»Ÿæ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ shared/                 # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ models/            # åŸºç¡€æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ services/              # å¾®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ ai_api_manager/    # AI APIç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ problem_service/   # é”™é¢˜ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ review_service/    # å›é¡¾åˆ†ææœåŠ¡
â”‚   â”‚   â””â”€â”€ file_service/      # æ–‡ä»¶æœåŠ¡
â”‚   â””â”€â”€ infrastructure/        # åŸºç¡€è®¾æ–½
â”‚       â””â”€â”€ database/          # æ•°æ®åº“ç›¸å…³
â”‚           â”œâ”€â”€ migrations/    # æ•°æ®åº“è¿ç§» (Alembicç®¡ç†)
â”‚           â””â”€â”€ migrate.py     # è¿ç§»è„šæœ¬ (æ—§)
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.html             # å…¥å£HTMLæ–‡ä»¶
â”‚   â”œâ”€â”€ package.json           # npmé…ç½®
â”‚   â”œâ”€â”€ package-lock.json      # npmé”æ–‡ä»¶
â”‚   â”œâ”€â”€ tsconfig.json          # TypeScripté…ç½®
â”‚   â”œâ”€â”€ vite.config.js         # Viteé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ src/                   # æºä»£ç 
â”‚       â”œâ”€â”€ App.tsx              # (è‹¥App.vueä¸ºä¸»è¦å…¥å£åˆ™æ­¤æ–‡ä»¶å¯èƒ½æœªä½¿ç”¨æˆ–ä¸ºè¾…åŠ©)
â”‚       â”œâ”€â”€ App.vue              # ä¸»è¦Vueåº”ç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ main.js              # åº”ç”¨å…¥å£ (Vue)
â”‚       â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•° (å¦‚ api.js)
â”‚       â”œâ”€â”€ components/          # Vueç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ AIReviewSuggestion.vue
â”‚       â”‚   â””â”€â”€ ProblemStatistics.vue
â”‚       â”œâ”€â”€ layouts/             # å¸ƒå±€ç»„ä»¶
â”‚       â”‚   â””â”€â”€ MainLayout.vue
â”‚       â”œâ”€â”€ router/              # Vueè·¯ç”±é…ç½®
â”‚       â”‚   â””â”€â”€ index.js
â”‚       â”œâ”€â”€ stores/              # PiniaçŠ¶æ€ç®¡ç†
â”‚       â”‚   â””â”€â”€ auth.js
â”‚       â”œâ”€â”€ styles/              # æ ·å¼æ–‡ä»¶
â”‚       â”‚   â””â”€â”€ index.css
â”‚       â””â”€â”€ views/               # é¡µé¢è§†å›¾ (Vue)
â”‚           â”œâ”€â”€ Dashboard.vue
â”‚           â”œâ”€â”€ ai/
â”‚           â”‚   â”œâ”€â”€ AIModelList.vue
â”‚           â”‚   â””â”€â”€ AIStats.vue
â”‚           â”œâ”€â”€ analyses/
â”‚           â”‚   â”œâ”€â”€ AnalysisCreate.vue
â”‚           â”‚   â”œâ”€â”€ AnalysisDetail.vue
â”‚           â”‚   â””â”€â”€ AnalysisList.vue
â”‚           â””â”€â”€ problems/
â”‚               â”œâ”€â”€ ProblemCreate.vue
â”‚               â”œâ”€â”€ ProblemDetail.vue
â”‚               â”œâ”€â”€ ProblemEdit.vue
â”‚               â”œâ”€â”€ ProblemList.vue
â”‚               â””â”€â”€ AISessionList.vue
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”œâ”€â”€ tests/                     # æµ‹è¯•
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’
â”œâ”€â”€ Makefile                   # æ„å»ºè„šæœ¬
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

## æ ¸å¿ƒæ¨¡å—

### 1. AI APIç®¡ç†æœåŠ¡
**åŠŸèƒ½**ï¼šç»Ÿä¸€ç®¡ç†ã€æ‰§è¡Œå’Œç›‘æ§å¯¹å¤šä¸ªAIæä¾›å•†çš„APIè°ƒç”¨ï¼Œæä¾›ä¸€è‡´çš„æ¥å£ä¾›å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚

**æ ¸å¿ƒç»„ä»¶ä¸èŒè´£**ï¼š

-   **`AIModelService` (æ ¸å¿ƒæœåŠ¡å±‚)**:
    -   **ç»Ÿä¸€è¯·æ±‚å¤„ç†**: ä½œä¸ºæ‰€æœ‰AIè¯·æ±‚çš„å…¥å£ç‚¹ (`process_ai_request` æ–¹æ³•)ã€‚
    -   **æ¨¡å‹é€‰æ‹©ä¸å®ä¾‹åŒ–**:
        -   æ ¹æ®ä»»åŠ¡éœ€æ±‚ (`AIRequestSchema.task_type`, `AIRequestSchema.model_preferences`) ä»æ•°æ®åº“åŠ è½½å¹¶é€‰æ‹©æœ€åˆé€‚çš„ `AIModel` é…ç½®ã€‚
        -   åŠ¨æ€å®ä¾‹åŒ–å¯¹åº”çš„AIæä¾›å•† (å¦‚ `OpenAIProvider`, `GeminiProvider`)ã€‚
    -   **è¯·æ±‚æ‰§è¡Œ**:
        -   å°†æ ‡å‡†åŒ–çš„ `AIRequestSchema` è½¬æ¢ä¸ºç‰¹å®šæä¾›å•†çš„APIè°ƒç”¨æ ¼å¼ã€‚
        -   è°ƒç”¨æä¾›å•†çš„ `execute_task` (éæµå¼) æˆ– `execute_task_stream` (æµå¼) æ–¹æ³•ã€‚
    -   **å“åº”å¤„ç†**:
        -   å°†æä¾›å•†è¿”å›çš„ç»“æœï¼ˆæˆ–æµå¼å—ï¼‰è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„ `AIResponseDataSchema` (æˆ–æµå¼äº‹ä»¶)ã€‚
    -   **æ—¥å¿—è®°å½•**: è®°å½•è¯¦ç»†çš„AIè°ƒç”¨æ—¥å¿— (`AICallLog`)ï¼ŒåŒ…æ‹¬è¯·æ±‚ã€å“åº”ã€ç”¨é‡ã€è€—æ—¶ã€æˆæœ¬å’ŒçŠ¶æ€ã€‚
    -   **æˆæœ¬è®¡ç®—**: æ ¹æ®æ¨¡å‹å’Œç”¨é‡ä¼°ç®—è°ƒç”¨æˆæœ¬ã€‚
    -   **é”™è¯¯å¤„ç†ä¸é‡è¯•**: ï¼ˆéƒ¨åˆ†åœ¨Providerå±‚é¢å®ç°ï¼‰å¤„ç†APIè°ƒç”¨è¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚
-   **AIæä¾›å•† (`BaseAIProvider`åŠå…¶å­ç±»)**:
    -   å°è£…ä¸ç‰¹å®šAIæœåŠ¡ï¼ˆå¦‚OpenAI, Gemini, DeepSeekï¼‰APIçš„äº¤äº’ç»†èŠ‚ã€‚
    -   å®ç° `execute_task` å’Œ `execute_task_stream` æ–¹æ³•ã€‚
    -   å¤„ç†APIè®¤è¯ã€è¯·æ±‚æ„å»ºã€å“åº”è§£æå’Œé”™è¯¯æ˜ å°„ã€‚
-   **æ¨¡å‹ä¸é…ç½®ç®¡ç† (`ai_api_manager.api`, `ai_api_manager.models`)**:
    -   æä¾›APIæ¥å£ (`/api/v1/ai/models`) ç”¨äºCRUDç®¡ç† `AIModel` é…ç½®ï¼ˆå¦‚APIå¯†é’¥ã€URLã€æ¨¡å‹åç§°ã€èƒ½åŠ›ã€ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚
    -   æä¾›APIæ¥å£ (`/api/v1/ai/providers`) è·å–æ”¯æŒçš„æä¾›å•†åˆ—è¡¨ã€‚
    -   æä¾›ç³»ç»Ÿå¥åº·æ£€æŸ¥æ¥å£ (`/api/v1/ai/health`) å’Œæ¨¡å‹è¿é€šæ€§æµ‹è¯•æ¥å£ã€‚
-   **Schema (`ai_api_manager.schemas`)**:
    -   `AIModelSchema`, `AIModelCreateSchema`, `AIModelUpdateSchema`: ç”¨äºAIæ¨¡å‹é…ç½®ç®¡ç†ã€‚
    -   `AIRequestSchema`: å®šä¹‰ç»Ÿä¸€çš„AIè¯·æ±‚è¾“å…¥ç»“æ„ã€‚
    -   `AIResponseDataSchema`: å®šä¹‰ç»Ÿä¸€çš„AIå“åº”è¾“å‡ºç»“æ„ï¼ˆéæµå¼ï¼‰ã€‚
    -   `AICallLogSchema`: AIè°ƒç”¨æ—¥å¿—çš„æ•°æ®æ¨¡å‹ã€‚
-   **åå°ä»»åŠ¡**:
    -  å¯èƒ½ç”¨äºåå°ä»»åŠ¡ï¼Œå¦‚å®šæœŸå¥åº·æ£€æŸ¥ `AIModel` è¿é€šæ€§å¹¶æ›´æ–°å…¶çŠ¶æ€ã€‚

**æ”¯æŒçš„AIä»»åŠ¡** (é€šè¿‡ `AIRequestSchema.task_type` æŒ‡å®š):
- é”™é¢˜åˆ†æ (å«å»ºè®®åˆ†ç±»ã€æ ‡ç­¾ã€è§£é¢˜æ€è·¯ã€éš¾åº¦è¯„ä¼°ç­‰) (`TaskType.PROBLEM_ANALYSIS`)
- OCRè¯†åˆ« (`TaskType.OCR`)
- çŸ¥è¯†ç‚¹æå– (`TaskType.KNOWLEDGE_POINT_EXTRACTION` - å¯ä½œä¸º `PROBLEM_ANALYSIS` çš„ä¸€éƒ¨åˆ†æˆ–ç‹¬ç«‹ä»»åŠ¡)
- å­¦ä¹ å»ºè®®ç”Ÿæˆ (`TaskType.LEARNING_SUGGESTION`)
- **é”™é¢˜å›¾ç‰‡åˆæ­¥ç»“æ„åŒ–ï¼ˆOCRä¸åŸºæœ¬ä¿¡æ¯æå–ï¼‰** (`TaskType.PROBLEM_IMAGE_TO_STRUCTURED_JSON`)
- **é”™é¢˜äº¤äº’å¼æ·±åº¦åˆ†æï¼ˆå«æµå¼é—®ç­”ï¼‰** (`TaskType.PROBLEM_INTERACTIVE_DEEP_ANALYSIS`)
- é€šç”¨é—®ç­” (`TaskType.GENERAL_QA`)
- èŠå¤© (`TaskType.CHAT`)
- æ–‡æœ¬æ‘˜è¦ (`TaskType.SUMMARIZATION`)
- æ–‡æœ¬ç¿»è¯‘ (`TaskType.TRANSLATION`)
- æ›´å¤šä»»åŠ¡ç±»å‹å¯ä»¥æ ¹æ®éœ€æ±‚æ‰©å±•...


### 2. é”™é¢˜ç®¡ç†æœåŠ¡
**åŠŸèƒ½æ¦‚è¿°**ï¼šæä¾›é”™é¢˜å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬AIé©±åŠ¨çš„æ™ºèƒ½å½•å…¥ã€æ‰‹åŠ¨å½•å…¥ã€ç¼–è¾‘ã€ç»„ç»‡ã€AIè¾…åŠ©åˆ†æã€å¤ä¹ æ”¯æŒã€æŸ¥è¯¢ç»Ÿè®¡ã€æ ‡ç­¾ä¸åˆ†ç±»ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

**è¯¦ç»†åŠŸèƒ½ç‚¹**ï¼š

1.  **é”™é¢˜å½•å…¥ (Problem Entry)**:
    *   **AIé©±åŠ¨çš„æ™ºèƒ½å½•å…¥ (é«˜çº§)**: (è¯¦è§ä¸‹ä¸€èŠ‚â€œAIé©±åŠ¨çš„æ™ºèƒ½é”™é¢˜å½•å…¥æµç¨‹â€) ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ï¼Œé€šè¿‡å¤šé˜¶æ®µAIå¤„ç†ï¼ˆOCRã€ç»“æ„åŒ–ã€æ·±åº¦åˆ†æã€äº¤äº’ä¼˜åŒ–ï¼‰è‡ªåŠ¨åˆ›å»ºé”™é¢˜ã€‚
    *   **æ‰‹åŠ¨å½•å…¥**: ç”¨æˆ·é€šè¿‡è¡¨å•å¡«å†™é”™é¢˜çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¢˜ç›®æ ‡é¢˜ã€å†…å®¹ï¼ˆæ”¯æŒå¯Œæ–‡æœ¬ï¼‰ã€å­¦ç§‘ã€åˆ†ç±»ã€ç­”æ¡ˆã€é”™è¯¯åˆ†æã€çŸ¥è¯†ç‚¹ã€æ ‡ç­¾ç­‰ã€‚
    *   **å›¾ç‰‡å½•å…¥ä¸OCRè¯†åˆ« (ä¼ ç»Ÿæµç¨‹)**:
        *   æ”¯æŒä¸Šä¼ é¢˜ç›®å›¾ç‰‡ï¼ˆé€šè¿‡ä¸ **æ–‡ä»¶æœåŠ¡** äº¤äº’å­˜å‚¨å›¾ç‰‡ï¼‰ã€‚
        *   è°ƒç”¨ **AI APIç®¡ç†æœåŠ¡** å¯¹å›¾ç‰‡è¿›è¡ŒOCRè¯†åˆ«ï¼Œæå–é¢˜ç›®æ–‡æœ¬ï¼Œè‡ªåŠ¨å¡«å……åˆ°é¢˜ç›®å†…å®¹å­—æ®µã€‚
        *   ç”¨æˆ·å¯å¯¹OCRç»“æœè¿›è¡Œæ‰‹åŠ¨æ ¡å¯¹å’Œç¼–è¾‘ã€‚
    *   **æ‰¹é‡å¯¼å…¥**:
        *   æ”¯æŒä»ç‰¹å®šæ ¼å¼æ–‡ä»¶ï¼ˆå¦‚CSV, JSONï¼‰æ‰¹é‡å¯¼å…¥é”™é¢˜ã€‚
        *   å¯ä½¿ç”¨é¢„å®šä¹‰çš„ `ProblemTemplate` (é¢˜ç›®æ¨¡æ¿) æŒ‡å¯¼å¯¼å…¥è¿‡ç¨‹ï¼Œç¡®ä¿æ•°æ®ç»“æ„ä¸€è‡´æ€§ã€‚

2.  **é”™é¢˜ç»„ç»‡ä¸ç¼–è¾‘ (Problem Organization & Editing)**:
    *   **ä¿¡æ¯ç¼–è¾‘**: æä¾›å¯¹é”™é¢˜æ‰€æœ‰å­—æ®µçš„å®Œæ•´ç¼–è¾‘åŠŸèƒ½ã€‚
    *   **ç»“æ„åŒ–ç®¡ç†**:
        *   é€šè¿‡ `subject` (å­¦ç§‘) è¿›è¡Œä¸€çº§åˆ†ç±»ã€‚
        *   é€šè¿‡ `ProblemCategory` (é¢˜ç›®åˆ†ç±») å®ç°å¤šçº§ã€ç²¾ç»†åŒ–çš„åˆ†ç±»ç®¡ç†ã€‚
        *   é€šè¿‡ `ProblemTag` (é¢˜ç›®æ ‡ç­¾) ä¸ºé”™é¢˜æ‰“ä¸Šçµæ´»çš„æ ‡ç­¾ï¼Œä¾¿äºæ£€ç´¢å’Œå½’çº³ã€‚
    *   **éš¾åº¦ä¸æŒæ¡åº¦**:
        *   `difficulty_level`: ç”¨æˆ·å¯è®¾å®šæˆ–ç”±AIè¾…åŠ©è¯„ä¼°é¢˜ç›®çš„éš¾åº¦ç­‰çº§ã€‚
        *   `mastery_level`: è®°å½•å¯¹é”™é¢˜çš„æŒæ¡ç¨‹åº¦ï¼Œé€šå¸¸åœ¨å¤ä¹ åæ›´æ–°ã€‚

3.  **AIè¾…åŠ©åŠŸèƒ½ (AI-Assisted Features)** (é€šè¿‡ **AI APIç®¡ç†æœåŠ¡** å®ç°):
    *   **æ™ºèƒ½çŸ¥è¯†ç‚¹æå–**: æ ¹æ®é¢˜ç›®å†…å®¹è‡ªåŠ¨åˆ†æå¹¶æå–ç›¸å…³çš„ `knowledge_points`ã€‚
    *   **é”™è¯¯åŸå› åˆ†æ**: åŸºäºç”¨æˆ·ç­”æ¡ˆå’Œæ­£ç¡®ç­”æ¡ˆï¼ŒAIè‡ªåŠ¨ç”Ÿæˆ `error_analysis`ï¼Œå¸®åŠ©ç†è§£é”™è¯¯æœ¬è´¨ã€‚
    *   **è§£é¢˜æ€è·¯ç”Ÿæˆ**: AIå¯ä»¥è¾…åŠ©ç”Ÿæˆæˆ–å®Œå–„é¢˜ç›®çš„ `solution`ã€‚
    *   **AIå»ºè®®åˆ†ç±» (AI-Suggested Category)**: AIå¯ä»¥æ ¹æ®é¢˜ç›®å†…å®¹å’Œå­¦ç§‘ï¼Œè‡ªåŠ¨åˆ†æå¹¶å»ºè®®ä¸€ä¸ªæœ€åˆé€‚çš„é¢˜ç›®ç»†åˆ†åˆ†ç±» (`suggested_category`)ã€‚ç³»ç»Ÿåœ¨åˆ†æåä¼šå°†æ­¤å»ºè®®åˆ†ç±»æ›´æ–°åˆ°é”™é¢˜çš„ `category` å­—æ®µï¼Œå¹¶ç›¸åº”è°ƒæ•´åˆ†ç±»çš„ä½¿ç”¨è®¡æ•°ã€‚
    *   **ç›¸ä¼¼é¢˜ç›®æ¨è**: (é«˜çº§åŠŸèƒ½) AIåˆ†æå½“å‰é”™é¢˜ç‰¹å¾ï¼Œæ¨èçŸ¥è¯†ç‚¹æˆ–é¢˜å‹ç›¸ä¼¼çš„å…¶ä»–é¢˜ç›®ï¼Œç”¨äºå·©å›ºç»ƒä¹ ã€‚
    *   **é¢˜ç›®ä¿¡æ¯è¡¥å…¨**: AIå¯æ ¹æ®é¢˜ç›®å†…å®¹å°è¯•è‡ªåŠ¨å¡«å……æ ‡ç­¾ã€éš¾åº¦ç­‰ä¿¡æ¯ (åˆ†ç±»å»ºè®®è§ä¸Šä¸€æ¡)ã€‚

4.  **å¤ä¹ æµç¨‹æ”¯æŒ (Review Process Support)**:
    *   **å¤ä¹ è®°å½•**: ç”¨æˆ·æ¯æ¬¡å¤ä¹ åï¼Œç³»ç»Ÿåˆ›å»ºä¸€æ¡ `ReviewRecord`ï¼Œè®°å½•å¤ä¹ ç»“æœã€ç”¨æ—¶ã€ç¬”è®°ç­‰ã€‚
    *   **çŠ¶æ€æ›´æ–°**: å¤ä¹ åï¼Œè‡ªåŠ¨æ›´æ–°å¯¹åº” `Problem` çš„ `mastery_level` (æŒæ¡ç¨‹åº¦)ã€`review_count` (å¤ä¹ æ¬¡æ•°) å’Œ `last_review_at` (æœ€åå¤ä¹ æ—¶é—´)ã€‚æŒæ¡åº¦çš„æ›´æ–°å¯åŸºäºå¤ä¹ ç»“æœï¼Œæˆ–ç»“åˆè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ç­‰ç®—æ³•ã€‚
    *   **å¤ä¹ è®¡åˆ’é›†æˆ**: (å¯ä¸ **å›é¡¾åˆ†ææœåŠ¡** è”åŠ¨) æ ¹æ®é”™é¢˜çš„æŒæ¡ç¨‹åº¦å’Œå¤ä¹ å†å²ï¼Œè¾…åŠ©ç”Ÿæˆå¤ä¹ è®¡åˆ’ï¼Œæé†’ç”¨æˆ·åœ¨æœ€ä½³æ—¶é—´ç‚¹å¤ä¹ ã€‚

5.  **æŸ¥è¯¢ä¸å±•ç¤º (Query & Display)**:
    *   **å¤šç»´åº¦ç­›é€‰**: æ”¯æŒæŒ‰å­¦ç§‘ã€åˆ†ç±»ã€æ ‡ç­¾ã€éš¾åº¦ã€æŒæ¡åº¦ã€åˆ›å»ºæ—¥æœŸã€å…³é”®å­—ç­‰å¤šç§æ¡ä»¶ç»„åˆæŸ¥è¯¢ã€‚
    *   **ç»“æœæ’åº**: æ”¯æŒæŒ‰åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€éš¾åº¦ã€æŒæ¡åº¦ç­‰å­—æ®µæ’åºã€‚
    *   **åˆ†é¡µå±•ç¤º**: å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåˆ†é¡µï¼Œæé«˜åŠ è½½æ•ˆç‡ã€‚
    *   **é”™é¢˜è¯¦æƒ…**: æ¸…æ™°å±•ç¤ºé”™é¢˜çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¢˜ç›®å†…å®¹ã€å›¾ç‰‡ã€ç­”æ¡ˆã€åˆ†æã€çŸ¥è¯†ç‚¹ã€æ ‡ç­¾ã€å¤ä¹ å†å²ç­‰ã€‚

6.  **æ•°æ®ç®¡ç† (Data Management)**:
    *   **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒå°†é”™é¢˜æ•°æ®å¯¼å‡ºä¸ºå¸¸è§æ ¼å¼ï¼ˆå¦‚JSON, CSV, PDFï¼‰ï¼Œæ–¹ä¾¿å¤‡ä»½æˆ–ç¦»çº¿å­¦ä¹ ã€‚
    -   **æ‰¹é‡æ“ä½œ**: æ”¯æŒå¯¹å¤šä¸ªé”™é¢˜è¿›è¡Œæ‰¹é‡åˆ é™¤ã€æ‰¹é‡æ·»åŠ æ ‡ç­¾ã€æ‰¹é‡AIé‡æ–°åˆ†æç­‰æ“ä½œã€‚

**æ ¸å¿ƒæ¨¡å‹**ï¼š

è¯¦ç»†æ¨¡å‹å®šä¹‰è¯·å‚è€ƒ `backend/services/problem_service/models.py`ã€‚

- **`Problem`**: é”™é¢˜æ ¸å¿ƒå®ä½“ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦å­—æ®µï¼š
    - `id`: UUID, ä¸»é”®
    - `title`: String(200), é¢˜ç›®æ ‡é¢˜
    - `content`: Text, é¢˜ç›®å†…å®¹
    - `subject`: Enum(Subject), å­¦ç§‘ (æ•°å­¦, è‹±è¯­, æ”¿æ²», ä¸“ä¸šè¯¾)
    - `category`: String(100), é¢˜ç›®åˆ†ç±» (å¯é€‰, å¯ç”±ç”¨æˆ·æŒ‡å®šæˆ–AIåˆ†æåå»ºè®®)
    - `source`: String(200), é¢˜ç›®æ¥æº (å¯é€‰)
    - `year`: Integer, å¹´ä»½ (å¯é€‰)
    - `error_analysis`: Text, é”™è¯¯åˆ†æ (å¯é€‰)
    - `user_answer`: Text, ç”¨æˆ·ç­”æ¡ˆ (å¯é€‰)
    - `correct_answer`: Text, æ­£ç¡®ç­”æ¡ˆ (å¯é€‰)
    - `solution`: Text, è§£é¢˜æ€è·¯ (å¯é€‰)
    - `ai_analysis`: JSON, AIåˆ†æçš„å®Œæ•´ç»“æœ (JSON, å¯é€‰, åŒ…å«çŸ¥è¯†ç‚¹ã€é”™è¯¯åˆ†æã€å»ºè®®åˆ†ç±»ç­‰)
    - `knowledge_points`: JSON (List[str]), çŸ¥è¯†ç‚¹åˆ—è¡¨
    - `difficulty_level`: Integer, éš¾åº¦ç­‰çº§ (1-5, é»˜è®¤3)
    - `image_urls`: JSON (List[str]), é¢˜ç›®å›¾ç‰‡URLåˆ—è¡¨
    - `ocr_result`: Text, OCRè¯†åˆ«ç»“æœ (å¯é€‰)
    - `review_count`: Integer, å¤ä¹ æ¬¡æ•° (é»˜è®¤0)
    - `last_review_at`: DateTime, æœ€åå¤ä¹ æ—¶é—´ (å¯é€‰)
    - `mastery_level`: Float, æŒæ¡ç¨‹åº¦ (0.0-1.0, é»˜è®¤0.0)
    - `tags`: JSON (List[str]), æ ‡ç­¾åˆ—è¡¨
    - `notes`: Text, ç”¨æˆ·å¤‡æ³¨ (å¯é€‰)
    - `created_at`, `updated_at`: DateTime, åˆ›å»ºå’Œæ›´æ–°æ—¶é—´
    - `deleted_at`: DateTime, è½¯åˆ é™¤æ ‡è®° (å¯é€‰)

- **`ReviewRecord`**: å¤ä¹ è®°å½•å®ä½“ï¼Œå…³è”åˆ°`Problem`ï¼š
    - `id`: UUID, ä¸»é”®
    - `problem_id`: String(36), å…³è”çš„é”™é¢˜ID
    - `review_result`: String(20), å¤ä¹ ç»“æœ (e.g., "correct", "incorrect", "partial") (å¯é€‰)
    - `confidence_level`: Integer, ä¿¡å¿ƒç­‰çº§ (1-5) (å¯é€‰)
    - `time_spent`: Integer, èŠ±è´¹æ—¶é—´(ç§’) (å¯é€‰)
    - `notes`: Text, å¤ä¹ ç¬”è®° (å¯é€‰)
    - `ai_feedback`: JSON, AIç»™å‡ºçš„åé¦ˆ (å¯é€‰)
    - `created_at`, `updated_at`: DateTime

- **`ProblemTemplate`**: é¢˜ç›®æ¨¡æ¿å®ä½“ï¼Œç”¨äºæ‰¹é‡å¯¼å…¥ç­‰åœºæ™¯ï¼š
    - `id`: UUID, ä¸»é”®
    - `name`: String(100), æ¨¡æ¿åç§°
    - `subject`: Enum(Subject), å­¦ç§‘
    - `category`: String(100), é¢˜ç›®åˆ†ç±» (å¯é€‰)
    - `template_content`: JSON, æ¨¡æ¿å†…å®¹ç»“æ„
    - `example_content`: JSON, ç¤ºä¾‹å†…å®¹ (å¯é€‰)
    - `description`: Text, æè¿° (å¯é€‰)
    - `usage_count`: Integer, ä½¿ç”¨æ¬¡æ•°
    - `tags`: JSON (List[str]), æ ‡ç­¾åˆ—è¡¨
    - `created_at`, `updated_at`: DateTime

- **`ProblemTag`**: é¢˜ç›®æ ‡ç­¾å®ä½“ï¼š
    - `id`: UUID, ä¸»é”®
    - `name`: String(50), æ ‡ç­¾åç§° (å”¯ä¸€)
    - `description`: Text, æè¿° (å¯é€‰)
    - `color`: String(20), æ ‡ç­¾é¢œè‰² (å¯é€‰)
    - `usage_count`: Integer, ä½¿ç”¨æ¬¡æ•°
    - `created_at`, `updated_at`: DateTime

- **`ProblemCategory`**: é¢˜ç›®åˆ†ç±»å®ä½“ï¼Œæ”¯æŒå±‚çº§ç»“æ„ï¼š
    - `id`: UUID, ä¸»é”®
    - `name`: String(100), åˆ†ç±»åç§°
    - `subject`: Enum(Subject), å­¦ç§‘
    - `parent_id`: String(36), çˆ¶åˆ†ç±»ID (å¯é€‰, ç”¨äºå±‚çº§)
    - `description`: Text, æè¿° (å¯é€‰)
    - `order`: Integer, æ’åºå­—æ®µ
    - `usage_count`: Integer, ä½¿ç”¨æ¬¡æ•°
    - `created_at`, `updated_at`: DateTime

**æ ¸å¿ƒä¸šåŠ¡æµç¨‹ç¤ºä¾‹**:

1.  **æ‰‹åŠ¨åˆ›å»ºæ–°é”™é¢˜æµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·åœ¨åˆ›å»ºé¡µé¢å¡«å†™è¡¨å•ï¼ˆæ ‡é¢˜ã€å­¦ç§‘ã€é¢˜ç›®å†…å®¹ç­‰ï¼‰ï¼Œå¯é€‰ä¸Šä¼ å›¾ç‰‡ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   æ¥æ”¶åˆ›å»ºè¯·æ±‚ã€‚è‹¥æœ‰å›¾ç‰‡ï¼Œå…ˆè°ƒç”¨ `file_service` ä¸Šä¼ å›¾ç‰‡ï¼Œè·å–å›¾ç‰‡URLå­˜å…¥ `image_urls`ã€‚
        *   ä¿å­˜åŸºç¡€ `Problem` ä¿¡æ¯åˆ°æ•°æ®åº“ã€‚
        *   ï¼ˆå¯é€‰ï¼Œæ ¹æ®é…ç½®æˆ–ç”¨æˆ·é€‰æ‹©ï¼‰è°ƒç”¨ `ai_api_manager` å¯¹é¢˜ç›®å†…å®¹è¿›è¡ŒAIåˆ†æï¼ˆçŸ¥è¯†ç‚¹æå–ã€åˆæ­¥é”™è¯¯åˆ†æç­‰ï¼‰ã€‚
        *   å°†AIåˆ†æç»“æœæ›´æ–°åˆ°è¯¥ `Problem` è®°å½•çš„ `ai_analysis`, `knowledge_points` ç­‰å­—æ®µã€‚
        *   è¿”å›åˆ›å»ºæˆåŠŸåŠé”™é¢˜ä¿¡æ¯ç»™å‰ç«¯ã€‚

2.  **OCRå›¾ç‰‡å½•å…¥é”™é¢˜æµç¨‹ (ä¼ ç»Ÿ)**:
    *   å‰ç«¯ï¼šç”¨æˆ·ä¸Šä¼ é¢˜ç›®å›¾ç‰‡ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   è°ƒç”¨ `file_service` å­˜å‚¨å›¾ç‰‡ã€‚
        *   è°ƒç”¨ `ai_api_manager` çš„OCRåŠŸèƒ½å¤„ç†å›¾ç‰‡ï¼Œè·å–è¯†åˆ«æ–‡æœ¬ã€‚
        *   å°†OCRæ–‡æœ¬é¢„å¡«å……åˆ°æ–°é¢˜ç›®çš„å†…å®¹å­—æ®µï¼Œè¿”å›ç»™å‰ç«¯ä¾›ç”¨æˆ·ç¡®è®¤å’Œç¼–è¾‘ã€‚
        *   ç”¨æˆ·ç¡®è®¤å¹¶æäº¤åï¼ŒæŒ‰æ‰‹åŠ¨åˆ›å»ºæµç¨‹ç»§ç»­ï¼ˆå¯å†æ¬¡è§¦å‘æ›´è¯¦ç»†çš„AIåˆ†æï¼‰ã€‚

3.  **å¤ä¹ é”™é¢˜æµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·é€‰æ‹©ä¸€é“é”™é¢˜è¿›è¡Œå¤ä¹ ï¼Œæäº¤å¤ä¹ ç»“æœï¼ˆå¦‚æ˜¯å¦ç­”å¯¹ã€æŒæ¡ç¨‹åº¦åé¦ˆã€ç¬”è®°ï¼‰ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   åˆ›å»ºä¸€æ¡æ–°çš„ `ReviewRecord`ï¼Œè®°å½•æœ¬æ¬¡å¤ä¹ è¯¦æƒ…ã€‚
        *   æ ¹æ®å¤ä¹ ç»“æœå’Œæ—¢å®šç®—æ³•ï¼ˆæˆ–ç”¨æˆ·ç›´æ¥è¾“å…¥çš„æŒæ¡åº¦ï¼‰ï¼Œæ›´æ–° `Problem` çš„ `mastery_level`, `review_count`, `last_review_at`ã€‚
        *   ï¼ˆå¯é€‰ï¼‰è‹¥ä¸ **å›é¡¾åˆ†ææœåŠ¡** é›†æˆï¼Œå¯èƒ½éœ€è¦é€šçŸ¥è¯¥æœåŠ¡æ›´æ–°å¤ä¹ è®¡åˆ’ã€‚

4.  **å¯¹å·²æœ‰é”™é¢˜è¯·æ±‚AIåˆ†ææµç¨‹**:
    *   å‰ç«¯ï¼šç”¨æˆ·é€‰æ‹©æŸæ¡é”™é¢˜ï¼Œç‚¹å‡»â€œAIåˆ†æâ€æŒ‰é’®ã€‚
    *   åç«¯ `problem_service`ï¼š
        *   è·å–è¯¥é”™é¢˜çš„ç°æœ‰æ•°æ®ï¼ˆå†…å®¹ã€ç­”æ¡ˆç­‰ï¼‰ã€‚
        *   è°ƒç”¨ `ai_api_manager` æ‰§è¡ŒæŒ‡å®šçš„AIåˆ†æä»»åŠ¡ï¼ˆå¦‚é”™è¯¯åŸå› æ·±åº¦åˆ†æã€è§£é¢˜æ€è·¯ä¼˜åŒ–ç­‰ï¼‰ã€‚
        *   æ¥æ”¶AIè¿”å›çš„åˆ†æç»“æœï¼Œæ›´æ–°è¯¥ `Problem` çš„ `ai_analysis` æˆ–å…¶ä»–ç›¸å…³å­—æ®µã€‚
        *   è¿”å›æ›´æ–°åçš„é”™é¢˜ä¿¡æ¯ç»™å‰ç«¯ã€‚

#### AIé©±åŠ¨çš„æ™ºèƒ½é”™é¢˜å½•å…¥æµç¨‹ (é«˜çº§å·¥ä½œæµ)

æœ¬æµç¨‹æ—¨åœ¨æä¾›ä¸€ä¸ªé«˜åº¦è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–çš„é”™é¢˜å½•å…¥ä½“éªŒï¼Œç”¨æˆ·ä¸»è¦é€šè¿‡ä¸Šä¼ å›¾ç‰‡ä¸AIè¿›è¡Œäº¤äº’ï¼ŒAIè´Ÿè´£å¤§éƒ¨åˆ†çš„æ–‡æœ¬è¯†åˆ«ã€å†…å®¹ç»“æ„åŒ–ã€æ·±åº¦åˆ†æåŠåˆæ­¥æ•°æ®å¡«å……å·¥ä½œã€‚

**æ ¸å¿ƒæ€æƒ³**: ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ -> AIå¤šé˜¶æ®µå¤„ç†ä¸åˆ†æï¼ˆç»“æ„åŒ–ã€æ·±åº¦åˆ†æã€äº¤äº’å¼ä¼˜åŒ–ï¼‰ -> ç”¨æˆ·ç¡®è®¤ -> é”™é¢˜åŠåˆ†ææ•°æ®ã€äº¤äº’è®°å½•å®Œæ•´å…¥åº“ã€‚

**æ•°æ®æµä¸ç»„ä»¶äº¤äº’**:

1.  **é˜¶æ®µä¸€ï¼šå›¾ç‰‡ä¸Šä¼ ä¸åˆæ­¥ç»“æ„åŒ– (`/problems/ai-create/initiate`)**
    *   **å‰ç«¯**: ç”¨æˆ·åœ¨ `ProblemCreate.vue` ä¸Šä¼ å›¾ç‰‡ï¼Œå¯é€‰æä¾›å­¦ç§‘æç¤ºã€‚å›¾ç‰‡è½¬æ¢ä¸º Base64ã€‚
    *   **`problemAPI.initiateAICreation`**: è°ƒç”¨åç«¯æ¥å£ã€‚
        *   è¯·æ±‚ (`ProblemAICreateInitiateRequest`): `{ image_base64: string, subject_hint?: string }`
    *   **åç«¯ `problem_service.api.initiate_ai_problem_creation`**:
        *   è°ƒç”¨ `FileService.upload_base64_image` ä¿å­˜å›¾ç‰‡ï¼Œè·å– `image_url`ã€‚
        *   åˆ›å»º `ProblemAISession` è®°å½• (çŠ¶æ€: `active`)ï¼Œè·å¾— `session_id`ã€‚
        *   è°ƒç”¨ `AIModelService.process_ai_request` (ä»»åŠ¡ç±»å‹: `PROBLEM_IMAGE_TO_STRUCTURED_JSON`)ã€‚
            *   è¯·æ±‚åŒ…å« `image_url` å’Œ `subject_hint`ã€‚
            *   AIè¿”å›åˆæ­¥ç»“æ„åŒ–æ•°æ® (`ProblemAIStructuredData` schema: `raw_ocr_text`, `extracted_content`, `suggested_subject`, `preliminary_category`, `preliminary_tags`, `image_regions_of_interest`ç­‰)ã€‚
        *   æ›´æ–° `ProblemAISession` è®°å½•çš„ `initial_image_ref` å’Œ `initial_structured_data_snapshot`ã€‚
        *   å“åº” (`ProblemAICreateInitiateResponse`): `{ session_id: UUID, structured_data: ProblemAIStructuredData }`
    *   **å‰ç«¯ `ProblemCreate.vue` (`handleStartAIImageImport` -> `initiateAIImageAnalysis`)**:
        *   å­˜å‚¨ `session_id` å’Œ `structured_data`ã€‚
        *   ä½¿ç”¨ `structured_data` é¢„å¡«å……è¡¨å•ã€‚
        *   UIæç¤ºç”¨æˆ·æ£€æŸ¥å¹¶å¼€å§‹äº¤äº’å¼åˆ†æã€‚

2.  **é˜¶æ®µäºŒï¼šäº¤äº’å¼æ·±åº¦åˆ†æä¸ä¼˜åŒ– (`/problems/ai-create/interactive-stream/{session_id}`)**
    *   **å‰ç«¯ `ProblemCreate.vue` (`startAIInteraction` / `sendChatMessage`)**:
        *   ç”¨æˆ·åœ¨èŠå¤©ç•Œé¢è¾“å…¥æ¶ˆæ¯ã€‚
        *   å‡†å¤‡ `chat_history` (å«ç”¨æˆ·æ¶ˆæ¯)ã€‚
        *   ä½¿ç”¨ `EventSource` è¿æ¥åˆ°åç«¯çš„æµå¼æ¥å£ã€‚
        *   `problemAPI.getAIInteractiveStreamURL` æ„å»ºSSEè¯·æ±‚URLï¼ŒåŒ…å«æŸ¥è¯¢å‚æ•° (å¦‚ `user_message`, `chat_history` - å®é™…é€šè¿‡POST bodyä¼ é€’æ›´ä½³ï¼Œä½†SSEé€šå¸¸GETï¼Œå› æ­¤éœ€è€ƒè™‘URLé•¿åº¦æˆ–å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆå¦‚WebSocketsã€‚æ­¤å¤„æ–‡æ¡£æè¿°ä¸ºPOSTåˆ°æµå¼æ¥å£ï¼Œåç«¯FastAPIå¯ä»¥æ”¯æŒè¯·æ±‚ä½“å’ŒSSEç»“åˆ)ã€‚
        *   æ­¤æ¥å£å®é™…åº”ä¸º `POST` ä»¥ä¾¿ä¼ é€’ `chat_history` å’Œ `user_message`ã€‚
    *   **åç«¯ `problem_service.api.stream_ai_interactive_analysis`**:
        *   æ¥æ”¶ `ProblemAIStreamRequest` (`user_message`, `chat_history`)ã€‚
        *   è·å– `ProblemAISession`ã€‚
        *   æ„é€  `AIRequestSchema` (ä»»åŠ¡ç±»å‹: `PROBLEM_INTERACTIVE_DEEP_ANALYSIS`, `stream=True`)ã€‚
            *   ä¸Šä¸‹æ–‡åŒ…å« `initial_structured_data_snapshot`, `chat_history`, `user_message`ã€‚
            *   ä½¿ç”¨å¼•å¯¼AIè¿›è¡Œæ·±åº¦åˆ†æå’Œäº¤äº’çš„ç³»ç»Ÿæç¤ºã€‚
        *   è°ƒç”¨ `AIModelService.process_ai_request` (è¿”å›å¼‚æ­¥ç”Ÿæˆå™¨)ã€‚
        *   **æµå¼å“åº” (SSE)**:
            *   `async for chunk in ai_response_generator:`
                *   `ProblemAIChatLog` è®°å½•AIçš„å›å¤å—ã€‚
                *   `yield` SSEäº‹ä»¶ (`data: { type: 'content_chunk', value: str }` æˆ– `data: { type: 'structured_update', data: ProblemAIStructuredData }` ç­‰)ã€‚
    *   **å‰ç«¯ `ProblemCreate.vue`**:
        *   `eventSource.onmessage`: æ¥æ”¶SSEäº‹ä»¶ï¼Œæ›´æ–°èŠå¤©ç•Œé¢å’Œè¡¨å•é¢„è§ˆã€‚
        *   `eventSource.onerror`: å¤„ç†é”™è¯¯ã€‚

3.  **é˜¶æ®µä¸‰ï¼šç”¨æˆ·ç¡®è®¤ä¸æ•°æ®æŒä¹…åŒ– (`/problems/ai-create/finalize`)**
    *   **å‰ç«¯ `ProblemCreate.vue` (`handleFinalizeAIProblem`)**:
        *   ç”¨æˆ·ç‚¹å‡»â€œç¡®è®¤ä¿å­˜â€ã€‚
        *   æ”¶é›†æœ€ç»ˆè¡¨å•æ•°æ® (`problemForm: ProblemCreate`) å’Œå®Œæ•´çš„ `chat_history`ã€‚
        *   `problemAPI.finalizeAICreation` è°ƒç”¨åç«¯ã€‚
            *   è¯·æ±‚ (`ProblemAIFinalizeRequest`): `{ session_id: UUID, problem_data: ProblemCreate, chat_history: List[ChatLogEntry], ai_full_analysis_json?: dict }`
    *   **åç«¯ `problem_service.api.finalize_ai_problem_creation`**:
        *   è·å– `ProblemAISession`ã€‚
        *   ä½¿ç”¨ `problem_data` åˆ›å»º `Problem` è®°å½•ã€‚
        *   æ›´æ–° `ProblemAISession` (çŠ¶æ€: `finalized`, `final_problem_id`, `final_structured_data_snapshot`)ã€‚
        *   `problem_service.save_chat_history` å°† `chat_history` ä¸­çš„æ¯æ¡è®°å½•å­˜å…¥ `ProblemAIChatLog` è¡¨ï¼Œå…³è” `session_id` å’Œ `final_problem_id`ã€‚
        *   å“åº” (`SingleProblemResponse`): åŒ…å«åˆ›å»ºçš„ `ProblemData`ã€‚
    *   **å‰ç«¯ `ProblemCreate.vue`**:
        *   æç¤ºæˆåŠŸï¼Œæ¸…ç©ºä¼šè¯çŠ¶æ€ï¼Œå¯¼èˆªåˆ°é”™é¢˜åˆ—è¡¨æˆ–è¯¦æƒ…ã€‚

**å¯¹ç°æœ‰æ¨¡å—çš„åˆ©ç”¨ä¸æ‰©å±•**:

*   **`ai_api_manager`**:
    *   **`AIModelService` å’Œ AI æä¾›å•†**:
        *   `TaskType` æšä¸¾å·²æ›´æ–° (ä¾‹å¦‚ `PROBLEM_IMAGE_TO_STRUCTURED_JSON`, `PROBLEM_INTERACTIVE_DEEP_ANALYSIS`)ã€‚
        *   æä¾›å•†å®ç°å·²æ›´æ–°ï¼Œä»¥å¤„ç†è¿™äº›ä»»åŠ¡ç±»å‹å¹¶æ”¯æŒæµå¼è¾“å‡º (`execute_task_stream`)ï¼Œå®ƒä»¬æ¥æ”¶ `AIRequestSchema`ã€‚
        *   æ¨¡å‹é…ç½® (é€šè¿‡ `ai_api_manager.api` ç®¡ç†) å…è®¸ä¸ºä¸åŒä»»åŠ¡ç±»å‹æŒ‡å®šåˆé€‚çš„AIæ¨¡å‹ã€‚
*   **`problem_service`**:
    *   **æ¨¡å‹æ‰©å±•**: (è¯¦è§æ•°æ®åº“è®¾è®¡éƒ¨åˆ†)
        *   `ProblemAISession` (æ–°): å­˜å‚¨AIåˆ›å»ºä¼šè¯çš„çŠ¶æ€å’Œä¸­é—´æ•°æ®ã€‚
        *   `ProblemAIChatLog` (æ–°): å­˜å‚¨AIäº¤äº’èŠå¤©è®°å½•ã€‚
    *   **APIæ¥å£**: (è¯¦è§APIæ–‡æ¡£éƒ¨åˆ†)
        *   `/ai-create/initiate`
        *   `/ai-create/interactive-stream/{session_id}`
        *   `/ai-create/finalize`
        *   `/ai-create/sessions` (åˆ—è¡¨)
        *   `/ai-create/session/{session_id}` (è¯¦æƒ…)
        *   `/ai-create/chat-history/{session_id}` (èŠå¤©è®°å½•)
    *   **Schemaæ‰©å±• (ä¸»è¦åœ¨ `problem_service.schemas`)**:
        *   `ProblemAICreateInitiateRequest`, `ProblemAICreateInitiateResponse`
        *   `ProblemAIStructuredData`
        *   `ProblemAIStreamRequest`, `ChatLogEntry` (ç”¨äºè¯·æ±‚å’Œå­˜å‚¨)
        *   `ProblemAIFinalizeRequest`
        *   `ProblemAISessionCreate`, `ProblemAISessionData`, `ProblemAISessionUpdate`
        *   `ProblemAIChatLogCreate`, `ProblemAIChatLogData`
*   **`file_service`**: æŒ‰ç°æœ‰æ–¹å¼ç”¨äºå›¾ç‰‡å­˜å‚¨å’ŒURLç®¡ç†ã€‚

**å¯ç»´æŠ¤æ€§ä¸ç®—æ³•å‡çº§**:

*   **æ¨¡å—åŒ–AIé˜¶æ®µ**: å°†AIå¤„ç†åˆ†ä¸ºæ˜ç¡®çš„é˜¶æ®µï¼ˆåˆæ­¥ç»“æ„åŒ– vs. æ·±åº¦åˆ†æä¸äº¤äº’ï¼‰ï¼Œå…è®¸ç‹¬ç«‹é€‰æ‹©ã€ä¼˜åŒ–å’Œå‡çº§æ¯ä¸ªé˜¶æ®µæ‰€ä½¿ç”¨çš„AIæ¨¡å‹å’Œç®—æ³•ã€‚
*   **æ ‡å‡†åŒ–æ•°æ®äº¤æ¢**: é˜¶æ®µé—´ä»¥åŠå‰åç«¯ä¹‹é—´ä½¿ç”¨å®šä¹‰æ¸…æ™°çš„JSONæ ¼å¼è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œé™ä½è€¦åˆåº¦ã€‚
*   **AIä»»åŠ¡ç±»å‹åŒ–**: åœ¨ `ai_api_manager` ä¸­é€šè¿‡ `TaskType` æ¥ç®¡ç†ä¸åŒçš„AIèƒ½åŠ›ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚
*   **æµå¼å¤„ç†å°è£…**: å°½å¯èƒ½å°†æµå¼å¤„ç†çš„å¤æ‚æ€§å°è£…åœ¨ `ai_api_manager` çš„æä¾›å•†å®ç°å’Œ `problem_service` çš„å¯¹åº”æ¥å£ä¸­ï¼Œç®€åŒ–å‰ç«¯è°ƒç”¨ã€‚

**å‰ç«¯å®ç°è¦ç‚¹**:
*   `ProblemCreate.vue`: å¤„ç†å›¾ç‰‡ä¸Šä¼ ã€è°ƒç”¨ `initiate`ã€ç®¡ç† `session_id`ã€é¢„å¡«å……è¡¨å•ã€å¤„ç†SSEæµçš„æ¥æ”¶ä¸æ¸²æŸ“ã€å‘é€èŠå¤©æ¶ˆæ¯ã€è°ƒç”¨ `finalize`ã€‚
*   `AISessionList.vue`: åˆ—å‡ºå†å²AIåˆ›å»ºä¼šè¯ï¼Œå…è®¸æŸ¥çœ‹è¯¦æƒ…æˆ–ç»§ç»­æœªå®Œæˆçš„ä¼šè¯ã€‚
*   `api.js`: æ·»åŠ æ–°çš„ `problemAPI` æ–¹æ³•ã€‚

æ­¤é«˜çº§æµç¨‹æ—¨åœ¨æ˜¾è‘—æå‡é”™é¢˜å½•å…¥çš„æ•ˆç‡å’Œæ™ºèƒ½åŒ–æ°´å¹³ã€‚

**ä¸å…¶ä»–æ¨¡å—çš„äº¤äº’**:

-   **AI APIç®¡ç†æœåŠ¡**:
    *   **è°ƒç”¨æ–¹**: `problem_service` åœ¨éœ€è¦AIèƒ½åŠ›æ—¶ï¼ˆå¦‚OCRã€çŸ¥è¯†ç‚¹æå–ã€é”™è¯¯åˆ†æã€å†…å®¹ç”Ÿæˆï¼‰è°ƒç”¨æ­¤æœåŠ¡ã€‚
    *   **äº¤äº’å†…å®¹**: ä¼ é€’é¢˜ç›®æ–‡æœ¬ã€å›¾ç‰‡æ•°æ®ã€åˆ†ææŒ‡ä»¤ç­‰ï¼›æ¥æ”¶AIå¤„ç†ç»“æœã€‚
-   **æ–‡ä»¶æœåŠ¡**:
    *   **è°ƒç”¨æ–¹**: `problem_service` åœ¨å¤„ç†å¸¦å›¾ç‰‡çš„é”™é¢˜æ—¶è°ƒç”¨æ­¤æœåŠ¡ã€‚
    *   **äº¤äº’å†…å®¹**: ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼›è·å–å›¾ç‰‡çš„å­˜å‚¨URLæˆ–å¼•ç”¨ã€‚`problem_service` è‡ªèº«å­˜å‚¨è¿™äº›URLã€‚
-   **å›é¡¾åˆ†ææœåŠ¡ (Review Service)**:
    *   **äº¤äº’æ–¹å¼**: `problem_service` å¯èƒ½åœ¨é”™é¢˜åˆ›å»ºã€æ›´æ–°æˆ–å¤ä¹ è®°å½•äº§ç”Ÿæ—¶ï¼Œé€šçŸ¥ `review_service` ç›¸å…³äº‹ä»¶ï¼Œä»¥ä¾¿åè€…æ›´æ–°å­¦ä¹ æ¨¡å‹ã€è°ƒæ•´å¤ä¹ è®¡åˆ’ã€‚`problem_service` è‡ªèº«è´Ÿè´£åŸºç¡€çš„å¤ä¹ è®°å½•å’ŒçŠ¶æ€æ›´æ–°ã€‚
-   **ç»Ÿè®¡æœåŠ¡ (Statistics Service)**:
    *   **æ•°æ®æº**: `problem_service` å­˜å‚¨çš„é”™é¢˜æ•°æ® (`Problem` è¡¨) å’Œå¤ä¹ è®°å½•æ•°æ® (`ReviewRecord` è¡¨) æ˜¯ `statistics_service` è¿›è¡Œç»Ÿè®¡åˆ†æçš„åŸºç¡€ã€‚`statistics_service` é€šå¸¸ä¼šç›´æ¥æŸ¥è¯¢è¿™äº›æ•°æ®æˆ–é€šè¿‡APIè·å–èšåˆæ•°æ®ã€‚

**ä¸»è¦æ¥å£ (æ¦‚è§ˆï¼Œè¯¦ç»†è§APIæ–‡æ¡£éƒ¨åˆ†)**ï¼š
- **é”™é¢˜ (Problems)** (`/api/v1/problems`):
    - `POST /`: åˆ›å»ºé”™é¢˜ (æ‰‹åŠ¨/ä¼ ç»Ÿæµç¨‹)ã€‚
    - `GET /`: è·å–é”™é¢˜åˆ—è¡¨ (æ”¯æŒå¤æ‚æŸ¥è¯¢ã€ç­›é€‰ã€æ’åºã€åˆ†é¡µ)ã€‚
    - `GET /{problem_id}`: è·å–å•ä¸ªé”™é¢˜è¯¦æƒ…ã€‚
    - `PUT /{problem_id}`: æ›´æ–°é”™é¢˜ä¿¡æ¯ã€‚
    - `DELETE /{problem_id}`: åˆ é™¤é”™é¢˜ (è½¯åˆ é™¤)ã€‚
    - `POST /{problem_id}/analyze`: å¯¹æŒ‡å®šé”™é¢˜æ‰§è¡ŒAIåˆ†æã€‚
    - `POST /batch`: æ‰¹é‡å¯¼å…¥é”™é¢˜ã€‚
    - `GET /export`: å¯¼å‡ºé”™é¢˜ (æŸ¥è¯¢å‚æ•°æ§åˆ¶èŒƒå›´å’Œæ ¼å¼)ã€‚
    - `POST /batch-operate`: æ‰¹é‡æ“ä½œé”™é¢˜ (åˆ é™¤ã€æ›´æ–°ã€åˆ†æ)ã€‚
- **AIé©±åŠ¨é”™é¢˜åˆ›å»ºæ¥å£ (Problems - AI Driven)** (`/api/v1/problems/ai-create`):
    - `POST /initiate`: å¯åŠ¨AIé©±åŠ¨æµç¨‹ç¬¬ä¸€é˜¶æ®µ (å›¾ç‰‡åˆæ­¥ç»“æ„åŒ–)ã€‚
    - `POST /interactive-stream/{session_id}`: å¤„ç†ç¬¬äºŒé˜¶æ®µAIåˆ†æä¸äº¤äº’ (SSEæµ)ã€‚
    - `POST /finalize`: æœ€ç»ˆä¿å­˜AIé©±åŠ¨åˆ›å»ºçš„é”™é¢˜ã€‚
    - `GET /sessions`: è·å–AIåˆ›å»ºä¼šè¯åˆ—è¡¨ã€‚
    - `GET /session/{session_id}`: è·å–æŒ‡å®šAIä¼šè¯è¯¦æƒ…ã€‚
    - `GET /chat-history/{session_id}`: è·å–æŒ‡å®šAIä¼šè¯çš„èŠå¤©è®°å½•ã€‚
- **å¤ä¹ è®°å½• (Review Records)** (`/api/v1/problems/{problem_id}/reviews`):
    - `POST /`: ä¸ºé”™é¢˜æ·»åŠ å¤ä¹ è®°å½• (`ReviewRecordCreate` -> `ReviewRecordResponse`)ã€‚
    - `GET /`: è·å–æŒ‡å®šé”™é¢˜çš„æ‰€æœ‰å¤ä¹ è®°å½• (`List[ReviewRecordData]`)ã€‚
- **å›¾ç‰‡ä¸OCR (ä¼ ç»Ÿæµç¨‹)** (`/api/v1/problems`):
    - `POST /ocr`: å¯¹æä¾›çš„å›¾ç‰‡è¿›è¡ŒOCRè¯†åˆ« (`ProblemOCRRequest` -> `SingleProblemResponse`ï¼Œå¯èƒ½åŒ…å«OCRæ–‡æœ¬æˆ–å·²åˆ›å»ºçš„é¢˜ç›®)ã€‚
    - `POST /upload/image`: ä¸Šä¼ é”™é¢˜å›¾ç‰‡ (`ProblemImageUploadResponse`ï¼ŒåŒ…å«æ–‡ä»¶ä¿¡æ¯å’Œå¯é€‰çš„OCRç»“æœ)ã€‚
- **æ ‡ç­¾ç®¡ç† (`/api/v1/problem-tags`)** å’Œ **åˆ†ç±»ç®¡ç† (`/api/v1/problem-categories`)**: æ¥å£ä¿æŒä¸å˜ã€‚
- **ç»Ÿè®¡æ¥å£ (`/api/v1/problems/stats`)**:
    - `GET /overview`: è·å–é”™é¢˜æ€»ä½“ç»Ÿè®¡æ¦‚è§ˆã€‚
    - `GET /knowledge-points`: è·å–çŸ¥è¯†ç‚¹ç›¸å…³çš„ç»Ÿè®¡æ•°æ®ã€‚

### 3. å›é¡¾åˆ†ææœåŠ¡
**åŠŸèƒ½**ï¼šæ·±åº¦å­¦ä¹ åˆ†æã€æ¨¡å¼è¯†åˆ«ã€ä¸ªæ€§åŒ–å»ºè®®

**åˆ†æç±»å‹**ï¼š
- æ‰¹é‡é”™é¢˜åˆ†æ
- çŸ¥è¯†ç‚¹ä¸“é¡¹åˆ†æ
- æ—¶é—´æ®µè¶‹åŠ¿åˆ†æ
- ç»¼åˆå­¦ä¹ æŠ¥å‘Š

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- é”™è¯¯æ¨¡å¼è¯†åˆ«
- è–„å¼±é¢†åŸŸå®šä½
- å­¦ä¹ è®¡åˆ’ç”Ÿæˆ
- è¿›åº¦è·Ÿè¸ªå¯¹æ¯”

### 4. æ–‡ä»¶æœåŠ¡
**åŠŸèƒ½**ï¼šæ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ã€è®¿é—®æ§åˆ¶

**ç‰¹æ€§**ï¼š
- æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆMinIO/æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰
- å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–
- è®¿é—®æƒé™æ§åˆ¶
- æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†

## APIæ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `/api` (ç”±å‰ç«¯ä»£ç†é…ç½®ï¼Œä¾‹å¦‚ `http://localhost:8000/api` æˆ– `http://localhost:5173/api` æŒ‡å‘åç«¯ `http://localhost:8000`)
- **è®¤è¯æ–¹å¼**: æ— éœ€è®¤è¯ (å½“å‰ç‰ˆæœ¬)
- **å“åº”æ ¼å¼**: JSON

### ä¸»è¦æ¥å£

#### é”™é¢˜ç®¡ç† (`/v1/problems`)

è¯¦ç»†çš„è¯·æ±‚/å“åº”æ¨¡å‹è¯·å‚è€ƒ `backend/services/problem_service/schemas.py`ã€‚
FastAPI è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ä½äºåç«¯ `/docs` (ä¾‹å¦‚ `http://localhost:8000/docs`)ï¼Œæä¾›äº†æœ€å‡†ç¡®çš„æ¥å£è¯¦æƒ…å’Œæµ‹è¯•åŠŸèƒ½ã€‚

- **åˆ›å»ºé”™é¢˜ (æ‰‹åŠ¨/ä¼ ç»Ÿæµç¨‹)**
    - `POST /`
    - **è¯·æ±‚ä½“**: `ProblemCreate` schema.
        - `title: str` (å¿…éœ€)
        - `content: str` (å¿…éœ€)
        - `subject: Subject` (å¿…éœ€, æšä¸¾: "math", "english", "politics", "professional")
        - `category: Optional[str]`
        - `source: Optional[str]`
        - `year: Optional[int]`
        - `user_answer: Optional[str]`
        - `correct_answer: Optional[str]`
        - `error_analysis: Optional[str]`
        - `solution: Optional[str]`
        - `tags: List[str]` (é»˜è®¤ç©ºåˆ—è¡¨)
        - `image_urls: List[str]` (é»˜è®¤ç©ºåˆ—è¡¨, é€šå¸¸ç”±åç«¯å¤„ç†å›¾ç‰‡ä¸Šä¼ åå¡«å……)
        - `image_base64: Optional[List[str]]` (ç”¨äºé€šè¿‡base64ä¸Šä¼ å›¾ç‰‡)
        - `notes: Optional[str]`
    - **æŸ¥è¯¢å‚æ•°**:
        - `auto_analyze: bool` (é»˜è®¤ `True`): æ˜¯å¦åœ¨åˆ›å»ºåè‡ªåŠ¨æ‰§è¡ŒAIåˆ†æã€‚
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«åˆ›å»ºçš„ `ProblemData`)ã€‚

- **è·å–é”™é¢˜åˆ—è¡¨ (æ”¯æŒé«˜çº§æŸ¥è¯¢)**
    - `GET /`
    - **æŸ¥è¯¢å‚æ•°**: (åŸºäº `ProblemQuery` schema)
        - `subject: Optional[Subject]`
        - `category: Optional[str]`
        - `tags: Optional[List[str]]` (ä¾‹å¦‚: `tags=é‡ç‚¹&tags=æ˜“é”™`)
        - `keyword: Optional[str]` (æœç´¢æ ‡é¢˜ã€å†…å®¹ã€å¤‡æ³¨)
        - `min_difficulty: Optional[int]` (1-5)
        - `max_difficulty: Optional[int]` (1-5)
        - `min_mastery: Optional[float]` (0.0-1.0)
        - `max_mastery: Optional[float]` (0.0-1.0)
        - `page: int` (é»˜è®¤ 1)
        - `size: int` (é»˜è®¤ 20, æœ€å¤§ 100)
        - `sort_by: str` (é»˜è®¤ "created_at", å¯é€‰: "updated_at", "difficulty_level", "mastery_level", "review_count")
        - `sort_desc: bool` (é»˜è®¤ `True`)
    - **å“åº”**: `ProblemListResponse` (åŒ…å« `data: List[ProblemData]`, `total`, `page`, `size`, `pages`)ã€‚

- **è·å–å•ä¸ªé”™é¢˜è¯¦æƒ…**
    - `GET /{problem_id}`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **å“åº”**: `SingleProblemResponse` (åŒ…å« `ProblemData`)ã€‚

- **æ›´æ–°é”™é¢˜ä¿¡æ¯**
    - `PUT /{problem_id}`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **è¯·æ±‚ä½“**: `ProblemUpdate` schema (æ‰€æœ‰å­—æ®µå¯é€‰).
        - `title: Optional[str]`
        - `content: Optional[str]`
        - `category: Optional[str]`
        - `source: Optional[str]`
        - `year: Optional[int]`
        - `user_answer: Optional[str]`
        - `correct_answer: Optional[str]`
        - `error_analysis: Optional[str]`
        - `solution: Optional[str]`
        - `tags: Optional[List[str]]`
        - `image_urls: Optional[List[str]]` (æ³¨æ„ï¼šé€šå¸¸å›¾ç‰‡ç®¡ç†é€šè¿‡ä¸“é—¨çš„ä¸Šä¼ /åˆ é™¤æ¥å£)
        - `notes: Optional[str]`
        - `mastery_level: Optional[float]` (0.0-1.0)
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«æ›´æ–°åçš„ `ProblemData`)ã€‚

- **åˆ é™¤é”™é¢˜ (è½¯åˆ é™¤)**
    - `DELETE /{problem_id}`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **å“åº”**: `SingleProblemResponse` (ä»…åŒ…å« `success` å’Œ `message`)ã€‚

- **AIåˆ†æé”™é¢˜ (é’ˆå¯¹å·²å­˜åœ¨é”™é¢˜)**
    - `POST /{problem_id}/analyze`
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **è¯·æ±‚ä½“**: (å¯é€‰) `ProblemAnalyzeRequest` schema.
        - `regenerate: bool` (é»˜è®¤ `False`)
        - `focus_areas: Optional[List[str]]`
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«æ›´æ–°AIåˆ†æç»“æœåçš„ `ProblemData`)ã€‚

- **OCRè¯†åˆ«å›¾ç‰‡å†…å®¹ (ä¼ ç»Ÿæµç¨‹)**
    - `POST /ocr`
    - **è¯·æ±‚ä½“**: `ProblemOCRRequest` schema.
        - `image_base64: Optional[str]`
        - `image_url: Optional[HttpUrl]`
        - `enhance_math: bool` (é»˜è®¤ `True`)
        - `auto_create: bool` (é»˜è®¤ `False`)
        - `subject: Optional[Subject]`
        - `category: Optional[str]`
    - **å“åº”**: `SingleProblemResponse`.

- **æ‰¹é‡å¯¼å…¥é”™é¢˜**
    - `POST /batch`
    - **è¯·æ±‚ä½“**: `List[ProblemCreate]`
    - **æŸ¥è¯¢å‚æ•°**: `auto_analyze: bool` (é»˜è®¤ `False`)
    - **å“åº”**: `dict` åŒ…å« `success: bool`, `message: str`, å’Œ `data: {total, success, failed, errors, created_ids}`ã€‚

- **ä¸Šä¼ é”™é¢˜å›¾ç‰‡ (ä¼ ç»Ÿæµç¨‹)**
    - `POST /upload/image`
    - **è¯·æ±‚ä½“**: `multipart/form-data` (`file: UploadFile`)
    - **æŸ¥è¯¢å‚æ•°**: `auto_ocr: bool` (é»˜è®¤ `True`)
    - **å“åº”**: `ProblemImageUploadResponse` (åŒ…å« `file_info`, `ocr_result` ç­‰)

- **å¯¼å‡ºé”™é¢˜æ•°æ®**
    - `GET /export`
    - **æŸ¥è¯¢å‚æ•°**: (åŒè·å–åˆ—è¡¨, é¢å¤–åŠ  `export_format: ExportFormat` (json, csv))
    - **å“åº”**: JSON åˆ—è¡¨æˆ– CSV æ–‡ä»¶æµã€‚

- **æ‰¹é‡æ“ä½œé”™é¢˜**
    - `POST /batch-operate`
    - **è¯·æ±‚ä½“**: `ProblemBatchRequest` (`problem_ids: List[str]`, `operation: str` ("delete", "update", "analyze"), `update_data: Optional[Dict]`)
    - **å“åº”**: `BatchOperationResponse` (å«æˆåŠŸ/å¤±è´¥è¯¦æƒ…)

#### AIé©±åŠ¨çš„æ™ºèƒ½é”™é¢˜å½•å…¥ (`/v1/problems/ai-create`)

- **å¯åŠ¨AIé©±åŠ¨æµç¨‹ç¬¬ä¸€é˜¶æ®µ (å›¾ç‰‡åˆæ­¥ç»“æ„åŒ–)**
    - `POST /initiate`
    - **è¯·æ±‚ä½“**: `ProblemAICreateInitiateRequest`
        - `image_base64: Optional[str]` (å›¾ç‰‡çš„Base64ç¼–ç )
        - `image_url: Optional[HttpUrl]` (å›¾ç‰‡çš„URLï¼Œè‹¥ä¸ä½¿ç”¨base64)
        - `subject_hint: Optional[str]` (ç”¨æˆ·æä¾›å­¦ç§‘æç¤ºï¼Œå¸®åŠ©AIæ›´å¿«å®šä½)
    - **å“åº”**: `ProblemAICreateInitiateResponse`
        - `session_id: UUID` (æ–°åˆ›å»ºçš„AIä¼šè¯ID)
        - `structured_data: ProblemAIStructuredData` (AIåˆæ­¥ç»“æ„åŒ–çš„æ•°æ®ï¼Œå¦‚ `raw_ocr_text`, `extracted_content`, `suggested_subject`, `preliminary_category`, `preliminary_tags`ç­‰)

- **å¤„ç†ç¬¬äºŒé˜¶æ®µAIåˆ†æä¸äº¤äº’ (SSEæµ)**
    - `POST /interactive-stream/{session_id}`
    - **è·¯å¾„å‚æ•°**: `session_id: UUID`
    - **è¯·æ±‚ä½“**: `ProblemAIStreamRequest`
        - `user_message: str` (ç”¨æˆ·å½“å‰è¾“å…¥çš„æ¶ˆæ¯)
        - `chat_history: List[ChatLogEntry]` (åˆ°ç›®å‰ä¸ºæ­¢çš„å®Œæ•´èŠå¤©è®°å½•)
        - `current_form_data: Optional[ProblemCreate]` (å¯é€‰ï¼Œç”¨æˆ·åœ¨å‰ç«¯è¡¨å•ä¸­çš„å½“å‰æ•°æ®ï¼Œä¾›AIå‚è€ƒ)
    - **å“åº”**: `text/event-stream` (SSE)
        - äº‹ä»¶å¦‚: `data: {"type": "content_chunk", "value": "AIæ­£åœ¨æ€è€ƒ..."}\n\n`
        - æˆ– `data: {"type": "structured_update", "data": { "title": "æ›´æ–°åçš„æ ‡é¢˜", ...}}\n\n` (AIå»ºè®®çš„è¡¨å•å­—æ®µæ›´æ–°)
        - æˆ– `data: {"type": "error", "message": "AIå¤„ç†å‡ºé”™"}\n\n`
        - æˆ– `data: {"type": "stream_end"}\n\n` (è¡¨ç¤ºAIæœ¬æ¬¡å›å¤ç»“æŸ)

- **æœ€ç»ˆä¿å­˜AIé©±åŠ¨åˆ›å»ºçš„é”™é¢˜**
    - `POST /finalize`
    - **è¯·æ±‚ä½“**: `ProblemAIFinalizeRequest`
        - `session_id: UUID` (è¦æœ€ç»ˆç¡®å®šçš„ä¼šè¯ID)
        - `problem_data: ProblemCreate` (ç”¨æˆ·æœ€ç»ˆç¡®è®¤/ç¼–è¾‘åçš„å®Œæ•´é”™é¢˜æ•°æ®)
        - `ai_full_analysis_json: Optional[Dict[str, Any]]` (AIæ·±åº¦åˆ†æçš„å®Œæ•´JSONï¼Œè‹¥æœ‰ï¼Œå¯å­˜å…¥ `Problem.ai_analysis`)
        - `chat_history: List[ChatLogEntry]` (æœ¬æ¬¡åˆ›å»ºä¼šè¯çš„å®Œæ•´äº¤äº’èŠå¤©è®°å½•)
    - **å“åº”**: `SingleProblemResponse` (åŒ…å«åˆ›å»ºçš„ `ProblemData`)

- **è·å–AIåˆ›å»ºä¼šè¯åˆ—è¡¨**
    - `GET /sessions`
    - **æŸ¥è¯¢å‚æ•°**:
        - `page: int` (é»˜è®¤ 1)
        - `size: int` (é»˜è®¤ 10)
        - `status: Optional[str]` (ä¼šè¯çŠ¶æ€è¿‡æ»¤, e.g., "active", "finalized", "aborted")
    - **å“åº”**: `ProblemAISessionListResponse` (åŒ…å« `data: List[ProblemAISessionData]`, `total`, `page`, `size`)

- **è·å–æŒ‡å®šAIåˆ›å»ºä¼šè¯çš„è¯¦ç»†ä¿¡æ¯**
    - `GET /session/{session_id}`
    - **è·¯å¾„å‚æ•°**: `session_id: UUID`
    - **å“åº”**: `ProblemAISessionResponse` (åŒ…å« `ProblemAISessionData`)

- **è·å–æŒ‡å®šAIåˆ›å»ºä¼šè¯çš„å®Œæ•´èŠå¤©è®°å½•**
    - `GET /chat-history/{session_id}`
    - **è·¯å¾„å‚æ•°**: `session_id: UUID`
    - **å“åº”**: `ProblemAIChatLogListResponse` (åŒ…å« `data: List[ProblemAIChatLogData]`)


#### å¤ä¹ è®°å½• (`/v1/problems/{problem_id}/reviews` å’Œ `/v1/reviews`)

- **ä¸ºé”™é¢˜æ·»åŠ å¤ä¹ è®°å½•**
    - `POST /v1/problems/{problem_id}/review` (æ­¤æ¥å£æ›´ç¬¦åˆRESTfulé£æ ¼ï¼ŒåŸæ–‡æ¡£ä¸­`/reviews`ä½œä¸ºé¡¶çº§èµ„æº)
    - **è·¯å¾„å‚æ•°**: `problem_id: str`
    - **è¯·æ±‚ä½“**: `ReviewRecordCreate` schema (æˆ–ç®€åŒ–ç‰ˆï¼Œå¦‚ä»…å« `mastery_level` å’Œ `notes`)
        - `mastery_level: float` (0.0-1.0)
        - `notes: Optional[str]`
        - `review_result: Optional[str]`
        - `confidence_level: Optional[int]`
        - `time_spent: Optional[int]`
    - **å“åº”**: `ReviewRecordResponse` (åŒ…å«åˆ›å»ºçš„ `ReviewRecordData`)ã€‚
    *æˆ–è€…ä½¿ç”¨ç‹¬ç«‹çš„ `analysisAPI` (å‰ç«¯å·²å®šä¹‰):*
    - `POST /v1/reviews` (è¯·æ±‚ä½“ `ReviewRecordCreate` åŒ…å« `problem_id`)

- **è·å–é”™é¢˜çš„æ‰€æœ‰å¤ä¹ è®°å½•**
    - `GET /v1/problems/{problem_id}/reviews`
    - **å“åº”**: `List[ReviewRecordData]` (æˆ–å¸¦åˆ†é¡µçš„å“åº”ä½“)

- **è·å–é”™é¢˜ç»Ÿè®¡æ¦‚è§ˆ**
    - `GET /v1/problems/stats/overview`
    - **å“åº”**: `ProblemStatisticsResponse` (åŒ…å« `data: ProblemStatisticsOverviewSchema`)

- **è·å–çŸ¥è¯†ç‚¹ç»Ÿè®¡**
    - `GET /v1/problems/stats/knowledge-points`
    - **å“åº”**: `KnowledgePointStatsListResponse` (åŒ…å« `data: List[KnowledgePointStatsSchema]`)


#### é¢˜ç›®æ ‡ç­¾ç®¡ç† (Problem Tags) (`/v1/problem-tags`)

- **åˆ›å»ºé¢˜ç›®æ ‡ç­¾**: `POST /` (è¯·æ±‚: `ProblemTagCreate`, å“åº”: `ProblemTagResponse`)
- **è·å–é¢˜ç›®æ ‡ç­¾åˆ—è¡¨**: `GET /` (å“åº”: `ProblemTagListResponse`)
- **è·å–å•ä¸ªé¢˜ç›®æ ‡ç­¾**: `GET /{tag_id}` (å“åº”: `ProblemTagResponse`)
- **æ›´æ–°é¢˜ç›®æ ‡ç­¾**: `PUT /{tag_id}` (è¯·æ±‚: `ProblemTagUpdate`, å“åº”: `ProblemTagResponse`)
- **åˆ é™¤é¢˜ç›®æ ‡ç­¾**: `DELETE /{tag_id}` (å“åº”: `ProblemTagResponse` ä»…å«æˆåŠŸæ¶ˆæ¯)

#### é¢˜ç›®åˆ†ç±»ç®¡ç† (Problem Categories) (`/v1/problem-categories`)

- **åˆ›å»ºé¢˜ç›®åˆ†ç±»**: `POST /` (è¯·æ±‚: `ProblemCategoryCreate`, å“åº”: `ProblemCategoryResponse`)
- **è·å–é¢˜ç›®åˆ†ç±»åˆ—è¡¨**: `GET /` (æŸ¥è¯¢å‚æ•° `subject`, `parent_id`, `hierarchical`; å“åº”: `ProblemCategoryListResponse`)
- **è·å–å•ä¸ªé¢˜ç›®åˆ†ç±»**: `GET /{category_id}` (å“åº”: `ProblemCategoryResponse`)
- **æ›´æ–°é¢˜ç›®åˆ†ç±»**: `PUT /{category_id}` (è¯·æ±‚: `ProblemCategoryUpdate`, å“åº”: `ProblemCategoryResponse`)
- **åˆ é™¤é¢˜ç›®åˆ†ç±»**: `DELETE /{category_id}` (å“åº”: `ProblemCategoryResponse` ä»…å«æˆåŠŸæ¶ˆæ¯)


#### AI API ç®¡ç†æœåŠ¡ (`/v1/ai`)

è¯¦ç»†çš„è¯·æ±‚/å“åº”æ¨¡å‹è¯·å‚è€ƒ `backend/services/ai_api_manager/schemas.py`ã€‚
FastAPI è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ä½äºåç«¯ `/docs`ã€‚

**åŸºç¡€è·¯å¾„**: `/v1/ai` (åŸä¸º `/api/v1/ai-manager`)

- **AIæ¨¡å‹é…ç½®ç®¡ç†**
    - `POST /models`: åˆ›å»ºæ–°çš„AIæ¨¡å‹é…ç½®ã€‚ (è¯·æ±‚: `AIModelCreate`, å“åº”: `AIModelResponse`)
    - `GET /models`: è·å–æ‰€æœ‰AIæ¨¡å‹é…ç½®åˆ—è¡¨ã€‚ (å“åº”: `AIModelListResponse`)
    - `GET /models/{model_id}`: è·å–æŒ‡å®šçš„AIæ¨¡å‹é…ç½®ã€‚ (å“åº”: `AIModelResponse`)
    - `PUT /models/{model_id}`: æ›´æ–°æŒ‡å®šçš„AIæ¨¡å‹é…ç½®ã€‚ (è¯·æ±‚: `AIModelUpdate`, å“åº”: `AIModelResponse`)
    - `DELETE /models/{model_id}`: åˆ é™¤æŒ‡å®šçš„AIæ¨¡å‹é…ç½®ã€‚ (å“åº”çŠ¶æ€ç : 204)
    - `POST /models/{model_id}/test-connectivity`: æµ‹è¯•æŒ‡å®šAIæ¨¡å‹é…ç½®çš„è¿é€šæ€§ã€‚ (å“åº”: `AIModelTestConnectivityResponse`)

- **AIæä¾›å•†ä¿¡æ¯**
    - `GET /providers`: è·å–æ”¯æŒçš„AIæä¾›å•†åˆ—è¡¨åŠå…¶èƒ½åŠ›ã€‚ (å“åº”: `AIProviderInfoListResponse`)

- **æ‰§è¡ŒAIä»»åŠ¡**
    - `POST /execute`: ç»Ÿä¸€æ‰§è¡ŒAIä»»åŠ¡ï¼ˆæµå¼æˆ–éæµå¼ï¼‰ã€‚
        - è¯·æ±‚ä½“: `AIRequestSchema` (å…¶ä¸­ `stream: bool` æ§åˆ¶æ˜¯å¦æµå¼)
        - å“åº”:
            - éæµå¼ (`stream=False`): `AIResponseDataSchema`
            - æµå¼ (`stream=True`): Server-Sent Events (SSE) æµ

- **ç³»ç»Ÿä¸å¥åº·æ£€æŸ¥**
    - `GET /health/system`: è·å–AIç®¡ç†æœåŠ¡çš„æ•´ä½“å¥åº·çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯ã€‚ (å“åº”: `AISystemHealthResponse`)
    - `GET /health/logs`: è·å–æœ€è¿‘çš„AIè°ƒç”¨æ—¥å¿—ï¼ˆæ”¯æŒåˆ†é¡µï¼‰ã€‚ (å“åº”: `AICallLogListResponse`)

### è¯¦ç»†APIæ–‡æ¡£
å¯åŠ¨æœåŠ¡åè®¿é—®ï¼šåç«¯ `/docs` (ä¾‹å¦‚ `http://localhost:8000/docs`) (FastAPIè‡ªå¸¦çš„Swagger UI) å’Œ `/redoc`ã€‚

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

**é‡è¦è¯´æ˜ï¼š** ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿå·²åºŸå¼ƒã€‚æ‰€æœ‰æ•°æ®å…¨å±€å…±äº«ã€‚

ä»¥ä¸‹æ˜¯ä¸»è¦æœåŠ¡ç›¸å…³çš„æ ¸å¿ƒè¡¨ç»“æ„ã€‚è¯¦ç»†å®šä¹‰è¯·å‚è€ƒå„æœåŠ¡ä¸‹çš„ `models.py`ã€‚

#### `problem_service` ç›¸å…³è¡¨

**1. `problems` (é”™é¢˜è¡¨)** (åŸºæœ¬ä¸å˜ï¼Œå‚è€ƒå‰æ–‡)

**2. `review_records` (å¤ä¹ è®°å½•è¡¨)** (åŸºæœ¬ä¸å˜ï¼Œå‚è€ƒå‰æ–‡)

**3. `problem_templates` (é¢˜ç›®æ¨¡æ¿è¡¨)** (åŸºæœ¬ä¸å˜ï¼Œå‚è€ƒå‰æ–‡)

**4. `problem_tags` (é¢˜ç›®æ ‡ç­¾è¡¨)** (åŸºæœ¬ä¸å˜ï¼Œå‚è€ƒå‰æ–‡)

**5. `problem_categories` (é¢˜ç›®åˆ†ç±»è¡¨)** (åŸºæœ¬ä¸å˜ï¼Œå‚è€ƒå‰æ–‡)


**6. `problem_ai_sessions` (AIé”™é¢˜åˆ›å»ºä¼šè¯è¡¨)**

| å­—æ®µ                          | ç±»å‹                               | è¯´æ˜                                                              |
|-------------------------------|------------------------------------|-------------------------------------------------------------------|
| `id`                          | UUID                               | ä¸»é”®, ä¼šè¯ID                                                      |
| `initial_image_ref`           | VARCHAR(1024), nullable          | åˆå§‹ä¸Šä¼ å›¾ç‰‡çš„å¼•ç”¨/URL                                              |
| `initial_subject_hint`        | VARCHAR(100), nullable             | ç”¨æˆ·åˆå§‹æä¾›çš„å­¦ç§‘æç¤º                                            |
| `initial_structured_data_snapshot` | JSON, nullable                  | é˜¶æ®µä¸€AIåˆæ­¥ç»“æ„åŒ–çš„æ•°æ®å¿«ç…§ (`ProblemAIStructuredData`)            |
| `current_structured_data_snapshot`| JSON, nullable                  | é˜¶æ®µäºŒAIäº¤äº’è¿‡ç¨‹ä¸­ï¼Œæœ€æ–°çš„ç»“æ„åŒ–æ•°æ®å¿«ç…§                          |
| `final_problem_id`            | UUID, ForeignKey(problems.id), nullable | æœ€ç»ˆæˆåŠŸåˆ›å»ºçš„é”™é¢˜ID                                            |
| `status`                      | VARCHAR(30), default='active'      | ä¼šè¯çŠ¶æ€ ('active', 'finalized', 'aborted', 'error', 'expired')   |
| `last_activity_at`            | TIMESTAMP(timezone=True)           | æœ€åæ´»è·ƒæ—¶é—´ (è‡ªåŠ¨æ›´æ–°)                                           |
| `expires_at`                  | TIMESTAMP(timezone=True), nullable | ä¼šè¯è¿‡æœŸæ—¶é—´ (ä¾‹å¦‚ï¼Œåˆ›å»ºå24å°æ—¶)                               |
| `error_message`               | TEXT, nullable                     | å¦‚æœä¼šè¯å› é”™è¯¯ä¸­æ­¢ï¼Œè®°å½•é”™è¯¯ä¿¡æ¯                                  |
| `metadata`                    | JSON, nullable                     | å…¶ä»–ä¼šè¯ç›¸å…³å…ƒæ•°æ® (ä¾‹å¦‚ï¼Œä½¿ç”¨çš„AIæ¨¡å‹ID, æµç¨‹æ­¥éª¤ï¼ŒUIçŠ¶æ€ç­‰)   |
| `created_at`                  | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                                          |
| `updated_at`                  | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                                          |

**7. `problem_ai_chat_logs` (AIäº¤äº’èŠå¤©è®°å½•è¡¨)**

| å­—æ®µ                     | ç±»å‹                               | è¯´æ˜                                                              |
|--------------------------|------------------------------------|-------------------------------------------------------------------|
| `id`                     | UUID                               | ä¸»é”®                                                              |
| `session_id`             | UUID, ForeignKey(problem_ai_sessions.id) | å…³è”çš„AIé”™é¢˜åˆ›å»ºä¼šè¯ID (çº§è”åˆ é™¤)                               |
| `problem_id`             | UUID, ForeignKey(problems.id), nullable | å…³è”çš„é”™é¢˜ID (ä»…åœ¨ä¼šè¯æœ€ç»ˆç”Ÿæˆé”™é¢˜åå¡«å……, å¯é€‰)                   |
| `timestamp`              | TIMESTAMP(timezone=True), default=now | æ¶ˆæ¯æ—¶é—´æˆ³                                                        |
| `role`                   | VARCHAR(10)                        | è§’è‰² ('user' æˆ– 'assistant' æˆ– 'system')                          |
| `content`                | TEXT                               | æ¶ˆæ¯å†…å®¹ (çº¯æ–‡æœ¬æˆ–JSONç»“æ„çš„å­—ç¬¦ä¸²åŒ–è¡¨ç¤º)                           |
| `content_type`           | VARCHAR(50), default='text/plain'  | å†…å®¹MIMEç±»å‹ (ä¾‹å¦‚: 'text/plain', 'application/json+suggestion', 'application/json+form_update') |
| `order_in_session`       | INTEGER                            | åœ¨è¯¥ä¼šè¯ä¸­çš„é¡ºåº (ä»1å¼€å§‹ï¼Œè‡ªå¢)                                   |
| `metadata`               | JSON, nullable                     | é¢å¤–å…ƒæ•°æ® (ä¾‹å¦‚ï¼ŒAIæ€è€ƒè¿‡ç¨‹ã€å·¥å…·ä½¿ç”¨ã€æ¶ˆæ¯IDã€å¼•ç”¨ç­‰)            |
| `created_at`             | TIMESTAMP(timezone=True), default=now | è®°å½•åˆ›å»ºæ—¶é—´                                                      |

*å…³ç³»è¯´æ˜*:
- `problem_ai_chat_logs.session_id` æŒ‡å‘ `problem_ai_sessions.id`ã€‚
- `problem_ai_sessions.final_problem_id` æŒ‡å‘ `problems.id`ã€‚

#### `review_service` ç›¸å…³è¡¨ (ç¤ºä¾‹)
(åŒå‰æ–‡)

#### `ai_api_manager` ç›¸å…³è¡¨
**1. `ai_models` (AIæ¨¡å‹é…ç½®è¡¨)**
| å­—æ®µ                | ç±»å‹                               | è¯´æ˜                                                         |
|---------------------|------------------------------------|--------------------------------------------------------------|
| `id`                | UUID                               | ä¸»é”®                                                         |
| `model_name`        | VARCHAR(255), unique=True          | æ¨¡å‹å”¯ä¸€åç§°/ID (ä¾‹å¦‚ "gpt-4-turbo-preview")                 |
| `provider`          | VARCHAR(50)                        | AIæä¾›å•† (ä¾‹å¦‚ "openai", "gemini", "deepseek")                 |
| `api_key_env_var`   | VARCHAR(100), nullable             | å­˜å‚¨APIå¯†é’¥çš„ç¯å¢ƒå˜é‡å (ä¾‹å¦‚ "OPENAI_API_KEY")              |
| `base_url_env_var`  | VARCHAR(100), nullable             | å­˜å‚¨APIåŸºç¡€URLçš„ç¯å¢ƒå˜é‡å (å¯é€‰)                            |
| `capabilities`      | JSON (List[str])                   | æ¨¡å‹èƒ½åŠ›åˆ—è¡¨ (ä¾‹å¦‚ ["ocr", "chat", "problem_analysis"])        |
| `config_json`       | JSON, nullable                     | ç‰¹å®šäºæä¾›å•†çš„é¢å¤–é…ç½® (ä¾‹å¦‚ temperature, top_p)             |
| `priority`          | INTEGER, default=0                 | ä¼˜å…ˆçº§ (ç”¨äºæ¨¡å‹é€‰æ‹©)                                        |
| `is_active`         | BOOLEAN, default=True              | æ˜¯å¦æ¿€æ´»å¯ç”¨                                                 |
| `last_tested_at`    | TIMESTAMP(timezone=True), nullable | æœ€åè¿é€šæ€§æµ‹è¯•æ—¶é—´                                           |
| `last_test_status`| VARCHAR(20), nullable              | æœ€åæµ‹è¯•çŠ¶æ€ ("ok", "error")                                 |
| `notes`             | TEXT, nullable                     | å¤‡æ³¨                                                         |
| `created_at`        | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                                     |
| `updated_at`        | TIMESTAMP(timezone=True)           | æ›´æ–°æ—¶é—´                                                     |

**2. `ai_call_logs` (AIè°ƒç”¨æ—¥å¿—è¡¨)**
| å­—æ®µ                | ç±»å‹                               | è¯´æ˜                                                         |
|---------------------|------------------------------------|--------------------------------------------------------------|
| `id`                | UUID                               | ä¸»é”®                                                         |
| `model_id`          | UUID, ForeignKey(ai_models.id)     | ä½¿ç”¨çš„AIæ¨¡å‹ID                                               |
| `task_type`         | VARCHAR(100), nullable             | AIä»»åŠ¡ç±»å‹ (ä¾‹å¦‚ `TaskType.PROBLEM_ANALYSIS`)                |
| `request_data`      | JSON, nullable                     | å‘é€ç»™AIçš„è¯·æ±‚æ•°æ®ï¼ˆè„±æ•åï¼‰                                 |
| `response_data`     | JSON, nullable                     | AIè¿”å›çš„å“åº”æ•°æ®ï¼ˆè„±æ•åï¼Œæµå¼å¯èƒ½åªè®°å½•æ‘˜è¦æˆ–é”™è¯¯ï¼‰         |
| `prompt_tokens`     | INTEGER, nullable                  | è¾“å…¥Tokenæ•°é‡                                                |
| `completion_tokens` | INTEGER, nullable                  | è¾“å‡ºTokenæ•°é‡                                                |
| `total_tokens`      | INTEGER, nullable                  | æ€»Tokenæ•°é‡                                                  |
| `duration_ms`       | INTEGER, nullable                  | è°ƒç”¨è€—æ—¶ (æ¯«ç§’)                                              |
| `cost`              | DECIMAL(10, 6), nullable           | ä¼°ç®—æˆæœ¬                                                     |
| `status_code`       | INTEGER, nullable                  | HTTPçŠ¶æ€ç  (è‹¥é€‚ç”¨)                                          |
| `error_message`     | TEXT, nullable                     | é”™è¯¯ä¿¡æ¯ (å¦‚æœè°ƒç”¨å¤±è´¥)                                      |
| `is_stream`         | BOOLEAN, default=False             | æ˜¯å¦ä¸ºæµå¼è°ƒç”¨                                               |
| `user_identifier`   | VARCHAR(255), nullable             | è°ƒç”¨æ–¹æ ‡è¯† (ä¾‹å¦‚ï¼ŒæœåŠ¡åæˆ–ç”¨æˆ·ID - å½“å‰åºŸå¼ƒ)                 |
| `created_at`        | TIMESTAMP(timezone=True)           | åˆ›å»ºæ—¶é—´                                                     |


### æ•°æ®åº“è¿ç§»
å½“å‰ç³»ç»Ÿåœ¨å¼€å‘æ¨¡å¼ä¸‹å¯åŠ¨æ—¶é€šè¿‡ SQLAlchemy çš„ `metadata.create_all()` è‡ªåŠ¨æ ¹æ® Python æ¨¡å‹åˆ›å»ºæ•°æ®åº“è¡¨ (å¦‚æœè¡¨ä¸å­˜åœ¨)ã€‚
å¯¹äºç”Ÿäº§ç¯å¢ƒå’Œåç»­çš„æ•°æ®åº“ç»“æ„å˜æ›´ç®¡ç†ï¼Œ**å¼ºçƒˆå»ºè®®å¼•å…¥ Alembic**ã€‚
`backend/infrastructure/database/migrations/` ç›®å½•å·²é¢„ç•™ç»™ Alembic ä½¿ç”¨ã€‚

```bash
# æ£€æŸ¥æ•°æ®åº“ (å¯ç”¨äºç¡®è®¤è¡¨ç»“æ„æ˜¯å¦æŒ‰æ¨¡å‹åˆ›å»º)
# python check_system.py 
```

## éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# Python 3.9+
python --version

# Node.js 18+ (Viteæ¨èä½¿ç”¨æœ€æ–°LTSç‰ˆæœ¬)
node --version

# Git
git --version
```

#### 2. åç«¯å¯åŠ¨
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# (å¯é€‰) å¦‚æœä½¿ç”¨PostgreSQL, ç¡®ä¿æ•°æ®åº“æœåŠ¡å·²è¿è¡Œä¸”é…ç½®æ­£ç¡®
# (å¯é€‰) å¦‚æœä½¿ç”¨MinIO, ç¡®ä¿æœåŠ¡å·²è¿è¡Œä¸”é…ç½®æ­£ç¡®

# å¯åŠ¨æœåŠ¡ (main.py ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ - ä»…é™SQLiteæˆ–é¦–æ¬¡åœ¨ç©ºPGåº“è¿è¡Œ)
python main.py
```

#### 3. å‰ç«¯å¯åŠ¨
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev # (Viteé€šå¸¸ä½¿ç”¨ npm run dev)
```
è®¿é—® `http://localhost:5173` (æˆ–ViteæŒ‡å®šçš„ç«¯å£)ã€‚

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### ä½¿ç”¨Docker Compose
```bash
# (ç¡®ä¿å·²å®‰è£… Docker å’Œ Docker Compose)

# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ (è§ä¸‹æ–‡)

# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ (åå°è¿è¡Œ)
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿— (ä¾‹å¦‚åç«¯æœåŠ¡)
docker-compose logs -f backend

# åœæ­¢å¹¶ç§»é™¤å®¹å™¨
docker-compose down
```

#### ç¯å¢ƒå˜é‡é…ç½®
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ (ä¼šè¢« `docker-compose.yml` å’Œåç«¯é…ç½®åŠ è½½):
```env
# åº”ç”¨é…ç½®
APP_ENV=production # "development" æˆ– "production"
APP_DEBUG=false # åœ¨ç”Ÿäº§ä¸­è®¾ä¸º false
LOG_LEVEL=INFO # (DEBUG, INFO, WARNING, ERROR)

# æ•°æ®åº“é…ç½® (PostgreSQLç¤ºä¾‹)
DATABASE_URL=postgresql+asyncpg://your_pg_user:your_pg_password@db:5432/your_db_name
# å¯¹äºæœ¬åœ°SQLiteå¼€å‘ (é€šå¸¸ç”±config.pyè‡ªåŠ¨å¤„ç†ï¼Œä½†å¯è¦†ç›–)
# DATABASE_URL=sqlite+aiosqlite:///./test_dev.db 

# AI APIé…ç½® (å¿…éœ€, ç¤ºä¾‹)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
GEMINI_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# ... å…¶ä»–AIæä¾›å•†çš„APIå¯†é’¥ï¼Œæ ¹æ®ai_modelsè¡¨ä¸­çš„api_key_env_varé…ç½®

# æ–‡ä»¶æœåŠ¡ (MinIOç¤ºä¾‹)
MINIO_ENDPOINT=minio:9000 # Dockerå†…éƒ¨åœ°å€
MINIO_ACCESS_KEY=your_minio_access_key
MINIO_SECRET_KEY=your_minio_secret_key
MINIO_BUCKET_NAME=deepstudents-dev
MINIO_USE_SSL=false # æ ¹æ®MinIOé…ç½®

# FastAPIæœåŠ¡å™¨é…ç½® (å¯é€‰)
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
BACKEND_RELOAD=false # ç”Ÿäº§ä¸­è®¾ä¸ºfalse

# CORS (ç”Ÿäº§ä¸­åº”é™åˆ¶)
# ALLOWED_ORIGINS=["http://localhost:5173","https://yourdomain.com"]
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ
- **Python**: éµå¾ªPEP 8ï¼Œä½¿ç”¨Blackæ ¼å¼åŒ–ï¼Œisortè¿›è¡Œå¯¼å…¥æ’åºã€‚ Ruffç”¨äºç»¼åˆLintingå’Œæ ¼å¼åŒ–ã€‚
- **TypeScript/JavaScript**: ä½¿ç”¨ESLint + Prettier (æ ¹æ®é¡¹ç›®é…ç½®)ã€‚
- **æäº¤è§„èŒƒ**: ä½¿ç”¨Conventional Commitsã€‚

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ç›¸åº”çš„serviceç›®å½•ä¸‹åˆ›å»ºæ–°æ¨¡å—/æ–‡ä»¶ã€‚
2. å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆ`models.py`ï¼‰ã€‚
3. åˆ›å»ºè¯·æ±‚/å“åº”æ¨¡å¼ï¼ˆ`schemas.py`ï¼‰ã€‚
4. å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆ`service.py`ï¼‰ã€‚
5. æ·»åŠ APIè·¯ç”±ï¼ˆ`api.py` æˆ– `router.py`ï¼‰ã€‚
6. ç¼–å†™æµ‹è¯•ç”¨ä¾‹ (åœ¨ `tests/` ç›®å½•ä¸‹å¯¹åº”æœåŠ¡)ã€‚
7. æ›´æ–°æœ¬æ–‡æ¡£ (`docs/é¡¹ç›®æ–‡æ¡£.md`) å’Œ `README.md`ã€‚
8. å¦‚æœæ¶‰åŠæ•°æ®åº“æ¨¡å‹å˜æ›´ï¼Œåˆ›å»ºå¹¶åº”ç”¨Alembicè¿ç§»ã€‚

### æµ‹è¯•
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# è¿è¡Œæ‰€æœ‰åç«¯æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶æˆ–ç›®å½•
pytest tests/services/problem_service/

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ (éœ€è¦ pytest-cov)
pytest --cov=services --cov-report=html  # ç”ŸæˆHTMLæŠ¥å‘Šåˆ° htmlcov/

# å‰ç«¯æµ‹è¯• (å¦‚æœé…ç½®äº†)
# cd frontend
# npm test
```

### è°ƒè¯•æŠ€å·§
1. ä½¿ç”¨ `get_logger` è·å–çš„loggerå®ä¾‹è¿›è¡Œæ—¥å¿—è®°å½•ã€‚
2. FastAPIè‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ï¼šåç«¯ `/docs` (ä¾‹å¦‚ `http://localhost:8000/docs`)ã€‚
3. ä½¿ç”¨VS Codeçš„Pythonè°ƒè¯•å™¨ (é…ç½® `launch.json`)ã€‚
4. æŸ¥çœ‹SQLAlchemyç”Ÿæˆçš„SQLï¼šåœ¨ `shared/config.py` ä¸­è®¾ç½® `Settings.DATABASE_ECHO=True`ã€‚
5. Vue Devtools for browser debugging (å®‰è£…æµè§ˆå™¨æ‰©å±•)ã€‚

## å¸¸è§é—®é¢˜
(åŒå‰æ–‡)

## æ›´æ–°æ—¥å¿—

### v2.1.0 (è¿›è¡Œä¸­)
- âœ¨ æ–°å¢AIé©±åŠ¨çš„é”™é¢˜æ™ºèƒ½å½•å…¥æµç¨‹ï¼ŒåŒ…æ‹¬å¤šé˜¶æ®µAIå¤„ç†å’Œç”¨æˆ·äº¤äº’ç•Œé¢ã€‚
- âœ¨ æ–°å¢ `ProblemAISession` å’Œ `ProblemAIChatLog` ç”¨äºæ”¯æŒAIé”™é¢˜åˆ›å»ºä¼šè¯ç®¡ç†å’ŒèŠå¤©è®°å½•å­˜å‚¨ã€‚
- âœ¨ å‰ç«¯ `ProblemCreate.vue` é‡æ„ä»¥æ”¯æŒæ–°çš„AIå½•å…¥æµç¨‹ã€‚
- âœ¨ æ–°å¢ `AISessionList.vue` ç”¨äºæŸ¥çœ‹å’Œç®¡ç†AIåˆ›å»ºä¼šè¯ã€‚
- ğŸ”§ æ›´æ–°APIæ¥å£å’Œæ•°æ®åº“æ¨¡å‹ä»¥æ”¯æŒæ–°åŠŸèƒ½ã€‚
- ğŸ“š å¯¹åº”æ›´æ–°é¡¹ç›®æ–‡æ¡£ã€‚

### v2.0.0 (2024-03-08) - (ç¤ºä¾‹ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µæ›´æ–°)
- ğŸ‰ å®Œå…¨é‡æ„ä¸ºå¾®æœåŠ¡æ¶æ„ (FastAPIåç«¯, Vue.jså‰ç«¯)
- âœ¨ æ–°å¢AI APIç®¡ç†æœåŠ¡ï¼Œæ”¯æŒå¤šæä¾›å•†
- âœ¨ æ–°å¢æ·±åº¦å­¦ä¹ åˆ†æåŠŸèƒ½
- âœ¨ å‰ç«¯è¿ç§»è‡³Vue.js 3 + Vite + Element Plus + Pinia
- ğŸ”§ ä¼˜åŒ–æ•°æ®åº“è®¾è®¡ï¼Œä½¿ç”¨SQLAlchemy 2.0å¼‚æ­¥æ¨¡å¼
- ğŸ³ å…¨é¢æ”¯æŒDockerå’ŒDocker Composeéƒ¨ç½²
- ğŸ“š å®Œå–„é¡¹ç›®æ–‡æ¡£ï¼Œæ›´æ–°å¼€å‘å’Œéƒ¨ç½²æŒ‡å—

### v1.0.0 (2024-01-01) - (ç¤ºä¾‹)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ åŸºç¡€é”™é¢˜ç®¡ç†åŠŸèƒ½ (æ—§ç‰ˆæŠ€æœ¯æ ˆ)
- âœ¨ ç®€å•çš„AIåˆ†æ

## è´¡çŒ®æŒ‡å—
(åŒå‰æ–‡)

## è®¸å¯è¯
(åŒå‰æ–‡)

## è”ç³»æ–¹å¼
(åŒå‰æ–‡)

---

*æœ€åæ›´æ–°ï¼š2025å¹´5æœˆ25æ—¥*
