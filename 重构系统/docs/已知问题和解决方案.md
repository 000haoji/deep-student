# 已知问题和解决方案

## 当前存在的问题

### 1. 模块导入路径问题

**问题描述**：
服务内部的导入路径使用了`backend`前缀，导致在backend目录下运行时出现模块找不到的错误。

**影响文件**：
- `backend/services/problem_service/service.py`
- `backend/services/review_service/service.py`
- `backend/main.py`
- 所有服务的内部导入

**临时解决方案**：
```python
# 在运行脚本前设置PYTHONPATH
export PYTHONPATH=$PYTHONPATH:/path/to/重构系统

# 或在Python代码中添加
import sys
sys.path.insert(0, '/path/to/重构系统')
```

**永久解决方案**：
将所有导入改为相对导入或使用包结构：
```python
# 原来的导入
from backend.services.ai_api_manager import ai_router

# 改为相对导入
from ..ai_api_manager import ai_router

# 或者在backend目录运行时
from services.ai_api_manager import ai_router
```

### 2. 依赖未安装

**问题描述**：
运行系统检查时提示缺少多个依赖包。

**解决方案**：
```bash
cd backend
pip install -r requirements.txt
```

**注意事项**：
- 建议使用虚拟环境避免依赖冲突
- 某些包可能需要系统级依赖（如PostgreSQL客户端库）

### 3. 数据库迁移兼容性

**问题描述**：
迁移脚本针对PostgreSQL编写，SQLite需要语法转换。

**当前状态**：
已实现`adapt_sql_for_sqlite`函数进行自动转换，但某些特性无法完全兼容：
- UUID类型 → TEXT
- 数组类型 → JSON
- GIN索引 → 普通索引
- 触发器 → 不支持

**影响**：
- SQLite环境下某些查询可能需要调整
- 性能可能不如PostgreSQL

### 4. 前端组件未实现

**问题描述**：
前端只搭建了基础框架，具体页面组件尚未实现。

**需要实现的组件**：
- `Layout` - 应用布局
- `Dashboard` - 仪表板
- `ProblemList` - 错题列表
- `ProblemDetail` - 错题详情
- `ProblemCreate` - 创建错题
- `ReviewAnalysis` - 分析报告
- `Settings` - 设置页面

**解决方案**：
参考[前端开发指南](./前端开发指南.md)逐步实现各个组件。

### 5. AI服务配置

**问题描述**：
AI功能需要配置API密钥才能使用。

**解决方案**：
1. 获取相应的API密钥
2. 在`.env`文件中配置：
```env
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_API_KEY=...
```

### 6. 文件存储服务

**问题描述**：
默认配置使用MinIO，需要额外启动MinIO服务。

**解决方案**：

**方案1：使用Docker启动MinIO**
```bash
docker run -p 9000:9000 -p 9001:9001 \
  -e MINIO_ROOT_USER=minioadmin \
  -e MINIO_ROOT_PASSWORD=minioadmin \
  minio/minio server /data --console-address ":9001"
```

**方案2：改用本地文件系统**
修改文件服务实现，使用本地目录存储文件。

## 优化建议

### 1. 项目结构优化
- 统一导入路径策略
- 添加`__init__.py`文件完善包结构
- 使用相对导入减少路径依赖

### 2. 配置管理优化
- 提供更多默认配置
- 支持多环境配置文件
- 添加配置验证和提示

### 3. 开发体验优化
- 添加Makefile简化常用命令
- 提供开发环境一键启动脚本
- 完善错误提示和日志

### 4. 测试覆盖
- 添加单元测试
- 添加集成测试
- 添加E2E测试

### 5. 文档完善
- API示例代码
- 部署最佳实践
- 性能优化指南

## 临时解决方案汇总

在正式修复前，可以使用以下临时方案：

### 启动脚本
创建`start_backend.sh`：
```bash
#!/bin/bash
cd backend
export PYTHONPATH=$PYTHONPATH:$(pwd)/..
python main.py
```

### 开发环境配置
创建`.env.development`：
```env
# 最小化配置，使用SQLite和本地存储
DATABASE_URL=sqlite+aiosqlite:///./error_management.db
USE_LOCAL_STORAGE=true
LOCAL_STORAGE_PATH=./uploads
```

### VS Code配置
`.vscode/settings.json`：
```json
{
  "python.defaultInterpreterPath": "${workspaceFolder}/backend/venv/bin/python",
  "python.terminal.activateEnvironment": true,
  "python.linting.enabled": true,
  "python.linting.flake8Enabled": true,
  "python.formatting.provider": "black"
}
```

## 问题追踪

| 问题 | 严重程度 | 状态 | 计划解决时间 |
|------|---------|------|-------------|
| 模块导入路径 | 高 | 待修复 | v2.0.1 |
| 前端组件实现 | 中 | 进行中 | v2.1.0 |
| 测试覆盖率低 | 中 | 待处理 | v2.1.0 |
| 文档示例不足 | 低 | 待处理 | v2.0.2 |

---

*最后更新：2024年3月8日* 