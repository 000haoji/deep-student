# 本地版本修改记录

> 本文档记录了从原始系统到本地版本的所有修改

## 2025-05-23 更新：AI API管理系统集成

### 后端修改

1. **app_local.py 修改**
   ```python
   # 添加导入
   from services.ai_api_manager.api import router as ai_router, ai_router as ai_router_instance
   from services.ai_api_manager.models import AIProvider, AICapability, TaskType, AIModel
   
   # 注册AI路由
   app.include_router(ai_router)
   
   # 启动事件中添加AI路由器初始化
   async with AsyncSession(engine) as session:
       await ai_router_instance.initialize(session)
   
   # 添加测试端点
   @app.post("/test/create-default-ai-model")
   ```

2. **AI API Manager 模型兼容性修改**
   - `services/ai_api_manager/models.py`：
     - 修改 `AICallLog.model_id` 从 `UUID` 改为 `String(36)`（适配SQLite）

### 前端修改

1. **新增页面**
   - `src/views/ai/AIModelList.vue`：AI模型配置管理页面
   - `src/views/ai/AIStats.vue`：AI使用统计页面

2. **路由更新**
   - `src/router/index.js`：添加AI管理相关路由
     ```javascript
     {
       path: 'ai/models',
       name: 'ai-models',
       component: () => import('@/views/ai/AIModelList.vue')
     },
     {
       path: 'ai/stats',
       name: 'ai-stats',
       component: () => import('@/views/ai/AIStats.vue')
     }
     ```

3. **布局更新**
   - `src/layouts/MainLayout.vue`：
     - 添加AI管理菜单项
     - 更新路由名称映射
     - 导入 `Cpu` 图标

### 功能特性

1. **AI模型管理**
   - 支持多个AI提供商（OpenAI、Gemini、DeepSeek、Claude、Qwen）
   - 模型配置CRUD操作
   - API密钥加密存储
   - 连接测试功能

2. **使用统计**
   - 调用次数、成功率、Token消耗、成本统计
   - 调用趋势图表（ECharts）
   - 成本分布饼图
   - 实时健康监控

3. **智能路由**
   - 根据任务类型自动选择模型
   - 负载均衡
   - 故障转移
   - 优先级管理

## 2025-05-22 更新：移除用户认证系统

### 后端修改

1. **创建 app_local.py**
   - 基于原 `app.py` 创建无认证版本
   - 移除所有JWT相关代码
   - 移除用户路由和中间件
   - 使用固定的 `LOCAL_USER_ID`

2. **数据库模型修改**
   - `shared/models/base.py`：
     - 移除 `user_id` 字段
     - 修改 `id` 字段从 `UUID` 改为 `String(36)`（SQLite兼容）
   
   - `services/problem_service/models.py`：
     - 移除 `user_id` 字段和外键
   
   - `services/review_service/models.py`：
     - 移除 `user_id` 字段
     - 修改 `problem_id` 外键引用

3. **配置修改**
   - 使用 SQLite 替代 PostgreSQL
   - 数据库文件：`error_management.db`

### 前端修改

1. **路由修改** (`src/router/index.js`)
   - 移除登录/注册路由
   - 移除认证守卫
   - 所有路由直接可访问

2. **API工具修改** (`src/utils/api.js`)
   - 移除token相关的请求/响应拦截器
   - 移除401错误处理

3. **布局修改** (`src/layouts/MainLayout.vue`)
   - 移除用户菜单
   - 添加"本地版本 v2.0"标识
   - 简化头部导航

4. **组件修复**
   - 修复7个空的Vue组件文件，添加基础模板

### 其他修改

1. **启动脚本**
   - 创建 `start_all.bat`：Windows批处理启动脚本
   - 创建 `start_all.py`：Python启动脚本（跨平台）

2. **文档更新**
   - 更新 README.md
   - 创建系统状态报告
   - 记录所有修改内容

## 系统特点

1. **无需认证**：适合个人本地使用
2. **SQLite数据库**：无需安装PostgreSQL
3. **保留核心功能**：错题管理、数据分析、AI集成
4. **简化部署**：一键启动脚本

## 注意事项

1. 数据库从PostgreSQL迁移到SQLite，UUID类型改为String(36)
2. 所有用户相关功能已移除
3. 适合单用户本地使用场景
4. AI功能需要配置真实的API密钥才能使用 