# 技能默认启用功能

## 概述

技能管理页面的"激活"功能已重构为"默认启用"功能，解决了原有功能语义混乱的问题。

## 变更说明

### 问题背景

原有"激活"功能存在以下问题：
- 技能管理页面的"激活"状态只是本地 UI 状态，刷新后会重置
- 用户误以为在管理页面激活 = 聊天时自动使用，实际上两者独立
- 功能无实际作用，增加用户困惑

### 解决方案

将"激活"改为"默认启用"：
- 标记的技能在新建聊天时**自动激活**
- 使用 `localStorage` 持久化存储
- 用户可随时修改默认技能配置

## 功能特性

### 1. 设为默认
- 在技能管理页面点击"设为默认"按钮
- 已设为默认的技能显示"默认"标识
- 再次点击可取消默认状态

### 2. 自动激活
- 创建新会话时，自动激活所有默认技能
- 技能指令会注入到 LLM 请求中
- 用户可在聊天中手动取消激活

### 3. 持久化存储
- 默认技能列表保存在 `localStorage`
- Key: `dstu-skill-defaults`
- 格式: JSON 字符串数组

## 技术实现

### 新增文件

| 文件 | 说明 |
|------|------|
| `src/chat-v2/skills/skillDefaults.ts` | 默认技能管理器 |
| `src/chat-v2/skills/hooks/useSkillDefaults.ts` | React Hook |

### 修改文件

| 文件 | 修改内容 |
|------|----------|
| `SkillsManagementPage.tsx` | 使用 `useSkillDefaults` 替代本地 state |
| `SkillsList.tsx` | 更新 props 和 UI 文案 |
| `SkillsSidebar.tsx` | 更新 props 和显示 |
| `ChatV2Page.tsx` | 新建会话时激活默认技能 |
| `useSessionManagement.ts` | 新建会话时激活默认技能 |
| `skills/index.ts` | 导出新模块 |
| `skills/hooks/index.ts` | 导出 Hook |
| `locales/zh-CN/skills.json` | 新增翻译 |
| `locales/en-US/skills.json` | 新增翻译 |

## 使用示例

### 在组件中使用

```tsx
import { useSkillDefaults } from '@/chat-v2/skills';

function MyComponent() {
  const { defaultIds, isDefault, toggleDefault } = useSkillDefaults();

  return (
    <button onClick={() => toggleDefault('my-skill')}>
      {isDefault('my-skill') ? '取消默认' : '设为默认'}
    </button>
  );
}
```

### 直接使用管理器

```ts
import { skillDefaults } from '@/chat-v2/skills';

// 获取所有默认技能
const defaults = skillDefaults.getAll();

// 添加默认技能
skillDefaults.add('knowledge-retrieval');

// 移除默认技能
skillDefaults.remove('knowledge-retrieval');

// 切换状态
skillDefaults.toggle('knowledge-retrieval');

// 检查是否为默认
const isDefault = skillDefaults.isDefault('knowledge-retrieval');
```

## 翻译键

| 键 | 中文 | 英文 |
|----|------|------|
| `skills:management.set_default` | 设为默认 | Set as Default |
| `skills:management.is_default` | 默认 | Default |
| `skills:management.default_enabled` | 默认 | Default |
| `skills:management.default_count` | {{count}} 个默认技能 | {{count}} default skills |
| `skills:management.default_hint` | 默认技能会在新建聊天时自动激活 | Default skills will be automatically activated... |

---

*更新日期：2026-01-31*
