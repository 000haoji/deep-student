# 数据管理与治理

## 概述

Deep Student 极其重视用户数据的安全与隐私。**数据治理 (Data Governance)** 模块是系统的数据中枢，负责统一管理所有数据的备份、恢复、同步、迁移和健康检查。

入口：**设置 -> 数据治理**

---

## 备份管理

Deep Student 采用先进的 **分层备份策略**，让你在数据安全和存储空间之间取得平衡。

### 分层备份策略 (Tiered Backup)

系统将数据划分为四个层级（P0-P3）：

| 层级 | 名称 | 内容 | 适用场景 |
|------|------|------|----------|
| **P0** | **核心数据** (Core) | 数据库文件 (settings, chat_v2)、配置、密钥 | **极其重要**，体积小，建议高频备份 |
| **P1** | **重要数据** (Important) | 笔记文本、VFS 元数据、Anki 卡片记录 | **重要**，体积较小，建议每日备份 |
| **P2** | **可重建数据** (Rebuildable) | 向量索引 (LanceDB)、缓存、OCR 结果 | 体积较大，丢失后可重新生成，按需备份 |
| **P3** | **大型资产** (Assets) | 图片、PDF 原文、音频、视频 | 体积巨大，建议定期导出或使用增量备份 |

### 执行备份

在数据治理面板中：
1. 选择 **"备份"** 标签页。
2. 选择 **快速备份**（通常包含 P0+P1）或 **自定义备份**（手动选择层级）。
3. 点击 **"立即备份"**。

### 自动备份

建议开启自动备份功能：
- 设置备份频率（如每 24 小时）。
- 设置保留策略（如保留最近 7 天 + 每周 1 份）。

---

## 云同步

支持基于 WebDAV 或 S3 的私有云同步，实现多端数据互通。

### 配置云存储
在 **设置 -> 云存储** 中配置你的 WebDAV（如坚果云）或 S3（如 AWS, MinIO, 阿里云 OSS）服务信息。

### 同步机制
Deep Student 采用 **记录级增量同步**：
- **冲突检测**：当多端同时修改同一数据时，系统会触发冲突检测。
- **解决策略**：
    - **保留本地**：以当前设备为准。
    - **使用云端**：覆盖本地修改。
    - **保留最新**：基于时间戳自动合并。

在 **"同步"** 标签页可以查看待同步的变更数，并手动触发同步。

---

## 健康检查与审计

### 健康检查
系统内置了数据库健康检查工具。在 **"概览"** 标签页点击 **"运行健康检查"**，系统会扫描：
- 数据库文件完整性
- 外键约束一致性
- VFS 资源索引状态

若发现问题（如索引丢失），系统会提供修复建议或自动修复选项。

### 审计日志
所有敏感操作（备份、恢复、删除、同步）都会被记录。在 **"审计"** 标签页可以查看操作历史，追踪数据变更。

---

## 数据迁移

### 从 V1 迁移
如果你是从 Deep Student 旧版本升级而来，系统会自动检测旧版数据（如旧的 `mistakes.db` 或 `chat_messages` 表）。
- 在 **"迁移"** 标签页，点击 **"检查状态"**。
- 确认后点击 **"开始迁移"**，系统会将旧数据转换为 Chat V2 和 VFS 格式。

### ZIP 导入导出
- **导出**：可以将指定层级的数据打包为标准 ZIP 文件，方便迁移到新设备。
- **导入**：支持从 ZIP 包完整恢复数据。

---

## 常见问题

### Q: 备份文件占用了太多空间怎么办？
A: 
1. 检查备份策略，避免对 P2/P3 层级进行过于频繁的全量备份。
2. 在备份列表中删除旧的备份文件。
3. 使用 "清理" 功能移除未引用的图片和缓存。

### Q: 同步时提示冲突怎么办？
A: 这是正常现象。点击 "解决冲突"，系统会列出冲突的数据项。通常选择 "保留最新" 即可，如果你确定某台设备的修改更重要，可以选择 "保留本地" 或 "使用云端"。

### Q: 为什么我看不到旧版的错题数据？
A: 旧版 "错题本" 已升级为 "题目集 (Question Bank)"。请在数据治理面板执行一次 "数据迁移"，旧数据将自动导入到新的系统中。

---

*最后更新：2026-02-10*