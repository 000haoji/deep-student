# 技能系统

## 概述

技能系统 (Skills) 是 Deep Student 的可扩展 AI 能力增强机制，基于 SKILL.md 规范设计。通过激活不同的技能，你可以让 AI 获得特定的行为模式、专业指令和工具能力。

### 主要特性

- **预配置行为模式**：每个技能包含专门的系统提示词，让 AI 更擅长特定场景
- **按需加载工具**：技能携带的工具只在激活时加载，减少上下文占用
- **灵活激活方式**：支持命令、UI 选择、默认自动加载等多种方式
- **三级覆盖机制**：内置 → 全局 → 项目级技能，后加载的覆盖先加载的
- **用户自定义**：支持创建、编辑、导入/导出自定义技能

---

## 快速开始

### 激活技能

**方式一：命令激活**

在对话输入框中输入：

```
/skill tutor-mode
```

系统会激活指定的技能，输入框上方会显示已激活的技能标签。

**方式二：UI 选择**

1. 点击输入栏底部工具栏中的 **技能按钮**（闪电图标）
2. 在弹出的技能选择面板中选择要激活的技能
3. 可同时激活多个技能

### 取消激活

- 输入 `/skill off` 取消当前激活的所有技能
- 或点击技能标签上的关闭按钮移除单个技能

### 查看可用技能

输入 `/skill list` 查看所有可用技能列表。

---

## 内置技能

Deep Student 提供两类内置技能：

### 指令型技能

这些技能主要通过专业的系统提示词改变 AI 的行为模式：

| 技能 ID | 名称 | 说明 |
|---------|------|------|
| `tutor-mode` | 导师模式 | 苏格拉底式教学，通过提问引导你思考，而非直接给出答案 |
| `chatanki` | ChatAnki | 端到端制卡闭环，将 PDF/图片/截图/手写/Markdown 等材料自动转成可复习卡片 |
| `literature-review` | 文献综述 | 文献综述助手，帮助你阅读、分析和总结学术文献 |
| `research-mode` | 调研模式 | 深度调研助手，帮助你系统性地收集和整理信息 |
| `deep-scholar` | 深度学者 | 结合了长时记忆和深度推理的学术助手，擅长处理复杂的跨学科问题和长期研究项目 |

**使用示例**：

```
/skill tutor-mode
帮我理解快速排序算法
```

AI 会以导师的方式，通过提问引导你逐步理解算法原理，而不是直接讲解。

### 工具组技能

这些技能携带特定的工具能力，激活后 AI 可以调用相关工具：

| 技能 ID | 名称 | 包含工具 |
|---------|------|----------|
| `knowledge-retrieval` | 知识检索 | RAG 检索、多模态搜索、统一搜索、记忆搜索、网络搜索 |
| `canvas-note` | 笔记工具 | 创建笔记、读取笔记、更新笔记 |
| `vfs-memory` | 记忆系统 | 存储记忆、检索记忆、管理记忆 |
| `mindmap-tools` | 思维导图 | 创建导图、更新节点、导出图片 |
| `todo-tools` | 待办工具 | 创建待办、管理任务列表 |
| `web-fetch` | 网页抓取 | 抓取网页内容、解析链接 |
| `learning-resource` | 学习资源 | 管理教材、题目集、翻译、作文 |
| `attachment-tools` | 附件工具 | 上传文件、解析文档 |
| `qbank-tools` | 题库工具 | 创建题目、练习模式、模拟考试 |
| `workspace-tools` | 工作区工具 | 工作区管理相关操作 |
| `subagent-worker` | 子代理工作器 | 启动子代理执行复杂任务 |
| `template-designer` | 模板设计 | 创建、验证和预览 Anki 卡片模板（HTML/CSS） |
| `ask-user` | 交互提问 | 允许 AI 主动向用户提问以澄清需求或获取偏好 |

> **提示**：Anki 制卡工具已整合到 `chatanki` 指令型技能中，通过 `/skill chatanki` 激活即可使用完整的制卡、导出、同步功能。

**使用示例**：

```
/skill canvas-note
帮我把刚才的对话要点整理成一篇笔记
```

AI 会调用笔记工具，直接在 Learning Hub 中创建一篇新笔记。

---

## 技能管理

### 进入技能管理页面

技能管理是独立的视图页面，不在设置中。

**入口方式**：
1. 点击侧边栏导航中的 **技能管理** 图标（闪电图标，位于"学习资源"和"Anki工具"之间）
2. 或使用命令面板：按 `⌘K` / `Ctrl+K`，搜索 "技能管理"

### 技能列表

技能管理页面左侧显示所有可用技能：

- **内置技能**：系统预设的技能，不可删除，但可以自定义
- **全局技能**：存储在 `~/.deep-student/skills/` 的用户技能
- **项目技能**：存储在项目 `.skills/` 目录的项目级技能

### 查看技能详情

点击技能卡片查看：

- **元数据**：ID、名称、描述、版本、作者
- **指令内容**：技能的系统提示词（Markdown 格式）
- **内嵌工具**：技能携带的工具列表

说明：版本号显示依赖技能元数据中的 `version` 字段，未填写则不显示。

### 编辑内置技能

内置技能可以自定义，但不会修改原始文件：

1. 选择一个内置技能
2. 点击 **编辑** 按钮
3. 修改指令内容或元数据
4. 点击 **保存** 保存自定义版本

自定义版本会覆盖内置版本。如需恢复默认，点击 **恢复默认** 按钮。

---

## 创建自定义技能

### 通过技能管理页面创建

1. 点击技能列表顶部的 **"+"** 按钮
2. 填写技能元数据：
   - **ID**：唯一标识（小写字母、数字、连字符，如 `my-custom-skill`）
   - **名称**：显示名称
   - **描述**：功能描述（用于 AI 自动发现）
3. 编写指令内容（Markdown 格式）
4. 点击 **创建** 保存

### 技能文件格式

技能文件采用 `SKILL.md` 格式，包含 YAML frontmatter 和 Markdown 内容：

```markdown
---
id: my-study-helper
name: 学习助手
description: 帮助制定学习计划和追踪学习进度
version: 1.0.0
author: Your Name
priority: 3
---

# 学习助手

你是一个专业的学习规划师，擅长：

1. 制定科学的学习计划
2. 追踪学习进度
3. 提供学习方法建议

## 工作原则

- 根据用户的时间和目标制定可执行的计划
- 定期提醒用户复习
- 使用间隔重复原则优化记忆

## 互动方式

首先了解用户的学习目标和可用时间，然后给出具体的学习建议。
```

### 技能存储位置

| 类型 | 存储位置 | 说明 |
|------|----------|------|
| 全局技能 | `~/.deep-student/skills/` | 所有项目共享 |
| 项目技能 | `.skills/` | 开发环境默认在项目根目录；生产环境默认映射到应用数据目录 |

项目技能优先级高于全局技能，同 ID 时会覆盖。

### 导入/导出技能

**导出技能**：

1. 在技能详情页点击 **导出** 按钮
2. 选择保存位置
3. 技能会导出为 `.SKILL.md` 文件

**导入技能**：

1. 点击技能列表顶部的 **导入** 按钮
2. 选择 `.SKILL.md` 文件
3. 技能会添加到全局技能目录

---

## 高级用法

### 设置默认技能

让新会话自动激活指定技能：

1. 进入技能管理页面
2. 在技能卡片上点击 **设为默认** 按钮
3. 可设置多个默认技能

### 技能优先级

当多个技能存在冲突时，按优先级决定生效顺序：

- `priority` 值越小优先级越高（默认为 3）
- 同优先级时，后加载的覆盖先加载的

### 禁用自动调用

某些技能可以禁止 AI 自动调用（仅限用户手动激活）：

```yaml
---
id: dangerous-tool
name: 敏感操作工具
disableAutoInvoke: true
---
```

### 技能类型

技能分为两种类型：

| 类型 | 说明 | 用途 |
|------|------|------|
| `standalone` | 独立型（默认） | 单独使用的技能 |
| `composite` | 整合型 | 组合多个技能，通过 `relatedSkills` 关联 |

整合型技能示例：

```yaml
---
id: full-study-workflow
name: 完整学习流程
skillType: composite
relatedSkills:
  - tutor-mode
  - canvas-note
  - anki-tools
---
```

### 技能依赖

指定技能的前置依赖：

```yaml
---
id: advanced-anki
name: 高级制卡
dependencies:
  - anki-tools
---
```

激活 `advanced-anki` 时会自动加载 `anki-tools`。

---

## 与 MCP 工具的关系

技能系统与 MCP 工具紧密集成：

- 技能通过 `embeddedTools` 字段携带工具定义
- 工具只在技能激活时注入到 AI 上下文
- 这种"渐进披露"机制显著减少了上下文占用

**MCP 工具 vs 技能工具**：

| 类型 | 来源 | 加载时机 |
|------|------|----------|
| MCP 外部工具 | 外部 MCP 服务器 | 连接时全量加载 |
| 技能内嵌工具 | 技能 `embeddedTools` | 技能激活时按需加载 |
| 内置工具组 | `builtin-*` 技能 | 技能激活时按需加载 |

---

## 常见问题

### Q: 技能和 MCP 工具有什么区别？

A: 技能是更高层的抽象，包含系统提示词和工具配置。MCP 工具是底层的能力单元。一个技能可以：
- 只包含系统提示词（改变 AI 行为）
- 只包含工具（提供能力）
- 同时包含两者

### Q: 如何让 AI 自动选择合适的技能？

A: AI 会根据 `<available_skills>` 元数据自动推荐技能。你也可以：
1. 设置默认技能，新会话自动激活
2. 在对话中直接描述需求，AI 会建议激活相关技能

### Q: 自定义技能保存在哪里？

A: 自定义技能保存在 `~/.deep-student/skills/` 目录下。内置技能的自定义版本保存在应用数据库中。

### Q: 如何分享技能给其他人？

A: 将技能导出为 `.skill.md` 文件，分享给其他用户导入即可。

### Q: 激活多个技能会冲突吗？

A: 一般不会冲突。多个技能的指令会合并注入到上下文，工具也会合并可用。但如果指令存在矛盾，可能会影响 AI 行为。

### Q: 为什么有些工具需要激活技能才能使用？

A: 这是"渐进披露"设计。全量加载所有工具会占用大量上下文 Token，影响 AI 理解能力。按需加载可以：
- 减少 Token 消耗
- 提高 AI 对当前任务的专注度
- 降低工具调用错误率

---

*最后更新：2026-02-07*
