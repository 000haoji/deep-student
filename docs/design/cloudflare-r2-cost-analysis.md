# Cloudflare R2 成本深度调研报告

## 1. 核心计费模型 (Pay-as-you-go)

Cloudflare R2 的计费极其简单，没有复杂的阶梯定价，也没有流量费。

| 计费项 | 价格 | 说明 |
| :--- | :--- | :--- |
| **存储费** (Storage) | **$0.015** / GB / 月 | 约合 ¥0.11 / GB。 |
| **流量费** (Egress) | **$0** (免费) | **这是 R2 最大的优势**，AWS S3/阿里云 OSS 的流量费通常占大头。 |
| **A 类操作** (Class A) | **$4.50** / 百万次 | 写入操作：`PutObject`, `CopyObject`, `ListObjects` 等。 |
| **B 类操作** (Class B) | **$0.36** / 百万次 | 读取操作：`GetObject`, `HeadObject` 等。 |

---

## 2. 免费额度 (Free Tier) - 永久每月重置

Cloudflare R2 的免费额度非常慷慨，对于中小型开源项目或个人开发者，**通常是完全免费的**。

*   **存储空间**: **10 GB** / 月
*   **A 类操作**: **1,000,000 次** / 月 (上传/列举)
*   **B 类操作**: **10,000,000 次** / 月 (下载/读取)
*   **出口流量**: **无限**

---

## 3. 典型场景成本估算

假设你有一个 **100 MB** 的安装包 (`app-v1.0.0.zip`)。

### 场景 A：起步阶段
*   **存储**: 1 个文件 (100MB) -> 0.1 GB
*   **上传**: GitHub Action 自动上传 1 次 -> 1 次 Class A
*   **下载**: 每月 **1,000 人次** 下载
    *   **流量**: 1000 * 100MB = 100 GB
    *   **操作**: 1000 次 Class B

**账单计算**:
*   存储: 0.1 GB < 10 GB (免费)
*   Class A: 1 < 100万 (免费)
*   Class B: 1,000 < 1000万 (免费)
*   流量: 0 (免费)
*   **总计: $0.00**

### 场景 B：成长期 (小爆款)
*   **存储**: 累积 10 个历史版本 (1GB)
*   **下载**: 每月 **10,000 人次** 下载
    *   **流量**: 10,000 * 100MB = **1 TB (1000 GB)**
    *   **操作**: 10,000 次 Class B

**账单计算**:
*   存储: 1 GB < 10 GB (免费)
*   Class B: 1万 < 1000万 (免费)
*   流量: **0** (节省了约 $80-$120 的流量费，对比 AWS/OSS)
*   **总计: $0.00**

### 场景 C：超大规模 (CDN 穿透风险)
*   **下载**: 每月 **1,000,000 人次** 下载
    *   **流量**: 100 TB
    *   **操作**: 100万次 Class B
*   **未命中缓存**: 如果每次请求都回源 R2 (无 CDN 缓存)，消耗 100万次 Class B -> 仍在免费额度内 ($0)。
*   **总计: $0.00** (除非下载量超过 1000万次/月，才开始收 $0.36)

---

## 4. 关键优化：CDN 缓存 (省钱秘籍)

虽然 Class B 操作很便宜，但为了极致性能和避免被攻击消耗额度，建议开启 Cloudflare CDN 缓存。

*   **原理**: 当用户请求文件时，如果 Cloudflare 边缘节点已有缓存，直接返回文件，**不产生 R2 Class B 操作**。
*   **配置**:
    1. 绑定自定义域名 (Custom Domain)。
    2. 在 Cloudflare Dashboard -> **Cache Rules** (或 Page Rules) 设置。
    3. 规则: `URI Path` 包含 `/releases/` -> **Cache Level: Cache Everything** -> **Edge Cache TTL: 1 month**。
*   **效果**: 95%+ 的下载请求会被 CDN 拦截，R2 的 Class B 操作数几乎为零。

---

## 5. 国内访问成本

*   **自定义域名**: 必须绑定。
    *   成本: 一个域名的费用 (约 ¥60/年)。Cloudflare Free Plan 即可绑定，**无需升级 Enterprise**。
*   **速度**:
    *   Cloudflare 在国内没有企业级 CDN 节点 (除非备案并使用合作版)，走的是泛播 (Anycast) 节点，通常绕路美西或新加坡。
    *   **体验**: 速度一般 (几百 KB/s ~ 几 MB/s)，但**比 GitHub 直接下载稳得多**，且不会断连。
    *   **优化**: 可套一层国内 CDN (如腾讯云 CDN) 回源到 Cloudflare 自定义域名 (需备案域名，且增加国内 CDN 流量成本)，或者直接接受 Cloudflare 的免费速度。

## 6. 结论

**Cloudflare R2 是目前分发 Release 安装包的“版本答案”。**

*   **成本**: 对绝大多数开源/个人项目，是 **完全免费** 的。
*   **坑点**: 唯一需要付出的是配置一个自定义域名 (Custom Domain)。
*   **对比**: 同样的 1TB 流量，阿里云 OSS 需支付约 500元人民币流量费，R2 是 0元。
